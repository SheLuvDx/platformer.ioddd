/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var f=0;return function(){return f<b.length?{done:!1,value:b[f++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return f?f.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var f,a=[];!(f=b.next()).done;)a.push(f.value);return a};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};"undefined"==typeof _pio&&(_pio={});
(function(){_pio.channel=function(){};_pio.channel.prototype.call=function(b,f,a,d,c){var e="undefined"!=typeof PLAYERIO_API_HOST?PLAYERIO_API_HOST:(PlayerIO.useSecureApiRequests?"https":"http")+"://api.playerio.com/json/",g=new XMLHttpRequest;"withCredentials"in g?g.open("post",e,!0):"undefined"!=typeof XDomainRequest?(g=new XDomainRequest,g.open("post",e)):g=new _pio.flashWebRequest("post",e);var h=Error();null!=g?(g.send("["+b+"|"+(this.token||"")+"]"+JSON.stringify(f)),g.onload=function(){var k=
null;try{var l=g.response||g.responseText;if("["==l[0]){var m=l.indexOf("]");this.token=l.substring(1,m);l=l.substring(m+1)}k=JSON.parse(l)}catch(n){_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,"Error decoding response from webservice: "+n);return}if("undefined"==typeof k.errorcode&&"undefined"==typeof k.message){l=k;if(c)try{l=c(k)}catch(n){_pio.handleError(h,d,n.code,n.message)}a&&a(l)}else _pio.handleError(h,d,k.errorcode,k.message)},g.onerror=function(k){_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,
"Error talking to webservice: "+JSON.stringify(k))}):_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,"Need to implement flash calling")};_pio.runCallback=function(b,f,a){try{b&&b(f)}catch(d){b="Unhandled error in callback: "+d.message,b=b+"\nStack:\n"+(d.stack||d.stacktrace||d.StackTrace),a&&(b=b+"\nCallsite stack:\n"+(a.stack||a.stacktrace||a.StackTrace)),console.log(b)}};_pio.handleError=function(b,f,a,d){a=_pio.error(a,d);b&&(b.stack&&(a.stack=b.stack),b.stacktrace&&(a.stacktrace=b.stacktrace),
b.StackTrace&&(a.StackTrace=b.StackTrace));f?_pio.runCallback(f,a,b):"undefined"!=typeof console?console.log("No error callback specified for: "+a.code+": "+a.message+"\n"+(a.stack||a.stacktrace||a.StackTrace)):alert("No error callback specified for: "+a.code+": "+a.message+"\n"+(a.stack||a.stacktrace||a.StackTrace))};_pio.error=function(b,f){1==arguments.length&&(f=b,b=PlayerIOErrorCode.GeneralError);"number"==typeof b&&(b=PlayerIOErrorCode.codes[b]);if("string"!=typeof b)throw console.log(b,f,Error().stack),
"Code must be a string!";var a=Error();return new PlayerIOError(b,f,a.stack||a.stacktrace||a.StackTrace)};_pio.debugLog=function(b){"undefined"!=typeof console&&console.log(b)};_pio.convertToKVArray=function(b){var f=[];if(b)for(var a in b)f.push({key:""+a,value:""+b[a]});return f};_pio.convertFromKVArray=function(b){var f={};if(b&&b.length)for(var a in b)f[b[a].key]=b[a].value;return f};_pio.convertToSegmentArray=function(b){var f=[];if(b)for(var a in b)f.push(a+":"+b[a]);return f}})();
PlayerIO={useSecureApiRequests:!1,authenticate:function(b,f,a,d,c,e){if("auto"==a.publishingnetworklogin)"undefined"==typeof window.PublishingNetwork?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Could not find the PublishingNetwork object on the current page. Did you include the PublishingNetwork.js script?")):PublishingNetwork.dialog("login",{gameId:b,connectionId:f,__use_usertoken__:!0},function(h){h.error?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,h.error)):"undefined"==typeof h.userToken?
e(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Missing userToken value in result, but no error message given.")):PlayerIO.authenticate(b,f,{userToken:h.userToken},d,c,e)});else{var g=new _pio.channel;g.authenticate(b,f,_pio.convertToKVArray(a),_pio.convertToSegmentArray(d),"javascript",_pio.convertToKVArray({}),null,c,e,function(h){g.token=h.token;return new _pio.client(g,b,h.gamefsredirectmap,h.userid)})}},quickConnect:null,gameFS:function(b){return new _pio.gameFS(b)}};var JSON;
JSON||(JSON={});
(function(){function b(l){return 10>l?"0"+l:l}function f(l){c.lastIndex=0;return c.test(l)?'"'+l.replace(c,function(m){var n=h[m];return"string"===typeof n?n:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function a(l,m){var n,p=e,q=m[l];q&&"object"===typeof q&&"function"===typeof q.toJSON&&(q=q.toJSON(l));"function"===typeof k&&(q=k.call(m,l,q));switch(typeof q){case "string":return f(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);case "object":if(!q)return"null";
e+=g;var r=[];if("[object Array]"===Object.prototype.toString.apply(q)){var v=q.length;for(n=0;n<v;n+=1)r[n]=a(n,q)||"null";var y=0===r.length?"[]":e?"[\n"+e+r.join(",\n"+e)+"\n"+p+"]":"["+r.join(",")+"]";e=p;return y}if(k&&"object"===typeof k)for(v=k.length,n=0;n<v;n+=1){if("string"===typeof k[n]){var D=k[n];(y=a(D,q))&&r.push(f(D)+(e?": ":":")+y)}}else for(D in q)Object.prototype.hasOwnProperty.call(q,D)&&(y=a(D,q))&&r.push(f(D)+(e?": ":":")+y);y=0===r.length?"{}":e?"{\n"+e+r.join(",\n"+e)+"\n"+
p+"}":"{"+r.join(",")+"}";e=p;return y}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(l){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(l){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(l,m,n){var p;g=e="";if("number"===typeof n)for(p=0;p<n;p+=1)g+=" ";else"string"===typeof n&&(g=n);if((k=m)&&"function"!==typeof m&&("object"!==typeof m||"number"!==typeof m.length))throw Error("JSON.stringify");return a("",{"":l})});
"function"!==typeof JSON.parse&&(JSON.parse=function(l,m){function n(q,r){var v,y=q[r];if(y&&"object"===typeof y)for(v in y)if(Object.prototype.hasOwnProperty.call(y,v)){var D=n(y,v);void 0!==D?y[v]=D:delete y[v]}return m.call(q,r,y)}l=String(l);d.lastIndex=0;d.test(l)&&(l=l.replace(d,function(q){return"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(l.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var p=eval("("+l+")");return"function"===typeof m?n({"":p},""):p}throw new SyntaxError("JSON.parse");})})();
(function(){function b(h){if(null!=c)h(c);else if(e)h(null);else if(null==g){g=[h];var k=setInterval(function(){var m=f();null!=m&&l(m)},50);setTimeout(function(){null==c&&l(null)},3E4);var l=function(m){c=m;e=null==m;clearInterval(k);for(var n=0;n!=g.length;n++)g[n](m)}}else g.push(h)}function f(){var h='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="10" height="10" style="$style$" id="$id$">\t<param name="movie" value="$src$" />\t<param name="allowNetworking" value="all" />\t<param name="allowScriptAccess" value="always" />\t\x3c!--[if !IE]>--\x3e\t<object type="application/x-shockwave-flash" data="$src$" width="10" height="10" style="$style$">\t\t<param name="allowNetworking" value="all" />\t\t<param name="allowScriptAccess" value="always" />\t</object>\t\x3c!--<![endif]--\x3e</object>'.replace(/\$id\$/gi,"__pio_flashfallback__");
h=h.replace(/\$src\$/gi,"http://192.168.30.154/html5client/FlashFallback/bin-debug/FlashFallback.swf");h=h.replace(/\$style\$/gi,"width:10px;height:10px");var k=document.getElementById("containerId");if(!k){var l=document.createElement("div");l.setAttribute("id",k);l.setAttribute("style","position:absolute;top:-20px;left:-20px");l.innerHTML=h;try{document.body.appendChild(l)}catch(m){}}h=function(m){m=document.getElementsByTagName(m);for(var n=0;n!=m.length;n++)if(m[n].ping&&"pong"==m[n].ping())return m[n]};
return h("embed")||h("object")}var a={},d=0;__pio_flashfallback_callback__=function(){var h=a[arguments[0]];if(h){for(var k=[],l=1;l!=arguments.length;l++)k[l-1]=arguments[l];h.apply(null,k)}};_pio.flashWebRequest=function(h,k){var l=this;this.response=null;this.onload=function(){};this.onerror=function(){};this.send=function(m){b(function(n){if(null==n)l.onerror("Browser does not support Cross-Origin (CORS) webrequest or Flash as a fallback method");else{var p="cb"+d++;a[p]=function(q,r){delete a[p];
if(q)l.response=r,l.onload();else l.onerror(r)};n.webrequest(p,h,k,m)}})}};_pio.flashSocketConnection=function(h,k,l,m,n){var p="cb"+d++,q=this,r=new _pio.messageSerializer,v=!1,y=!1,D=setTimeout(function(){v||(v=!0,l(!1,"Connect attempt timed out"))},k);this.disconnect=function(){console.log("... this shouldn't happen")};this.sendMessage=function(u){console.log("... send msg. this shouldn't happen")};b(function(u){null==u?(v=!0,l(!1,"Browser does not support WebSocket connections and the Flash fallback failed.")):
(a[p]=function(B,z){switch(B){case "onopen":v||(clearTimeout(D),y=v=!0,u.socketSend(p,[0]),l(y));break;case "onclose":q.disconnect();break;case "onerror":q.disconnect();break;case "onmessage":n(r.deserializeMessage(z,0,z.length))}},q.disconnect=function(){if(y){y=!1;m();try{u.socketClose(p)}catch(B){_pio.debugLog(B)}}},q.sendMessage=function(B){B=r.serializeMessage(B);u.socketSend(p,B)},u.socketConnection(p,h))})};_pio.isFlashFallbackEnabled=function(h){b(function(k){h(null!=k)})};var c=null,e=!1,
g=null})();
(function(){var b=_pio.channel.prototype;b.connect=function(f,a,d,c,e,g,h,k,l,m,n){this.call(10,{gameid:f,connectionid:a,userid:d,auth:c,partnerid:e,playerinsightsegments:g,clientapi:h,clientinfo:k},l,m,n)};_pio.ApiSecurityRule={RespectClientSetting:0,UseHttp:1,UseHttps:2};b.authenticate=function(f,a,d,c,e,g,h,k,l,m){this.call(13,{gameid:f,connectionid:a,authenticationarguments:d,playerinsightsegments:c,clientapi:e,clientinfo:g,playcodes:h},k,l,m)};b.createRoom=function(f,a,d,c,e,g,h,k){this.call(21,{roomid:f,
roomtype:a,visible:d,roomdata:c,isdevroom:e},g,h,k)};b.joinRoom=function(f,a,d,c,e,g){this.call(24,{roomid:f,joindata:a,isdevroom:d},c,e,g)};b.createJoinRoom=function(f,a,d,c,e,g,h,k,l){this.call(27,{roomid:f,roomtype:a,visible:d,roomdata:c,joindata:e,isdevroom:g},h,k,l)};b.listRooms=function(f,a,d,c,e,g,h,k){this.call(30,{roomtype:f,searchcriteria:a,resultlimit:d,resultoffset:c,onlydevrooms:e},g,h,k)};b.userLeftRoom=function(f,a,d,c,e,g){this.call(40,{extendedroomid:f,newplayercount:a,closed:d},
c,e,g)};b.writeError=function(f,a,d,c,e,g,h,k){this.call(50,{source:f,error:a,details:d,stacktrace:c,extradata:e},g,h,k)};b.updateRoom=function(f,a,d,c,e,g){this.call(53,{extendedroomid:f,visible:a,roomdata:d},c,e,g)};_pio.ValueType={String:0,Int:1,UInt:2,Long:3,Bool:4,Float:5,Double:6,ByteArray:7,DateTime:8,Array:9,Obj:10};b.createObjects=function(f,a,d,c,e){this.call(82,{objects:f,loadexisting:a},d,c,e)};b.loadObjects=function(f,a,d,c){this.call(85,{objectids:f},a,d,c)};_pio.LockType={NoLocks:0,
LockIndividual:1,LockAll:2};b.saveObjectChanges=function(f,a,d,c,e,g){this.call(88,{locktype:f,changesets:a,createifmissing:d},c,e,g)};b.deleteObjects=function(f,a,d,c){this.call(91,{objectids:f},a,d,c)};b.loadMatchingObjects=function(f,a,d,c,e,g,h){this.call(94,{table:f,index:a,indexvalue:d,limit:c},e,g,h)};b.loadIndexRange=function(f,a,d,c,e,g,h,k){this.call(97,{table:f,index:a,startindexvalue:d,stopindexvalue:c,limit:e},g,h,k)};b.deleteIndexRange=function(f,a,d,c,e,g,h){this.call(100,{table:f,
index:a,startindexvalue:d,stopindexvalue:c},e,g,h)};b.loadMyPlayerObject=function(f,a,d){this.call(103,{},f,a,d)};b.payVaultReadHistory=function(f,a,d,c,e,g){this.call(160,{page:f,pagesize:a,targetuserid:d},c,e,g)};b.payVaultRefresh=function(f,a,d,c,e){this.call(163,{lastversion:f,targetuserid:a},d,c,e)};b.payVaultConsume=function(f,a,d,c,e){this.call(166,{ids:f,targetuserid:a},d,c,e)};b.payVaultCredit=function(f,a,d,c,e,g){this.call(169,{amount:f,reason:a,targetuserid:d},c,e,g)};b.payVaultDebit=
function(f,a,d,c,e,g){this.call(172,{amount:f,reason:a,targetuserid:d},c,e,g)};b.payVaultBuy=function(f,a,d,c,e,g){this.call(175,{items:f,storeitems:a,targetuserid:d},c,e,g)};b.payVaultGive=function(f,a,d,c,e){this.call(178,{items:f,targetuserid:a},d,c,e)};b.payVaultPaymentInfo=function(f,a,d,c,e,g){this.call(181,{provider:f,purchasearguments:a,items:d},c,e,g)};b.payVaultUsePaymentInfo=function(f,a,d,c,e){this.call(184,{provider:f,providerarguments:a},d,c,e)};b.partnerPayTrigger=function(f,a,d,c,
e){this.call(200,{key:f,count:a},d,c,e)};b.partnerPaySetTag=function(f,a,d,c){this.call(203,{partnerid:f},a,d,c)};b.notificationsRefresh=function(f,a,d,c){this.call(213,{lastversion:f},a,d,c)};b.notificationsRegisterEndpoints=function(f,a,d,c,e){this.call(216,{lastversion:f,endpoints:a},d,c,e)};b.notificationsSend=function(f,a,d,c){this.call(219,{notifications:f},a,d,c)};b.notificationsToggleEndpoints=function(f,a,d,c,e,g){this.call(222,{lastversion:f,endpoints:a,enabled:d},c,e,g)};b.notificationsDeleteEndpoints=
function(f,a,d,c,e){this.call(225,{lastversion:f,endpoints:a},d,c,e)};b.gameRequestsSend=function(f,a,d,c,e,g){this.call(241,{requesttype:f,requestdata:a,requestrecipients:d},c,e,g)};b.gameRequestsRefresh=function(f,a,d,c){this.call(244,{playcodes:f},a,d,c)};b.gameRequestsDelete=function(f,a,d,c){this.call(247,{requestids:f},a,d,c)};b.achievementsRefresh=function(f,a,d,c){this.call(271,{lastversion:f},a,d,c)};b.achievementsLoad=function(f,a,d,c){this.call(274,{userids:f},a,d,c)};b.achievementsProgressSet=
function(f,a,d,c,e){this.call(277,{achievementid:f,progress:a},d,c,e)};b.achievementsProgressAdd=function(f,a,d,c,e){this.call(280,{achievementid:f,progressdelta:a},d,c,e)};b.achievementsProgressMax=function(f,a,d,c,e){this.call(283,{achievementid:f,progress:a},d,c,e)};b.achievementsProgressComplete=function(f,a,d,c){this.call(286,{achievementid:f},a,d,c)};b.playerInsightRefresh=function(f,a,d){this.call(301,{},f,a,d)};b.playerInsightSetSegments=function(f,a,d,c){this.call(304,{segments:f},a,d,c)};
b.playerInsightTrackInvitedBy=function(f,a,d,c,e){this.call(307,{invitinguserid:f,invitationchannel:a},d,c,e)};b.playerInsightTrackEvents=function(f,a,d,c){this.call(311,{events:f},a,d,c)};b.playerInsightTrackExternalPayment=function(f,a,d,c,e){this.call(314,{currency:f,amount:a},d,c,e)};b.playerInsightSessionKeepAlive=function(f,a,d){this.call(317,{},f,a,d)};b.playerInsightSessionStop=function(f,a,d){this.call(320,{},f,a,d)};b.oneScoreLoad=function(f,a,d,c){this.call(351,{userids:f},a,d,c)};b.oneScoreSet=
function(f,a,d,c){this.call(354,{score:f},a,d,c)};b.oneScoreAdd=function(f,a,d,c){this.call(357,{score:f},a,d,c)};b.oneScoreRefresh=function(f,a,d){this.call(360,{},f,a,d)};b.simpleConnect=function(f,a,d,c,e,g,h,k,l){this.call(400,{gameid:f,usernameoremail:a,password:d,playerinsightsegments:c,clientapi:e,clientinfo:g},h,k,l)};b.simpleRegister=function(f,a,d,c,e,g,h,k,l,m,n,p,q,r){this.call(403,{gameid:f,username:a,password:d,email:c,captchakey:e,captchavalue:g,extradata:h,partnerid:k,playerinsightsegments:l,
clientapi:m,clientinfo:n},p,q,r)};b.simpleRecoverPassword=function(f,a,d,c,e){this.call(406,{gameid:f,usernameoremail:a},d,c,e)};b.kongregateConnect=function(f,a,d,c,e,g,h,k,l){this.call(412,{gameid:f,userid:a,gameauthtoken:d,playerinsightsegments:c,clientapi:e,clientinfo:g},h,k,l)};b.simpleGetCaptcha=function(f,a,d,c,e,g){this.call(415,{gameid:f,width:a,height:d},c,e,g)};b.facebookOAuthConnect=function(f,a,d,c,e,g,h,k,l){this.call(418,{gameid:f,accesstoken:a,partnerid:d,playerinsightsegments:c,clientapi:e,
clientinfo:g},h,k,l)};b.steamConnect=function(f,a,d,c,e,g,h,k,l){this.call(421,{gameid:f,steamappid:a,steamsessionticket:d,playerinsightsegments:c,clientapi:e,clientinfo:g},h,k,l)};b.simpleUserGetSecureLoginInfo=function(f,a,d){this.call(424,{},f,a,d)};b.joinCluster=function(f,a,d,c,e,g,h,k,l,m,n,p,q,r,v,y,D){this.call(504,{clusteraccesskey:f,isdevelopmentserver:a,ports:d,machinename:c,version:e,machineid:g,os:h,cpu:k,cpucores:l,cpulogicalcores:m,cpuaddresswidth:n,cpumaxclockspeed:p,rammegabytes:q,
ramspeed:r},v,y,D)};b.serverHeartbeat=function(f,a,d,c,e,g,h,k,l,m,n,p,q,r,v,y,D,u,B,z){this.call(510,{serverid:f,appdomains:a,servertypes:d,machinecpu:c,processcpu:e,memoryusage:g,avaliablememory:h,freememory:k,runningrooms:l,usedresources:m,apirequests:n,apirequestserror:p,apirequestsfailed:q,apirequestsexecuting:r,apirequestsqueued:v,apirequeststime:y,serverunixtimeutc:D},u,B,z)};b.getGameAssemblyUrl=function(f,a,d,c,e,g){this.call(513,{clusteraccesskey:f,gamecodeid:a,machineid:d},c,e,g)};b.devServerLogin=
function(f,a,d,c,e){this.call(524,{username:f,password:a},d,c,e)};b.webserviceOnlineTest=function(f,a,d){this.call(533,{},f,a,d)};b.getServerInfo=function(f,a,d,c){this.call(540,{machineid:f},a,d,c)};b.socialRefresh=function(f,a,d){this.call(601,{},f,a,d)};b.socialLoadProfiles=function(f,a,d,c){this.call(604,{userids:f},a,d,c)}})();
PlayerIOError=function(b,f,a){this.code=b;this.message=f;this.stack=a;this.stack||(a=Error(),this.stack=a.stack||a.stacktrace||a.StackTrace);this.toString=function(){return"PlayerIOError["+b+"]: "+f}};PlayerIOError.prototype=Error();
PlayerIOErrorCode={UnsupportedMethod:"UnsupportedMethod",GeneralError:"GeneralError",InternalError:"InternalError",AccessDenied:"AccessDenied",InvalidMessageFormat:"InvalidMessageFormat",MissingValue:"MissingValue",GameRequired:"GameRequired",ExternalError:"ExternalError",ArgumentOutOfRange:"ArgumentOutOfRange",GameDisabled:"GameDisabled",UnknownGame:"UnknownGame",UnknownConnection:"UnknownConnection",InvalidAuth:"InvalidAuth",NoServersAvailable:"NoServersAvailable",RoomDataTooLarge:"RoomDataTooLarge",
RoomAlreadyExists:"RoomAlreadyExists",UnknownRoomType:"UnknownRoomType",UnknownRoom:"UnknownRoom",MissingRoomId:"MissingRoomId",RoomIsFull:"RoomIsFull",NotASearchColumn:"NotASearchColumn",QuickConnectMethodNotEnabled:"QuickConnectMethodNotEnabled",UnknownUser:"UnknownUser",InvalidPassword:"InvalidPassword",InvalidRegistrationData:"InvalidRegistrationData",InvalidBigDBKey:"InvalidBigDBKey",BigDBObjectTooLarge:"BigDBObjectTooLarge",BigDBObjectDoesNotExist:"BigDBObjectDoesNotExist",UnknownTable:"UnknownTable",
UnknownIndex:"UnknownIndex",InvalidIndexValue:"InvalidIndexValue",NotObjectCreator:"NotObjectCreator",KeyAlreadyUsed:"KeyAlreadyUsed",StaleVersion:"StaleVersion",CircularReference:"CircularReference",HeartbeatFailed:"HeartbeatFailed",InvalidGameCode:"InvalidGameCode",VaultNotLoaded:"VaultNotLoaded",UnknownPayVaultProvider:"UnknownPayVaultProvider",DirectPurchaseNotSupportedByProvider:"DirectPurchaseNotSupportedByProvider",BuyingCoinsNotSupportedByProvider:"BuyingCoinsNotSupportedByProvider",NotEnoughCoins:"NotEnoughCoins",
ItemNotInVault:"ItemNotInVault",InvalidPurchaseArguments:"InvalidPurchaseArguments",InvalidPayVaultProviderSetup:"InvalidPayVaultProviderSetup",UnknownPartnerPayAction:"UnknownPartnerPayAction",InvalidType:"InvalidType",IndexOutOfBounds:"IndexOutOfBounds",InvalidIdentifier:"InvalidIdentifier",InvalidArgument:"InvalidArgument",LoggedOut:"LoggedOut",InvalidSegment:"InvalidSegment",GameRequestsNotLoaded:"GameRequestsNotLoaded",AchievementsNotLoaded:"AchievementsNotLoaded",UnknownAchievement:"UnknownAchievement",
NotificationsNotLoaded:"NotificationsNotLoaded",InvalidNotificationsEndpoint:"InvalidNotificationsEndpoint",NetworkIssue:"NetworkIssue",OneScoreNotLoaded:"OneScoreNotLoaded",PublishingNetworkNotAvailable:"PublishingNetworkNotAvailable",PublishingNetworkNotLoaded:"PublishingNetworkNotLoaded",DialogClosed:"DialogClosed",AdTrackCheckCookie:"AdTrackCheckCookie",codes:{0:"UnsupportedMethod",1:"GeneralError",2:"InternalError",3:"AccessDenied",4:"InvalidMessageFormat",5:"MissingValue",6:"GameRequired",7:"ExternalError",
8:"ArgumentOutOfRange",9:"GameDisabled",10:"UnknownGame",11:"UnknownConnection",12:"InvalidAuth",13:"NoServersAvailable",14:"RoomDataTooLarge",15:"RoomAlreadyExists",16:"UnknownRoomType",17:"UnknownRoom",18:"MissingRoomId",19:"RoomIsFull",20:"NotASearchColumn",21:"QuickConnectMethodNotEnabled",22:"UnknownUser",23:"InvalidPassword",24:"InvalidRegistrationData",25:"InvalidBigDBKey",26:"BigDBObjectTooLarge",27:"BigDBObjectDoesNotExist",28:"UnknownTable",29:"UnknownIndex",30:"InvalidIndexValue",31:"NotObjectCreator",
32:"KeyAlreadyUsed",33:"StaleVersion",34:"CircularReference",40:"HeartbeatFailed",41:"InvalidGameCode",50:"VaultNotLoaded",51:"UnknownPayVaultProvider",52:"DirectPurchaseNotSupportedByProvider",54:"BuyingCoinsNotSupportedByProvider",55:"NotEnoughCoins",56:"ItemNotInVault",57:"InvalidPurchaseArguments",58:"InvalidPayVaultProviderSetup",70:"UnknownPartnerPayAction",80:"InvalidType",81:"IndexOutOfBounds",82:"InvalidIdentifier",83:"InvalidArgument",84:"LoggedOut",90:"InvalidSegment",100:"GameRequestsNotLoaded",
110:"AchievementsNotLoaded",111:"UnknownAchievement",120:"NotificationsNotLoaded",121:"InvalidNotificationsEndpoint",130:"NetworkIssue",131:"OneScoreNotLoaded",200:"PublishingNetworkNotAvailable",201:"PublishingNetworkNotLoaded",301:"DialogClosed",302:"AdTrackCheckCookie"}};
(function(){_pio.client=function(b,f,a,d){this.connectUserId=d;this.gameId=f;this.gameFS=new _pio.gameFS(f,a);this.errorLog=new _pio.errorLog(b);this.payVault=new _pio.payVault(b);this.bigDB=new _pio.bigDB(b);this.multiplayer=new _pio.multiplayer(b);this.gameRequests=new _pio.gameRequests(b);this.achievements=new _pio.achievements(b);this.playerInsight=new _pio.playerInsight(b);this.oneScore=new _pio.oneScore(b);this.notifications=new _pio.notifications(b);this.publishingNetwork=new _pio.publishingNetwork(b,
this.connectUserId)}})();
(function(){var b={};_pio.gameFS=function(f,a){if("string"==typeof a&&0<a.length){var d=(a||"").split("|");if(1<=d.length)for(var c=b[f.toLowerCase()]={},e=0;e!=d.length;e++){var g=d[e];"alltoredirect"==g||"cdnmap"==g?c.baseUrl=d[e+1]:"alltoredirectsecure"==g||"cdnmapsecure"==g?c.secureBaseUrl=d[e+1]:c["."+g]=d[e+1]}}this.getUrl=function(h,k){if("/"==!h[0])throw _pio.error("The path given to getUrl must start with a slash, like: '/myfile.swf' or '/folder/file.jpg'");var l=b[f];return l?(k?l.secureBaseUrl:
l.baseUrl)+(l["."+h]||h):(k?"https":"http")+"://r.playerio.com/r/"+f+h}}})();
(function(){_pio.gameRequests=function(b){function f(c){if(null==c||0==c.length)return[];for(var e=[],g=0;g!=c.length;g++){var h=c[g];e.push(new _pio.gameRequest(h.id,h.type,h.senderuserid,h.created,h.data))}return e}var a=[];this.waitingRequests="[ERROR: You tried to access gameRequests.waitingRequests before loading waiting requests. You have to call the refresh method first.]";var d=this;this.send=function(c,e,g,h,k){b.gameRequestsSend(c,_pio.convertToKVArray(e),g,h,k,function(l){})};this.refresh=
function(c,e){b.gameRequestsRefresh(a,c,e,function(g){d._playCodes=g.newplaycodes;d.waitingRequests=f(g.requests)})};this["delete"]=function(c,e,g){if("object"==typeof c||c.length){for(var h=[],k=0;k!=c.length;k++){var l=c[k].id;if(l)h.push(l);else{c=_pio.error("No GameRequest id found on item#"+k+". You have to use requests from the gameRequests.waitingRequests array. For instance: client.gameRequests.delete(client.gameRequests.waitingRequests, ...)");_pio.handleError(c,g,c.code,c.message);return}}b.gameRequestsDelete(h,
e,g,function(m){d.waitingRequests=f(m.requests)})}else c=_pio.error("The first argument to delete should be an array: client.gameRequests.delete([requests], ...)"),_pio.handleError(c,g,c.code,c.message)}};_pio.gameRequest=function(b,f,a,d,c){this.id=b;this.type=f;this.senderUserId=a;this.created=new Date(d);this.data=_pio.convertFromKVArray(c)}})();(function(){_pio.errorLog=function(b){this.writeError=function(f,a,d,c){b.writeError("Javascript",f,a,d,_pio.convertToKVArray(c))}}})();
(function(){_pio.quickConnect=function(){this.simpleGetCaptcha=function(b,f,a,d,c){(new _pio.channel).simpleGetCaptcha(b,f,a,d,c,function(e){return new _pio.simpleGetCaptchaOutput(e.captchakey,e.captchaimageurl)})};this.simpleRecoverPassword=function(b,f,a,d){(new _pio.channel).simpleRecoverPassword(b,f,a,d,function(c){})}};_pio.simpleGetCaptchaOutput=function(b,f){this.captchaKey=b;this.captchaImageUrl=f};PlayerIO.quickConnect=new _pio.quickConnect})();
(function(){_pio.payVault=function(b){function f(c){if(null!=c&&(a=c.version,d.coins=c.coins||0,d.items=[],c.items&&c.items.length))for(var e=0;e!=c.items.length;e++){var g=c.items[e],h=d.items[e]=new _pio.vaultItem(g.id,g.itemkey,(new Date).setTime(g.purchasedate));_pio.bigDBDeserialize(g.properties,h,!0)}}var a=null;this.coins="[ERROR: you tried to access payVault.coins before the vault was loaded. You have to refresh the vault before the .coins property is set to the right value]";this.items="[ERROR: you tried to access payVault.items before the vault was loaded. You have to refresh the vault before the .items property is set to the right value]";
this.has=function(c){if(null==a)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0;e!=this.items.length;e++)if(this.items[e].itemKey==c)return!0;return!1};this.first=function(c){if(null==a)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0;e!=this.items.length;e++)if(this.items[e].itemKey==c)return this.items[e];
return null};this.count=function(c){if(null==a)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0,g=0;g!=this.items.length;g++)this.items[g].itemKey==c&&e++;return e};this.refresh=function(c,e){b.payVaultRefresh(a,null,c,e,function(g){f(g.vaultcontents)})};this.readHistory=function(c,e,g,h){b.payVaultReadHistory(c,e,null,g,h,function(k){for(var l=[],m=0;m!=k.entries.length;m++){var n=k.entries[m];
l.push(new _pio.payVaultHistoryEntry(n.type,n.amount,n.timestamp,n.itemkeys||[],n.reason,n.providertransactionid,n.providerprice))}return l})};this.credit=function(c,e,g,h){b.payVaultCredit(c,e,null,g,h,function(k){f(k.vaultcontents)})};this.debit=function(c,e,g,h){b.payVaultDebit(c,e,null,g,h,function(k){f(k.vaultcontents)})};this.consume=function(c,e,g){if("object"==typeof c||c.length){for(var h=[],k=0;k!=c.length;k++){var l=c[k].id;if(l)h.push(l);else{c=_pio.error("No PayVault item id found on item#"+
k+". You have to use items from the payVault.items array. For instance: client.payVault.consume([client.payVault.first('sportscar')], ...)");_pio.handleError(c,g,c.code,c.message);return}}b.payVaultConsume(h,null,e,g,function(m){f(m.vaultcontents)})}else c=_pio.error("The first argument to consume should be an array: client.payVault.consume([item], ...)"),_pio.handleError(c,g,c.code,c.message)};this.buy=function(c,e,g,h){b.payVaultBuy(_pio.convertBuyItems(c),e,null,g,h,function(k){f(k.vaultcontents)})};
this.give=function(c,e,g){b.payVaultGive(_pio.convertBuyItems(c),null,e,g,function(h){f(h.vaultcontents)})};this.getBuyCoinsInfo=function(c,e,g,h){b.payVaultPaymentInfo(c,_pio.convertToKVArray(e),null,g,h,function(k){return _pio.convertFromKVArray(k.providerarguments)})};this.getBuyDirectInfo=function(c,e,g,h,k){b.payVaultPaymentInfo(c,_pio.convertToKVArray(e),_pio.convertBuyItems(g),h,k,function(l){return _pio.convertFromKVArray(l.providerarguments)})};var d=this};_pio.convertBuyItems=function(b){if(null==
b)return[];for(var f=[],a=0;a!=b.length;a++){var d=b[a].itemkey;if(!d)throw _pio.error("You have to specify an itemkey for the payvault item. Example:  {itemkey:'car'}");f.push({itemkey:d,payload:_pio.compareForChanges({itemkey:d},b[a],!0,!0)})}return f};_pio.vaultItem=function(b,f,a){this.id=b;this.itemKey=f;this.purchaseDate=a};_pio.payVaultHistoryEntry=function(b,f,a,d,c,e,g){this.type=b;this.amount=f;this.timestamp=(new Date).setTime(a);this.itemKeys=d;this.reason=c;this.providerTransactionId=
e;this.providerPrice=g}})();
(function(){_pio.bigDB=function(b){function f(){for(var e=0;e<c.length;e++){var g=c[e],h=!0,k;for(k in g.objects)if(g.objects[k]._internal_("get-is-saving")){h=!1;break}if(h){for(k in g.objects)for(h=e+1;h<c.length;h++){futureSave=c[h];for(var l=0;l<futureSave.objects.length;l++)futureSave.objects[l]==g.objects[k]&&futureSave.fullOverwrite==g.fullOverwrite&&futureSave.useOptimisticLock==g.useOptimisticLock&&(g.changesets[k]=futureSave.changesets[l],g.futureSaves.push(futureSave))}c.splice(e,1);e--;
g.execute()}}}function a(e,g){null==e?e=[]:e instanceof Array||(e=[e]);null!=g&&(e=e.concat([g]));for(var h=[],k=0;k!=e.length;k++){var l=e[k];switch(typeof l){case "boolean":h.push({valuetype:_pio.ValueType.Bool,bool:l});break;case "string":h.push({valuetype:_pio.ValueType.String,string:l});break;case "number":0!=l%1?h.push({valuetype:_pio.ValueType.Double,"double":l}):-2147483648<l&&2147483647>l?h.push({valuetype:_pio.ValueType.Int,"int":l}):0<l&&4294967295>l?h.push({valuetype:_pio.ValueType.UInt,
uint:l}):h.push({valuetype:_pio.ValueType.Long,"long":l});break;case "object":if(l.getTime&&l.getMilliseconds)h.push({valuetype:_pio.ValueType.DateTime,datetime:l.getTime()});else throw Error("Don't know how to serialize type '"+typeof l+"' for BigDB");break;default:throw Error("Don't know how to serialize type '"+typeof l+"' for BigDB");}}return h}var d=this,c=[];this.createObject=function(e,g,h,k,l){var m=_pio.compareForChanges({},h||{},!0,!0);b.createObjects([{key:g,table:e,properties:m}],!1,k,
l,function(n){if(1==n.objects.length)return new _pio.databaseobject(d,e,n.objects[0].key,n.objects[0].version,!1,m);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.loadMyPlayerObject=function(e,g){b.loadMyPlayerObject(e,g,function(h){return new _pio.databaseobject(d,"PlayerObjects",h.playerobject.key,h.playerobject.version,!0,h.playerobject.properties)})};this.load=function(e,g,h,k){b.loadObjects([{table:e,keys:[g]}],h,k,function(l){if(1==l.objects.length)return null==
l.objects[0]?null:new _pio.databaseobject(d,e,l.objects[0].key,l.objects[0].version,!1,l.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error loading object");})};this.loadKeys=function(e,g,h,k){b.loadObjects([{table:e,keys:g}],h,k,function(l){for(var m=[],n=0;n!=l.objects.length;n++){var p=l.objects[n];m[n]=null==p?null:new _pio.databaseobject(d,e,p.key,p.version,!1,p.properties)}return m})};this.loadOrCreate=function(e,g,h,k){b.createObjects([{key:g,table:e,properties:[]}],
!0,h,k,function(l){if(1==l.objects.length)return new _pio.databaseobject(d,e,l.objects[0].key,l.objects[0].version,!1,l.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.deleteKeys=function(e,g,h,k){b.deleteObjects([{table:e,keys:g}],h,k,function(l){return null})};this.loadKeysOrCreate=function(e,g,h,k){for(var l=[],m=0;m!=g.length;m++)l.push({key:g[m],table:e,properties:[]});b.createObjects(l,!0,h,k,function(n){for(var p=[],q=0;q!=n.objects.length;q++){var r=
n.objects[q];p[q]=new _pio.databaseobject(d,e,r.key,r.version,!1,r.properties)}return p})};this.loadSingle=function(e,g,h,k,l){b.loadMatchingObjects(e,g,a(h),1,k,l,function(m){return 0==m.objects.length?null:new _pio.databaseobject(d,e,m.objects[0].key,m.objects[0].version,!1,m.objects[0].properties)})};this.loadRange=function(e,g,h,k,l,m,n,p){b.loadIndexRange(e,g,a(h,k),a(h,l),m,n,p,function(q){for(var r=[],v=0;v!=q.objects.length;v++){var y=q.objects[v];r[v]=null==y?null:new _pio.databaseobject(d,
e,y.key,y.version,!1,y.properties)}return r})};this.deleteRange=function(e,g,h,k,l,m,n){b.deleteIndexRange(e,g,a(h,k),a(h,l),m,n,function(){})};this.saveChanges=function(e,g,h,k,l,m){var n=1==m;m=[];for(var p in h){var q=h[p];if(!(q.existsInDatabase&&q.key&&q.table&&q._internal_&&q.save)){e=_pio.error("You can only save database objects that exist in the database");_pio.handleError(e,l,e.code,e.message);return}var r=_pio.compareForChanges(g?{}:q._internal_("get-dbCurrent"),q,!0,!0);(g||0<r.length)&&
m.push({key:q._internal_("get-key"),table:q._internal_("get-table"),fulloverwrite:g,onlyifversion:e?q._internal_("get-version"):null,changes:r})}c.push({objects:h,changesets:m,fullOverwrite:g,useOptimisticLock:e,futureSaves:[],setIsSavingOnAll:function(v){for(var y=0;y!=this.objects.length;y++)this.objects[y]._internal_("set-is-saving",v)},done:function(){this.setIsSavingOnAll(!1);f()},execute:function(){var v=this;v.setIsSavingOnAll(!0);0<v.changesets.length?b.saveObjectChanges(_pio.LockType.LockAll,
v.changesets,n,k,function(y){v.done();_pio.handleError(y,l,y.code,y.message)},function(y){for(var D=0;D!=v.objects.length;D++){var u=v.objects[D];u._internal_("set-version",y.versions[D]);u._internal_("change-dbCurrent",v.changesets[D].changes);for(var B=0;B!=v.futureSaves.length;B++)for(var z=v.futureSaves[B],x=0;x<z.objects.length;x++)z.objects[x]==u&&(z.changesets.splice(x,1),z.objects.splice(x,1),x--)}v.done()}):(v.done(),setTimeout(k,1))}});f()}};_pio.databaseobject=function(b,f,a,d,c,e){var g=
{},h=!1;_pio.bigDBDeserialize(e,g,!0);this.table=f;this.key=a;this.existsInDatabase=!0;this.save=function(k,l,m,n){b.saveChanges(k,l,[this],m,n,c)};this._internal_=function(k,l){switch(k){case "get-table":return f;case "get-key":return a;case "set-is-saving":h=l;case "get-is-saving":return h;case "get-version":return d;case "set-version":d=l;case "get-dbCurrent":return g;case "change-dbCurrent":_pio.bigDBDeserialize(l,g,!0)}};_pio.bigDBDeserialize(e,this,!0)};_pio.compareForChanges=function(b,f,a,
d){var c=[],e;for(e in f){var g=f[e],h=b?b[e]:null;switch(e){case "table":if(d)continue;case "key":if(d)continue;case "save":if(d)continue;case "existsInDatabase":if(d)continue;case "_internal_":if(d)continue;case "_circular_reference_finder_":continue}if(null!=g){var k=a?{name:e}:{index:parseInt(e)};switch(typeof g){case "boolean":g!=h&&(k.value={valuetype:_pio.ValueType.Bool,bool:g},c.push(k));break;case "number":g!=h&&(isFinite(g)&&Math.floor(g)===g?k.value=-2147483648<=g&&2147483647>=g?{valuetype:_pio.ValueType.Int,
"int":g}:0<g&&4294967295>=g?{valuetype:_pio.ValueType.UInt,uint:g}:-0x7ffffffffffffc00<=g&&0x7ffffffffffffc00>=g?{valuetype:_pio.ValueType.Long,"long":g}:0<g&&1.844674407370955E19>=g?{valuetype:_pio.ValueType.ULong,ulong:g}:{valuetype:_pio.ValueType.Double,"double":g}:k.value={valuetype:_pio.ValueType.Double,"double":g},c.push(k));break;case "string":g!=h&&(k.value={valuetype:_pio.ValueType.String,string:g},c.push(k));break;case "object":if(g.getTime&&g.getMilliseconds)g+""!=h+""&&(k.value={valuetype:_pio.ValueType.DateTime,
datetime:g.getTime()},c.push(k));else{if(g._circular_reference_finder_)throw new PlayerIOError(PlayerIOErrorCode.CircularReference,"The object you're trying to save contains a circular reference for "+(a?"a property named":"the array entry")+"): "+e);g._circular_reference_finder_=!0;var l=g instanceof Array;if(l&&g.bytearray){l=Array(g.length);for(h=0;h!=l.length;h++){var m=g[h];if(0<=m&&255>=m)l[h]=m;else throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"The bytearray property '"+e+"' was supposed to only contain byte (0-255) values, but contained the value: "+
m);}k.value={valuetype:_pio.ValueType.ByteArray,bytearray:l}}else h=_pio.compareForChanges(h,g,!l,!1),k.value=l?{valuetype:_pio.ValueType.Array,arrayproperties:h}:{valuetype:_pio.ValueType.Obj,objectproperties:h};c.push(k);delete g._circular_reference_finder_}break;case "undefined":break;case "function":break;default:throw Error("Don't know how to serialize type '"+typeof g+"' for BigDB");}}}for(e in b)null!=f[e]&&"undefined"!=typeof f[e]||c.push(a?{name:e}:{index:parseInt(e)});return c};_pio.bigDBDeserialize=
function(b,f,a){for(var d in b){var c=b[d],e=a?c.name:c.index||0;if(c=c.value)switch(c.valuetype||0){case _pio.ValueType.String:f[e]=c.string||"";break;case _pio.ValueType.Int:f[e]=c["int"]||0;break;case _pio.ValueType.UInt:f[e]=c.uint||0;break;case _pio.ValueType.Long:f[e]=c["long"]||0;break;case _pio.ValueType.Bool:f[e]=c.bool||0;break;case _pio.ValueType.Float:f[e]=c["float"]||0;break;case _pio.ValueType.Double:f[e]=c["double"]||0;break;case _pio.ValueType.ByteArray:f[e]=c.bytearray;f[e].bytearray=
!0;break;case _pio.ValueType.DateTime:f[e]=new Date(c.datetime||0);break;case _pio.ValueType.Array:var g=f[e]instanceof Array?f[e]:[];_pio.bigDBDeserialize(c.arrayproperties,g,!1);f[e]=g;break;case _pio.ValueType.Obj:g="object"==typeof f[e]?f[e]:{},_pio.bigDBDeserialize(c.objectproperties,g,!0),f[e]=g}else delete f[e]}}})();
(function(){_pio.multiplayer=function(a){var d=this;this.developmentServer=null;this.useSecureConnections=!1;this.createRoom=function(c,e,g,h,k,l){a.createRoom(c,e,g,_pio.convertToKVArray(h),null!=d.developmentServer,k,l,function(m){return m.roomid})};this.joinRoom=function(c,e,g,h){clearTimeout(setTimeout(function(){g(new _pio.connection)},1E4));var k=Error();a.joinRoom(c,_pio.convertToKVArray(e),null!=d.developmentServer,function(){},h,function(l){return new _pio.connection(k,d.developmentServer,
d.useSecureConnections,l.endpoints,l.joinkey,e||{},g,h)})};this.createJoinRoom=function(c,e,g,h,k,l,m){clearTimeout(setTimeout(function(){l(new _pio.connection)},1E4));var n=Error();a.createJoinRoom(c,e,g,_pio.convertToKVArray(h),_pio.convertToKVArray(k),null!=d.developmentServer,function(){},m,function(p){return new _pio.connection(n,d.developmentServer,d.useSecureConnections,p.endpoints,p.joinkey,k||{},l,m)})};this.listRooms=function(c,e,g,h,k,l){a.listRooms(c,_pio.convertToKVArray(e),g,h,null!=
d.developmentServer,k,l,function(m){var n=[];if(m.rooms&&0<m.rooms.length)for(var p=0;p!=m.rooms.length;p++){var q=m.rooms[p];n.push(new _pio.roomInfo(q.id,q.roomtype,q.onlineusers,_pio.convertFromKVArray(q.roomdata)))}return n})}};_pio.websocketConnection=function(a,d,c,e,g,h,k){var l=this,m=!1,n=new _pio.messageSerializer,p=!1,q=null;d=(d?"wss://":"ws://")+c+"/";try{q="undefined"!=typeof MozWebSocket?new MozWebSocket(d):new WebSocket(d)}catch(v){g(!1,""+v);return}var r=setTimeout(function(){m||
(m=!0,g(!1,"Connect attempt timed out"))},e);q.onopen=function(){m||(clearTimeout(r),p=m=!0,g(p))};q.onclose=function(v){l.disconnect()};q.onerror=function(v){l.disconnect()};q.onmessage=function(v){if(p)if(a){var y=new FileReader;y.onloadend=function(){for(var D=new Uint8Array(y.result),u=Array(D.length),B=0;B!=D.length;B++)u[B]=D[B];k(n.deserializeMessage(u,0,u.length))};y.readAsArrayBuffer(v.data)}else v=_pio.base64decode(v.data),k(n.deserializeMessage(v,0,v.length))};this.disconnect=function(){if(p){p=
!1;h();try{q.close()}catch(v){_pio.debugLog(v)}}};this.sendMessage=function(v){v=n.serializeMessage(v);if(a){for(var y=new Uint8Array(v.length),D=0;D<v.length;D++)y[D]=v[D];q.send(y.buffer)}else v=_pio.base64encode(v),q.send(v)}};_pio.connection=function(a,d,c,e,g,h,k,l){function m(B){function z(){if(0<w.length){var A=w[0];w.splice(0,1);var P=B(c,A,4E3,function(K,M){if(K){y=P;n.connected=!0;var Q=n.createMessage("join");Q.addString(g);if(null!=h)for(var U in h)Q.addString(U),Q.addString(""+h[U]);
n.sendMessage(Q)}else _pio.debugLog("Unable to connect to endpoint: "+A+'. reason: "'+M+(0<w.length?'". Trying next endpoint.':'". No more endpoints to try.')),z()},function(K){n.connected&&(n.connected=!1,setTimeout(function(){for(var M=0;M!=q.length;M++)_pio.runCallback(q[M].callback,n,q[M].stackSource)},100))},function(K){p?"playerio.joinresult"==K.type?(p=!1,K.getBoolean(0)?_pio.runCallback(k,n,null):_pio.handleError(a,l,K.getInt(1),K.getString(2))):_pio.handleError(a,l,PlayerIOErrorCode.GeneralError,
"The expected inital messagetype is: playerio.joinresult, received: "+joinResult.getType()):(x(K.type,K),x("*",K))})}else _pio.handleError(a,l,PlayerIOErrorCode.GeneralError,"Could not establish a socket connection to any of the given endpoints for the room")}function x(A,P){var K=r[A];if(K)for(var M=0;M<K.length;M++)_pio.runCallback(K[M].callback,P,K[M].stackSource)}var w=[];if(d)w.push(d);else for(var F=0;F!=e.length;F++)w.push(e[F].address+":"+e[F].port);z()}var n=this,p=!0,q=[],r={},v=[],y=null,
D=/(WebKit|Firefox|Trident)\/([0-9]+)/gi.exec(navigator.userAgent),u=D&&3<=D.length?D[1]:null;D=D&&3<=D.length?parseInt(D[2]):null;window.FileReader&&"WebKit"==u&&535<=D||"Firefox"==u&&11<=D||"Trident"==u&&6<=D?m(function(B,z,x,w,F,A){return new _pio.websocketConnection(!0,B,z,x,w,F,A)}):_pio.isFlashFallbackEnabled(function(B){B?m(function(z,x,w,F,A,P){return new _pio.flashSocketConnection(x,w,F,A,P)}):m(function(z,x,w,F,A,P){return new _pio.websocketConnection(!1,z,x,w,F,A,P)})});this.connected=
!1;this.addDisconnectCallback=function(B){q.push({callback:B,stackSourc:Error()})};this.addMessageCallback=function(B,z){null==B&&(B="*");var x=r[B];x||(r[B]=x=[]);x.push({callback:z,stackSource:Error()})};this.removeDisconnectCallback=function(B){for(var z=0;z<q.length;z++)q[z].callback==B&&(q.splice(z,1),z--)};this.removeMessageCallback=function(B){for(var z in r)for(var x=r[z],w=0;w<x.length;w++)x[w].callback==B&&(x.splice(w,1),w--)};this.createMessage=function(B){for(var z=new _pio.message(B),
x=1;x<arguments.length;x++)z.add(arguments[x]);return z};this.send=function(B){var z=this.createMessage.apply(this,arguments);this.sendMessage(z)};this.sendMessage=function(B){n.connected?y.sendMessage(B):v.push(B)};this.disconnect=function(){n.connected&&y.disconnect()}};_pio.message=function(a){function d(m,n,p,q){if(m)l.push(n),k.push(p),h.length=l.length;else throw _pio.error("The given value ("+n+") is not "+q);}function c(m,n){if(m>l.length)throw _pio.error("this message ("+h.type+") only has "+
l.length+" entries");if(k[m]==n)return l[m];throw _pio.error("Value at index:"+m+" is a "+e(k[m])+" and not a "+e(n)+" as requested. The value is: "+l[m]);}function e(m){return{0:"Integer",1:"Unsigned Integer",2:"Long",3:"Unsigned Long",4:"Double",5:"Float",6:"String",7:"ByteArray",8:"Boolean"}[m]}function g(m){var n="object"==typeof m&&"undefined"!=typeof m.length;if(n)for(var p=0;p!=m.length;p++)if(255<m[p]||0>m[p]){n=!1;break}return n}var h=this,k=[],l=[];this.type=a;this.length=0;this.add=function(){for(var m=
0;m<arguments.length;m++){var n=arguments[m];switch(typeof n){case "string":h.addString(n);break;case "boolean":h.addBoolean(n);break;case "number":if(isFinite(n)&&Math.floor(n)===n)if(-2147483648<=n&&2147483647>=n){h.addInt(n);break}else if(0<n&&4294967295>=n){h.addUInt(n);break}else if(-0x7ffffffffffffc00<=n&&0x7ffffffffffffc00>=n){h.addLong(n);break}else if(0<n&&1.844674407370955E19>=n){h.addULong(n);break}h.addDouble(n);break;case "object":if(g(n)){this.addByteArray(n);break}default:throw _pio.error("The type of the value ("+
n+") cannot be inferred");}}};this.addInt=function(m){d(-2147483648<=m&&2147483647>=m,Math.trunc(m),0,"an integer (32bit)")};this.addUInt=function(m){d(0<=m&&4294967295>=m,Math.trunc(m),1,"an unsigned integer (32bit)")};this.addLong=function(m){d(-0x7ffffffffffffc00<=m&&0x7ffffffffffffc00>=m,Math.trunc(m),2,"a long (64bit)")};this.addULong=function(m){d(0<=m&&1.844674407370955E19>=m,m,3,"an unsigned long (64bit)")};this.addBoolean=function(m){d(!0,m?!0:!1,8,"a boolean value")};this.addFloat=function(m){d(!0,
Number(m),5,"a floating point value (32bit)")};this.addDouble=function(m){d(!0,Number(m),4,"a double floating point value (64bit)")};this.addByteArray=function(m){d(g(m),m,7,"a bytearray")};this.addString=function(m){d(!0,m+"",6,"a string")};this.getInt=function(m){return c(m,0)};this.getUInt=function(m){return c(m,1)};this.getLong=function(m){return c(m,2)};this.getULong=function(m){return c(m,3)};this.getBoolean=function(m){return c(m,8)};this.getDouble=function(m){return c(m,4)};this.getFloat=
function(m){return c(m,5)};this.getByteArray=function(m){return c(m,7)};this.getString=function(m){return c(m,6)};this.toString=function(){for(var m="msg.Type = "+this.type,n=0;n!=this.length;n++)m+=", msg["+n+"] = "+l[n]+" ("+e(k[n])+")";return m};this._internal_=function(m,n){switch(m){case "get-objects":return l;case "get-types":return k}}};_pio.roomInfo=function(a,d,c,e){this.id=a;this.roomType=d;this.onlineUsers=c;this.roomData=e};_pio.byteWriter=function(){this.bytes=[];this.writeByte=function(a){if(0<=
a&&255>=a)this.bytes.push(a);else throw Error("This is not a byte value: "+a);};this.writeBytes=function(a){for(var d=0;d!=a.length;d++)this.writeByte(a[d])};this.writeTagWithLength=function(a,d,c){63<a||0>a?this.writeBottomPatternAndBytes(c,_pio.binaryserializer.bytesFromInt(a)):this.writeByte(d|a)};this.writeBottomPatternAndBytes=function(a,d){var c=0;0!=d[0]?c=3:0!=d[1]?c=2:0!=d[2]&&(c=1);this.writeByte(a|c);for(c=d.length-c-1;c!=d.length;c++)this.writeByte(d[c])};this.writeLongPattern=function(a,
d,c){for(var e=0,g=0;7!=g;g++)if(0!=c[g]){e=7-g;break}3<e?this.writeByte(d|e-4):this.writeByte(a|e);for(g=c.length-e-1;g!=c.length;g++)this.writeByte(c[g])}};_pio.messageSerializer=function(){this.serializeMessage=function(a){var d=new _pio.byteWriter;d.writeTagWithLength(a.length,128,4);var c=_pio.binaryserializer.bytesFromString(a.type);d.writeTagWithLength(c.length,192,12);d.writeBytes(c);for(var e=0;e!=a.length;e++)switch(c=a._internal_("get-objects")[e],a._internal_("get-types")[e]){case 6:c=
_pio.binaryserializer.bytesFromString(c);d.writeTagWithLength(c.length,192,12);d.writeBytes(c);break;case 0:d.writeTagWithLength(c,128,4);break;case 1:d.writeBottomPatternAndBytes(8,_pio.binaryserializer.bytesFromUInt(c));break;case 2:d.writeLongPattern(48,52,_pio.binaryserializer.bytesFromLong(c));break;case 3:d.writeLongPattern(56,60,_pio.binaryserializer.bytesFromULong(c));break;case 7:d.writeTagWithLength(c.length,64,16);d.writeBytes(c);break;case 4:d.writeByte(3);d.writeBytes(_pio.binaryserializer.bytesFromDouble(c));
break;case 5:d.writeByte(2);c=_pio.binaryserializer.bytesFromFloat(c);d.writeBytes(c);break;case 8:d.writeByte(c?1:0)}return d.bytes};this.deserializeMessage=function(a,d,c){var e=d;d+=c;c=null;for(var g=0;e<d;){var h=0,k=0,l=a[e];e++;var m=l&192;0==m&&(m=l&60,0==m&&(m=l));switch(m){case 12:case 16:h=(l&3)+1;if(e+h>d)throw Error("Unexpected: Unfinished message");l=h;h=_pio.binaryserializer.intFromBytes(a,e,h);e+=l;break;case 192:h=l&63;break;case 128:k=l&63;break;case 64:h=l&63;break;case 4:case 8:case 48:case 56:h=
(l&3)+1;break;case 52:case 60:h=(l&3)+5;break;case 3:h=8;break;case 2:h=4}if(e+h>d)throw Error("Unexpected: Unfinished message");switch(m){case 12:case 192:null==c?(c=new _pio.message(_pio.binaryserializer.stringFromBytes(a,e,h)),g++):c.addString(_pio.binaryserializer.stringFromBytes(a,e,h));break;case 4:k=_pio.binaryserializer.intFromBytes(a,e,h);case 128:0==g?g=k:c.addInt(k);break;case 16:case 64:c.addByteArray(a.slice(e,e+h));break;case 8:c.addUInt(_pio.binaryserializer.uintFromBytes(a,e,h));break;
case 48:case 52:c.addLong(_pio.binaryserializer.longFromBytes(a,e,h));break;case 56:case 60:c.addULong(_pio.binaryserializer.ulongFromBytes(a,e,h));break;case 3:c.addDouble(_pio.binaryserializer.doubleFromBytes(a,e,h));break;case 2:c.addFloat(_pio.binaryserializer.floatFromBytes(a,e,h));break;case 1:c.addBoolean(!0);break;case 0:c.addBoolean(!1)}e+=h;if(null!=c&&0==--g)return c}throw Error("Unexpected: Misaligned message");}};_pio.binaryserializer={pow2:function(a){return 0<=a&&31>a?1<<a:this.pow2[a]||
(this.pow2[a]=Math.pow(2,a))},_intEncode:function(a,d){if(4==d)var c=[a>>>24&255,a>>>16&255,a>>>8&255,a&255];else{if(0<=a){c=Math.floor(a/this.pow2(32));var e=a-c*this.pow2(32)}else c=Math.floor(a/this.pow2(32)),e=a-c*this.pow2(32),c+=this.pow2(32);c=[c>>>24&255,c>>>16&255,c>>>8&255,c&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255]}return c},_floatEncode:function(a,d,c){var e=0>a?1:0,g,h=~(-1<<c-1),k=1-h;0>a&&(a=-a);0===a?a=g=0:isNaN(a)?(g=2*h+1,a=1):Infinity===a?(g=2*h+1,a=0):(g=Math.floor(Math.log(a)/
Math.LN2),g>=k&&g<=h?(a=Math.floor((a*this.pow2(-g)-1)*this.pow2(d)),g+=h):(a=Math.floor(a/this.pow2(k-d)),g=0));for(h=[];8<=d;)h.push(a%256),a=Math.floor(a/256),d-=8;g=g<<d|a;for(c+=d;8<=c;)h.push(g&255),g>>>=8,c-=8;h.push(e<<c|g);h.reverse();return h},bytesFromString:function(a){for(var d=[],c=0;c<a.length;c++)if(127>=a.charCodeAt(c))d.push(a.charCodeAt(c));else for(var e=encodeURIComponent(a.charAt(c)).substr(1).split("%"),g=0;g<e.length;g++)d.push(parseInt(e[g],16));return d},bytesFromInt:function(a){return this._intEncode(a,
4)},bytesFromUInt:function(a){return this._intEncode(a,4)},bytesFromLong:function(a){return this._intEncode(a,8)},bytesFromULong:function(a){return this._intEncode(a,8)},bytesFromFloat:function(a){return this._floatEncode(a,23,8)},bytesFromDouble:function(a){return this._floatEncode(a,52,11)},_intDecode:function(a,d,c,e,g){var h=d+c-1;d=g&&c==e&&a[d]&128;e=0;g=1;for(var k=0;k<c;k++){var l=a[h-k];d&&(l=(l^255)+g,g=l>>8,l&=255);e+=l*this.pow2(8*k)}return d?-e:e},_float32Decode:function(a,d){var c=a.slice(d,
d+4).reverse(),e=1-2*(c[3]>>7),g=(c[3]<<1&255|c[2]>>7)-127;c=(c[2]&127)<<16|c[1]<<8|c[0];return 128===g?0!==c?NaN:Infinity*e:-127===g?e*c*this.pow2(-149):e*(1+c*this.pow2(-23))*this.pow2(g)},_float64Decode:function(a,d){var c=a.slice(d,d+8).reverse(),e=1-2*(c[7]>>7),g=((c[7]<<1&255)<<3|c[6]>>4)-1023;c=(c[6]&15)*this.pow2(48)+c[5]*this.pow2(40)+c[4]*this.pow2(32)+c[3]*this.pow2(24)+c[2]*this.pow2(16)+c[1]*this.pow2(8)+c[0];return 1024===g?0!==c?NaN:Infinity*e:-1023===g?e*c*this.pow2(-1074):e*(1+c*
this.pow2(-52))*this.pow2(g)},stringFromBytes:function(a,d,c){for(var e="",g=d;g<d+c;g++)e+=127>=a[g]?37===a[g]?"%25":String.fromCharCode(a[g]):"%"+a[g].toString(16).toUpperCase();return decodeURIComponent(e)},intFromBytes:function(a,d,c){return this._intDecode(a,d,c,4,!0)},uintFromBytes:function(a,d,c){return this._intDecode(a,d,c,4,!1)},longFromBytes:function(a,d,c){return this._intDecode(a,d,c,8,!0)},ulongFromBytes:function(a,d,c){return this._intDecode(a,d,c,8,!1)},floatFromBytes:function(a,d,
c){return 4==c?this._float32Decode(a,d):NaN},doubleFromBytes:function(a,d,c){return 8==c?this._float64Decode(a,d):NaN}};for(var b=[],f=0;65!=f;f++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(f)]=f;_pio.base64encode=function(a){for(var d=[],c=0;c<a.length;c++){var e=a[c],g=++c<=a.length?a[c]:NaN,h=++c<=a.length?a[c]:NaN,k=e>>2;e=(e&3)<<4|g>>4;var l=(g&15)<<2|h>>6,m=h&63;isNaN(g)?l=m=64:isNaN(h)&&(m=64);d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k));
d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m))}return d.join("")};_pio.base64decode=function(a){for(var d=[],c=0;c<a.length;c++){var e=b[a.charCodeAt(c)],g=++c<a.length?b[a.charCodeAt(c)]:64,h=++c<a.length?b[a.charCodeAt(c)]:64,k=++c<a.length?b[a.charCodeAt(c)]:64,l=(g&15)<<4|h>>2,m=(h&3)<<
6|k;d.push(e<<2|g>>4);64!=h&&(d.push(l),64!=k&&d.push(m))}return d}})();
(function(){_pio.achievements=function(b){function f(c,e){var g=new _pio.achievement(c.identifier,c.title,c.description,c.imageurl,c.progress,c.progressgoal,c.lastupdated);if("string"!==typeof d.myAchievements)for(var h=0;h<d.myAchievements.length;h++)d.myAchievements[h].id==g.id&&(d.myAchievements[h]=g,d.currentVersion=null);if(e)for(h=0;h<d.onCompleteHandlers.length;h++)(0,d.onCompleteHandlers[h])(g);return g}var a=null;this.myAchievements="[ERROR: You tried to access achievements.myAchievements before loading them. You have to call the refresh method first.]";
this.onCompleteHandlers=[];var d=this;this.addOnComplete=function(c){if("function"===typeof c&&1==c.length)d.onCompleteHandlers.push(c);else throw new PlayerIOError(PlayerIOErrorCode.InvalidArgument,"Expects argument to be a function that takes an achievement as an argument.");};this.get=function(c){if("string"===typeof d.myAchievements)return null;for(var e=0;e<d.myAchievements.length;e++)if(d.myAchievements[e].id==c)return d.myAchievements[e];return null};this.refresh=function(c,e){b.achievementsRefresh(a,
c,e,function(g){if(a!=g.version)if(a=g.version,null==g.achievements||0==g.achievements.length)d.myAchievements=[];else{for(var h=[],k=0;k<g.achievements.length;k++){var l=g.achievements[k];h.push(new _pio.achievement(l.identifier,l.title,l.description,l.imageurl,l.progress,l.progressgoal,l.lastupdated))}d.myAchievements=h}})};this.load=function(c,e,g){"object"==typeof c||requests.length?b.achievementsLoad(c,e,g,function(h){if(null==h||0==h.length)return{};for(var k={},l=0;l<h.userachievements.length;l++){for(var m=
h.userachievements[l],n=[],p=0;p<m.achievements.length;p++){var q=m.achievements[p];n.push(new _pio.achievement(q.identifier,q.title,q.description,q.imageurl,q.progress,q.progressgoal,q.lastupdated))}k[m.userid]=n}return k}):(c=_pio.error("The first argument to load should be an array: client.achievements.load(['user1', 'user2', ...], ...)"),_pio.handleError(c,g,c.code,c.message))};this.progressSet=function(c,e,g,h){b.achievementsProgressSet(c,e,g,h,function(k){return f(k.achievement,k.completednow)})};
this.progressAdd=function(c,e,g,h){b.achievementsProgressAdd(c,e,g,h,function(k){return f(k.achievement,k.completednow)})};this.progressMax=function(c,e,g,h){b.achievementsProgressMax(c,e,g,h,function(k){return f(k.achievement,k.completednow)})};this.progressComplete=function(c,e,g){b.achievementsProgressComplete(c,e,g,function(h){return f(h.achievement,h.completednow)})}};_pio.achievement=function(b,f,a,d,c,e,g){this.id=b;this.title=f;this.description=a;this.imageUrl=d;this.progress="undefined"===
typeof c?0:c;this.progressGoal=e;this.lastUpdated=new Date(1E3*g);this.progressRatio=this.progress/this.progressGoal;this.completed=this.progress==this.progressGoal}})();
(function(){_pio.playerInsight=function(b){function f(d){a.playersOnline=-1==d.playersonline?"[ERROR: The current connection does not have the rights required to read the playersonline variable.]":d.playersonline;a.segments=_pio.convertFromKVArray(d.segments)}this.playersOnline="[ERROR: You tried to access playerInsight.playersOnline before loading it. You have to call the refresh method first.]";this.segments={};var a=this;this.refresh=function(d,c){b.playerInsightRefresh(d,c,function(e){f(e.state)})};
this.setSegments=function(d,c,e){b.playerInsightSetSegments(_pio.convertToSegmentArray(d),c,e,function(g){f(g.state)})};this.trackInvitedBy=function(d,c,e,g){b.playerInsightTrackInvitedBy(d,c,e,g,function(h){})};this.trackEvent=function(d,c,e,g){b.playerInsightTrackEvents([{eventtype:d,value:c}],e,g,function(h){})};this.trackExternalPayment=function(d,c,e,g){b.playerInsightTrackExternalPayment(d,c,e,g,function(h){})};this.sessionKeepAlive=function(d,c){b.playerInsightSessionKeepAlive(d,c,function(e){})}}})();
(function(){_pio.oneScore=function(b){this.percentile="[ERROR: You tried to access oneScore.percentile before loading the OneScore. You have to call the refresh method first.]";this.score="[ERROR: You tried to access oneScore.score before loading the OneScore. You have to call the refresh method first.]";this.topRank="[ERROR: You tried to access oneScore.topRank before loading the OneScore. You have to call the refresh method first.]";var f=this;this.refresh=function(a,d){b.oneScoreRefresh(a,d,function(c){c=
new _pio.oneScoreValue(c.onescore.percentile,c.onescore.score,c.onescore.toprank);f.percentile=c.percentile;f.score=c.score;f.topRank=c.toprank})};this.set=function(a,d,c){b.oneScoreSet(a,d,c,function(e){e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank);f.percentile=e.percentile;f.score=e.score;f.topRank=e.toprank;return e})};this.add=function(a,d,c){b.oneScoreAdd(a,d,c,function(e){e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank);
f.percentile=e.percentile;f.score=e.score;f.topRank=e.toprank;return e})};this.load=function(a,d,c){if("object"==typeof a||requests.length)b.oneScoreLoad(a,d,c,function(e){if(null==e||null==e.onescores||0==e.onescores.length)return[];for(var g=[],h=0,k=0;k<a.length;k++){var l=e.onescores[h];l&&a[k]==l.userid?(g.push(new _pio.oneScoreValue(l.percentile,l.score,l.toprank)),h++):g.push(null)}return g});else d=_pio.error("The first argument to load should be an array: client.oneScore.load(['user1', 'user2', ...], ...)"),
_pio.handleError(d,c,d.code,d.message)}};_pio.oneScoreValue=function(b,f,a){this.percentile="undefined"===typeof b?0:b;this.score="undefined"===typeof f?0:f;this.topRank="undefined"===typeof a?0:a}})();
(function(){_pio.notifications=function(b){function f(e){if(e.version!=c){var g=[];if(e.endpoints)for(var h=0;h!=e.endpoints.length;h++){var k=e.endpoints[h];g[h]=new _pio.notificationEndpoint(k.type,k.identifier,_pio.convertFromKVArray(k.configuration),k.enabled?!0:!1)}c=e.version;d.myEndpoints=g}}function a(e){var g=[];if(e&&0<e.length)for(var h=0;h!=e.length;h++){var k=e[h];k.type&&k.identifier&&g.push({type:k.type,identifier:k.identifier})}return g}this.myEndpoints="[ERROR: You tried to access notifications.myEndpoints before calling refresh.]";
var d=this,c="";this.refresh=function(e,g){b.notificationsRefresh(c,e,g,f)};this.registerEndpoint=function(e,g,h,k,l,m){var n;a:{if(""!=c)for(n=0;n!=d.myEndpoints.length;n++){var p=d.myEndpoints[n];if(p.type==e&&p.identifier==g){n=p;break a}}n=null}(p=null==n||n.enabled!=k)||(p=JSON.stringify(n.configuration)!=JSON.stringify(h));p?b.notificationsRegisterEndpoints(c,[{type:e,identifier:g,configuration:_pio.convertToKVArray(h),enabled:k}],l,m,f):l&&l()};this.toggleEndpoints=function(e,g,h,k){e=a(e);
0<e.length?b.notificationsToggleEndpoints(c,e,g?!0:!1,h,k,f):h&&h()};this.deleteEndpoints=function(e,g,h){e=a(e);0<e.length?b.notificationsDeleteEndpoints(c,e,g,h,f):g&&g()};this.send=function(e,g,h){for(var k=[],l=0;l!=e.length;l++){var m=e[l],n={recipient:m.recipientUserId,endpointtype:m.endpointType,data:{}};0!=(n.recipient+"").length&&0!=(n.endpointtype+"").length||console.log("error");for(var p in m)"recipientUserId"!=p&&"endpointType"!=p&&(n.data[p]=m[p]);k[l]=n}0<k.length?b.notificationsSend(k,
g,h,null):g&&g()}};_pio.notificationEndpoint=function(b,f,a,d){this.type=b;this.identifier=f;this.configuration=a;this.enabled=d}})();
(function(){_pio.publishingNetwork=function(b,f){var a=this;this.profiles=new _pio.publishingNetworkProfiles(b);this.payments=new _pio.publishingNetworkPayments(b);this.relations=new _pio.publishingNetworkRelations(b,f,this);this.userToken="[ERROR: you tried to access publishingNetwork.userToken before calling publishingNetwork.refresh(callback)]";this.refresh=function(d,c){b.socialRefresh(d,c,function(e){a.userToken=e.myprofile.usertoken;a.profiles.myProfile=new _pio.publishingNetworkProfile(e.myprofile);
"undefined"==typeof _pio.friendLookup&&(_pio.friendLookup={},_pio.blockedLookup={});var g=_pio.friendLookup[a.profiles.myProfile.userId],h=_pio.blockedLookup[a.profiles.myProfile.userId];g||h||(g=_pio.friendLookup[a.profiles.myProfile.userId]={},h=_pio.blockedLookup[a.profiles.myProfile.userId]={});a.relations.friends=[];for(var k=0;k!=e.friends.length;k++){var l=new _pio.publishingNetworkProfile(e.friends[k]);a.relations.friends.push(l);g[l.userId]=!0}for(k=0;k!=e.blocked.length;k++)h[e.blocked[k]]=
!0})}};_pio.showDialog=function(b,f,a,d){if("undefined"==typeof window.PublishingNetwork)throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotAvailable,"PublishingNetwork.js was not found on the current page. You have to include the 'piocdn.com/publishingnetwork.js' on the containing page to show dialogs. See http://playerio.com/documentation/ for more information.");a.__apitoken__=f.token;window.PublishingNetwork.dialog(b,a,d)}})();
(function(){_pio.publishingNetworkPayments=function(b){this.showBuyCoinsDialog=function(f,a,d,c){a||(a={});a.coinamount=f;b.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(a),null,function(e){_pio.showDialog("buy",b,e,function(g){g.error?c(new PlayerIOError(PlayerIOErrorCode.GeneralError,g.error)):d(g)})},c,function(e){return _pio.convertFromKVArray(e.providerarguments)})};this.showBuyItemsDialog=function(f,a,d,c){b.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(a||{}),
_pio.convertBuyItems(f),function(e){_pio.showDialog("buy",b,e,function(g){g.error?c(new PlayerIOError(PlayerIOErrorCode.GeneralError,g.error)):d(g)})},c,function(e){return _pio.convertFromKVArray(e.providerarguments)})}}})();
(function(){_pio.publishingNetworkProfiles=function(b){this.myProfile="[ERROR: you tried to access publishingNetworkProfiles.myProfile before calling publishingNetwork.refresh(callback)]";this.showProfile=function(f,a){_pio.showDialog("profile",b,{userId:f},a)};this.loadProfiles=function(f,a,d){b.socialLoadProfiles(f,a,d,function(c){for(var e=[],g=0;g!=f.length;g++){var h=f[g];e[g]=null;for(var k=0;k!=c.profiles.length;k++){var l=c.profiles[k];if(l&&l.userid==h){e[g]=new _pio.publishingNetworkProfile(c.profiles[k]);
break}}}return e})}};_pio.publishingNetworkProfile=function(b){this.userId=b.userid;this.displayName=b.displayname;this.avatarUrl=b.avatarurl;this.lastOnline=new Date(b.lastonline);this.countryCode=b.countrycode}})();
(function(){_pio.publishingNetworkRelations=function(b,f,a){this.friends="[ERROR: you tried to access publishingNetworkRelations.friends before calling publishingNetwork.refresh(callback)]";this.isFriend=function(d){if("undefined"!=typeof _pio.friendLookup&&"undefined"!=typeof _pio.friendLookup[f])return _pio.friendLookup[f][d]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");
};this.isBlocked=function(d){if("undefined"!=typeof _pio.blockedLookup&&"undefined"!=typeof _pio.blockedLookup[f])return _pio.blockedLookup[f][d]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");};this.showRequestFriendshipDialog=function(d,c){_pio.showDialog("requestfriendship",b,{userId:d},c)};this.showRequestBlockUserDialog=function(d,c){_pio.showDialog("requestblockuser",
b,{userId:d},function(){a.refresh(function(){c&&c()},function(){c&&c()})})};this.showFriendsManager=function(d){_pio.showDialog("friendsmanager",b,{},function(c){c.updated?a.refresh(function(){d&&d()},function(){d&&d()}):d&&d()})};this.showBlockedUsersManager=function(d){_pio.showDialog("blockedusersmanager",b,{},function(c){c.updated?a.refresh(function(){d&&d()},function(){d&&d()}):d&&d()})}}})();
(function(){var b="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},f="undefined"!==typeof module&&module.exports,a="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,d=function(){for(var g,h=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],k=0,l=h.length,m={};k<l;k++)if((g=h[k])&&g[1]in b){for(k=0;k<g.length;k++)m[h[0][k]]=
g[k];return m}return!1}(),c={change:d.fullscreenchange,error:d.fullscreenerror},e={request:function(g){var h=d.requestFullscreen;g=g||b.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))g[h]();else g[h](a&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){b[d.exitFullscreen]()},toggle:function(g){this.isFullscreen?this.exit():this.request(g)},onchange:function(g){this.on("change",g)},onerror:function(g){this.on("error",g)},on:function(g,h){var k=c[g];k&&b.addEventListener(k,h,!1)},off:function(g,
h){var k=c[g];k&&b.removeEventListener(k,h,!1)},raw:d};d?(Object.defineProperties(e,{isFullscreen:{get:function(){return!!b[d.fullscreenElement]}},element:{enumerable:!0,get:function(){return b[d.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!b[d.fullscreenEnabled]}}}),f?module.exports=e:window.screenfull=e):f?module.exports=!1:window.screenfull=!1})();
(function(){function b(u){u=String(u);return u.charAt(0).toUpperCase()+u.slice(1)}function f(u,B){var z=-1,x=u?u.length:0;if("number"==typeof x&&-1<x&&x<=q)for(;++z<x;)B(u[z],z,u);else d(u,B)}function a(u){u=String(u).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(u)?u:b(u)}function d(u,B){for(var z in u)v.call(u,z)&&B(u[z],z,u)}function c(u){return null==u?b(u):y.call(u).slice(8,-1)}function e(u,B){var z=null!=u?typeof u[B]:"number";return!/^(?:boolean|number|string|undefined)$/.test(z)&&
("object"==z?!!u[B]:!0)}function g(u){return String(u).replace(/([ -])(?!$)/g,"$1?")}function h(u,B){var z=null;f(u,function(x,w){z=B(z,x,w,u)});return z}function k(u){function B(L){return h(L,function(J,I){var N=I.pattern||g(I);!J&&(J=RegExp("\\b"+N+" *\\d+[.\\w_]*","i").exec(u)||RegExp("\\b"+N+" *\\w+-[\\w]*","i").exec(u)||RegExp("\\b"+N+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(u))&&((J=String(I.label&&!RegExp(N,"i").test(I.label)?I.label:J).split("/"))[1]&&!/[\d.]+/.test(J[0])&&(J[0]+=
" "+J[1]),I=I.label||I,J=a(J[0].replace(RegExp(N,"i"),I).replace(RegExp("; *(?:"+I+"[_-])?","i")," ").replace(RegExp("("+I+")[-_.]?(\\w)","i"),"$1 $2")));return J})}function z(L){return h(L,function(J,I){return J||(RegExp(I+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(u)||0)[1]||null})}var x=m,w=u&&"object"==typeof u&&"String"!=c(u);w&&(x=u,u=null);var F=x.navigator||{},A=F.userAgent||"";u||(u=A);var P=w?!!F.likeChrome:/\bChrome\b/.test(u)&&!/internal|\n/i.test(y.toString()),
K=w?"Object":"ScriptBridgingProxyObject",M=w?"Object":"Environment",Q=w&&x.java?"JavaPackage":c(x.java),U=w?"Object":"RuntimeObject";M=(Q=/\bJava/.test(Q)&&x.java)&&c(x.environment)==M;var ca=Q?"a":"\u03b1",da=Q?"b":"\u03b2",Y=x.document||{},S=x.operamini||x.opera,V=r.test(V=w&&S?S["[[Class]]"]:c(S))?V:S=null,t,W=u;w=[];var X=null,T=u==A;A=T&&S&&"function"==typeof S.version&&S.version();var G=function(L){return h(L,function(J,I){return J||RegExp("\\b"+(I.pattern||g(I))+"\\b","i").exec(u)&&(I.label||
I)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),C=function(L){return h(L,function(J,I){return J||RegExp("\\b"+(I.pattern||g(I))+"\\b","i").exec(u)&&(I.label||I)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),H=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),O=function(L){return h(L,function(J,I,N){return J||(I[H]||I[/^[a-z]+(?: +[a-z]+\b)*/i.exec(H)]||RegExp("\\b"+g(N)+"(?:\\b|\\w*\\d)","i").exec(u))&&N})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),E=function(L){return h(L,function(J,I){var N=I.pattern||g(I);if(!J&&(J=RegExp("\\b"+N+"(?:/[\\d.]+|[ \\w.]*)","i").exec(u))){var R=J,Z=I.label||I,aa={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};N&&Z&&/^Win/i.test(R)&&!/^Windows Phone /i.test(R)&&(aa=aa[/[\d.]+$/.exec(R)])&&(R="Windows "+aa);R=String(R);N&&Z&&(R=R.replace(RegExp(N,"i"),Z));J=R=a(R.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return J})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);G&&(G=[G]);O&&!H&&(H=B([O]));if(t=/\bGoogle TV\b/.exec(H))H=t[0];/\bSimulator\b/i.test(u)&&(H=(H?H+" ":"")+"Simulator");"Opera Mini"==C&&/\bOPiOS\b/.test(u)&&w.push("running in Turbo/Uncompressed mode");"IE"==C&&/\blike iPhone OS\b/.test(u)?(t=k(u.replace(/like iPhone OS/,"")),O=t.manufacturer,H=t.product):/^iP/.test(H)?(C||(C="Safari"),E="iOS"+((t=/ OS ([\d_]+)/i.exec(u))?" "+t[1].replace(/_/g,"."):"")):"Konqueror"!=C||/buntu/i.test(E)?O&&"Google"!=O&&(/Chrome/.test(C)&&
!/\bMobile Safari\b/i.test(u)||/\bVita\b/.test(H))||/\bAndroid\b/.test(E)&&/^Chrome/.test(C)&&/\bVersion\//i.test(u)?(C="Android Browser",E=/\bAndroid\b/.test(E)?E:"Android"):"Silk"==C?(/\bMobi/i.test(u)||(E="Android",w.unshift("desktop mode")),/Accelerated *= *true/i.test(u)&&w.unshift("accelerated")):"PaleMoon"==C&&(t=/\bFirefox\/([\d.]+)\b/.exec(u))?w.push("identifying as Firefox "+t[1]):"Firefox"==C&&(t=/\b(Mobile|Tablet|TV)\b/i.exec(u))?(E||(E="Firefox OS"),H||(H=t[1])):!C||(t=!/\bMinefield\b/i.test(u)&&
/\b(?:Firefox|Safari)\b/.exec(C))?(C&&!H&&/[\/,]|^[^(]+?\)/.test(u.slice(u.indexOf(t+"/")+8))&&(C=null),(t=H||O||E)&&(H||O||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(E))&&(C=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(E)?E:t)+" Browser")):"Electron"==C&&(t=(/\bChrome\/([\d.]+)\b/.exec(u)||0)[1])&&w.push("Chromium "+t):E="Kubuntu";A||(A=z(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",g(C),"(?:Firefox|Minefield|NetFront)"]));
if(t="iCab"==G&&3<parseFloat(A)&&"WebKit"||/\bOpera\b/.test(C)&&(/\bOPR\b/.test(u)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(u)&&!/^(?:Trident|EdgeHTML)$/.test(G)&&"WebKit"||!G&&/\bMSIE\b/i.test(u)&&("Mac OS"==E?"Tasman":"Trident")||"WebKit"==G&&/\bPlayStation\b(?! Vita\b)/i.test(C)&&"NetFront")G=[t];"IE"==C&&(t=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(u)||0)[1])?(C+=" Mobile",E="Windows Phone "+(/\+$/.test(t)?t:t+".x"),w.unshift("desktop mode")):/\bWPDesktop\b/i.test(u)?(C="IE Mobile",E="Windows Phone 8.x",
w.unshift("desktop mode"),A||(A=(/\brv:([\d.]+)/.exec(u)||0)[1])):"IE"!=C&&"Trident"==G&&(t=/\brv:([\d.]+)/.exec(u))&&(C&&w.push("identifying as "+C+(A?" "+A:"")),C="IE",A=t[1]);if(T){if(e(x,"global"))if(Q&&(t=Q.lang.System,W=t.getProperty("os.arch"),E=E||t.getProperty("os.name")+" "+t.getProperty("os.version")),M){try{A=x.require("ringo/engine").version.join("."),C="RingoJS"}catch(L){(t=x.system)&&t.global.system==x.system&&(C="Narwhal",E||(E=t[0].os||null))}C||(C="Rhino")}else"object"==typeof x.process&&
!x.process.browser&&(t=x.process)&&("object"==typeof t.versions&&("string"==typeof t.versions.electron?(w.push("Node "+t.versions.node),C="Electron",A=t.versions.electron):"string"==typeof t.versions.nw&&(w.push("Chromium "+A,"Node "+t.versions.node),C="NW.js",A=t.versions.nw)),C||(C="Node.js",W=t.arch,E=t.platform,A=(A=/[\d.]+/.exec(t.version))?A[0]:null));else c(t=x.runtime)==K?(C="Adobe AIR",E=t.flash.system.Capabilities.os):c(t=x.phantom)==U?(C="PhantomJS",A=(t=t.version||null)&&t.major+"."+t.minor+
"."+t.patch):"number"==typeof Y.documentMode&&(t=/\bTrident\/(\d+)/i.exec(u))?(A=[A,Y.documentMode],(t=+t[1]+4)!=A[1]&&(w.push("IE "+A[1]+" mode"),G&&(G[1]=""),A[1]=t),A="IE"==C?String(A[1].toFixed(1)):A[0]):"number"==typeof Y.documentMode&&/^(?:Chrome|Firefox)\b/.test(C)&&(w.push("masking as "+C+" "+A),C="IE",A="11.0",G=["Trident"],E="Windows");E=E&&a(E)}A&&(t=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(A)||/(?:alpha|beta)(?: ?\d)?/i.exec(u+";"+(T&&F.appMinorVersion))||/\bMinefield\b/i.test(u)&&
"a")&&(X=/b/i.test(t)?"beta":"alpha",A=A.replace(RegExp(t+"\\+?$"),"")+("beta"==X?da:ca)+(/\d+\+?/.exec(t)||""));if("Fennec"==C||"Firefox"==C&&/\b(?:Android|Firefox OS)\b/.test(E))C="Firefox Mobile";else if("Maxthon"==C&&A)A=A.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(H))"Xbox 360"==H&&(E=null),"Xbox 360"==H&&/\bIEMobile\b/.test(u)&&w.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(C)&&(!C||H||/Browser|Mobi/.test(C))||"Windows CE"!=E&&!/Mobi/i.test(u))if("IE"==C&&T)try{null===
x.external&&w.unshift("platform preview")}catch(L){w.unshift("embedded")}else(/\bBlackBerry\b/.test(H)||/\bBB10\b/.test(u))&&(t=(RegExp(H.replace(/ +/g," *")+"/([.\\d]+)","i").exec(u)||0)[1]||A)?(t=[t,/BB10/.test(u)],E=(t[1]?(H=null,O="BlackBerry"):"Device Software")+" "+t[0],A=null):this!=d&&"Wii"!=H&&(T&&S||/Opera/.test(C)&&/\b(?:MSIE|Firefox)\b/i.test(u)||"Firefox"==C&&/\bOS X (?:\d+\.){2,}/.test(E)||"IE"==C&&(E&&!/^Win/.test(E)&&5.5<A||/\bWindows XP\b/.test(E)&&8<A||8==A&&!/\bTrident\b/.test(u)))&&
!r.test(t=k.call(d,u.replace(r,"")+";"))&&t.name&&(t="ing as "+t.name+((t=t.version)?" "+t:""),r.test(C)?(/\bIE\b/.test(t)&&"Mac OS"==E&&(E=null),t="identify"+t):(t="mask"+t,C=V?a(V.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(t)&&(E=null),T||(A=null)),G=["Presto"],w.push(t));else C+=" Mobile";if(t=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(u)||0)[1]){t=[parseFloat(t.replace(/\.(\d)$/,".0$1")),t];if("Safari"==C&&"+"==t[1].slice(-1))C="WebKit Nightly",X="alpha",A=t[1].slice(0,-1);else if(A==
t[1]||A==(t[2]=(/\bSafari\/([\d.]+\+?)/i.exec(u)||0)[1]))A=null;t[1]=(/\bChrome\/([\d.]+)/i.exec(u)||0)[1];537.36==t[0]&&537.36==t[2]&&28<=parseFloat(t[1])&&"WebKit"==G&&(G=["Blink"]);T&&(P||t[1])?(G&&(G[1]="like Chrome"),t=t[1]||(t=t[0],530>t?1:532>t?2:532.05>t?3:533>t?4:534.03>t?5:534.07>t?6:534.1>t?7:534.13>t?8:534.16>t?9:534.24>t?10:534.3>t?11:535.01>t?12:535.02>t?"13+":535.07>t?15:535.11>t?16:535.19>t?17:536.05>t?18:536.1>t?19:537.01>t?20:537.11>t?"21+":537.13>t?23:537.18>t?24:537.24>t?25:537.36>
t?26:"Blink"!=G?"27":"28")):(G&&(G[1]="like Safari"),t=(t=t[0],400>t?1:500>t?2:526>t?3:533>t?4:534>t?"4+":535>t?5:537>t?6:538>t?7:601>t?8:"8"));G&&(G[1]+=" "+(t+="number"==typeof t?".x":/[.+]/.test(t)?"":"+"));"Safari"==C&&(!A||45<parseInt(A))&&(A=t)}"Opera"==C&&(t=/\bzbov|zvav$/.exec(E))?(C+=" ",w.unshift("desktop mode"),"zvav"==t?(C+="Mini",A=null):C+="Mobile",E=E.replace(RegExp(" *"+t+"$"),"")):"Safari"==C&&/\bChrome\b/.exec(G&&G[1])&&(w.unshift("desktop mode"),C="Chrome Mobile",A=null,/\bOS X\b/.test(E)?
(O="Apple",E="iOS 4.3+"):E=null);A&&0==A.indexOf(t=/[\d.]+$/.exec(E))&&-1<u.indexOf("/"+t+"-")&&(E=String(E.replace(t,"")).replace(/^ +| +$/g,""));G&&!/\b(?:Avant|Nook)\b/.test(C)&&(/Browser|Lunascape|Maxthon/.test(C)||"Safari"!=C&&/^iOS/.test(E)&&/\bSafari\b/.test(G[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(C)&&G[1])&&(t=G[G.length-1])&&w.push(t);w.length&&(w=["("+w.join("; ")+")"]);O&&H&&0>H.indexOf(O)&&w.push("on "+O);H&&w.push((/^on /.test(w[w.length-
1])?"":"on ")+H);if(E){var ba=(t=/ ([\d.+]+)$/.exec(E))&&"/"==E.charAt(E.length-t[0].length-1);E={architecture:32,family:t&&!ba?E.replace(t[0],""):E,version:t?t[1]:null,toString:function(){var L=this.version;return this.family+(L&&!ba?" "+L:"")+(64==this.architecture?" 64-bit":"")}}}(t=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(W))&&!/\bi686\b/i.test(W)?(E&&(E.architecture=64,E.family=E.family.replace(RegExp(" *"+t),"")),C&&(/\bWOW64\b/i.test(u)||T&&/\w(?:86|32)$/.test(F.cpuClass||F.platform)&&!/\bWin64; x64\b/i.test(u))&&
w.unshift("32-bit")):E&&/^OS X/.test(E.family)&&"Chrome"==C&&39<=parseFloat(A)&&(E.architecture=64);u||(u=null);x={};x.description=u;x.layout=G&&G[0];x.manufacturer=O;x.name=C;x.prerelease=X;x.product=H;x.ua=u;x.version=C&&A;x.os=E||{architecture:null,family:null,version:null,toString:function(){return"null"}};x.parse=k;x.toString=function(){return this.description||""};x.version&&w.unshift(A);x.name&&w.unshift(C);E&&C&&(E!=String(E).split(" ")[0]||E!=C.split(" ")[0]&&!H)&&w.push(H?"("+E+")":"on "+
E);w.length&&(x.description=w.join(" "));return x}var l={"function":!0,object:!0},m=l[typeof window]&&window||this,n=l[typeof exports]&&exports;l=l[typeof module]&&module&&!module.nodeType&&module;var p=n&&l&&"object"==typeof global&&global;!p||p.global!==p&&p.window!==p&&p.self!==p||(m=p);var q=Math.pow(2,53)-1,r=/\bOpera/;p=Object.prototype;var v=p.hasOwnProperty,y=p.toString,D=k();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(m.platform=D,define(function(){return D})):n&&
l?d(D,function(u,B){n[B]=u}):m.platform=D}).call(this);
function buildIOSMeta(){for(var b=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],f=0;f<b.length;f++){var a=document.createElement("meta");a.name=b[f].name;a.content=b[f].content;var d=window.document.head.querySelector('meta[name="'+a.name+'"]');d&&d.parentNode.removeChild(d);window.document.head.appendChild(a)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;
case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}$(document).ready(function(){platform&&"iPhone"===platform.product&&(buildIOSFullscreenPanel(),buildIOSMeta())});jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&iosResize()});
var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1,s_bIsRetina,pausedTweenObjs=[];
(function(b){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(b){console.log(b)}
function getSize(b){var f=b.toLowerCase(),a=window.document,d=a.documentElement;if(void 0===window["inner"+b])b=d["client"+b];else if(window["inner"+b]!=d["client"+b]){var c=a.createElement("body");c.id="vpw-test-b";c.style.cssText="overflow:scroll";var e=a.createElement("div");e.id="vpw-test-d";e.style.cssText="position:absolute;top:-1000px";e.innerHTML="<style>@media("+f+":"+d["client"+b]+"px){body#vpw-test-b div#vpw-test-d{"+f+":7px!important}}</style>";c.appendChild(e);d.insertBefore(c,a.head);
b=7==e["offset"+b]?d["client"+b]:window["inner"+b];d.removeChild(c)}else b=window["inner"+b];return b}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getNearestNumber(b,f){if(2>(a=b.length))return a-1;for(var a,d=Math.abs(b[--a]-f);a--&&!(d<(d=Math.abs(b[a]-f))););return a+1}
function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isIOS(){var b="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);b.length;)if(navigator.platform===b.pop())return!0;return s_bIsIphone=!1}
function isRetina(){s_bIsRetina=matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches?!0:!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var b=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<b?b:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var b=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var f=getSize("Width");_checkOrientation(f,b);var a=Math.min(b/CANVAS_HEIGHT,f/CANVAS_WIDTH),d=CANVAS_WIDTH*a;a*=CANVAS_HEIGHT;if(a<b){var c=b-a;a+=c;d+=CANVAS_WIDTH/CANVAS_HEIGHT*c}else d<f&&(c=f-d,d+=c,a+=CANVAS_HEIGHT/CANVAS_WIDTH*c);c=b/2-a/2;var e=f/2-d/2,g=CANVAS_WIDTH/d;if(e*g<-EDGEBOARD_X||c*g<-EDGEBOARD_Y)a=Math.min(b/(CANVAS_HEIGHT-2*
EDGEBOARD_Y),f/(CANVAS_WIDTH-2*EDGEBOARD_X)),d=CANVAS_WIDTH*a,a*=CANVAS_HEIGHT,c=(b-a)/2,e=(f-d)/2,g=CANVAS_WIDTH/d;s_iOffsetX=-1*e*g;s_iOffsetY=-1*c*g;0<=c&&(s_iOffsetY=0);0<=e&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oSelectPlayers&&s_oSelectPlayers.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*d,s_oStage.canvas.height=
2*a,canvas.style.width=d+"px",canvas.style.height=a+"px",f=Math.min(d/CANVAS_WIDTH,a/CANVAS_HEIGHT),s_iScaleFactor=2*f,s_oStage.scaleX=s_oStage.scaleY=2*f):s_bMobile||isChrome()?($("#canvas").css("width",d+"px"),$("#canvas").css("height",a+"px")):(s_oStage.canvas.width=d,s_oStage.canvas.height=a,s_iScaleFactor=Math.min(d/CANVAS_WIDTH,a/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>c||(c=(b-a)/2);$("#canvas").css("top",c+"px");$("#canvas").css("left",e+"px");fullscreenHandler()}}
function _checkOrientation(b,f){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(b>f?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function playSound(b,f,a){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[b].play(),s_aSounds[b].volume(f),s_aSounds[b].loop(a),s_aSounds[b]):null}function stopSound(b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].stop()}function setVolume(b,f){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].volume(f)}function setMute(b,f){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].mute(f)}
createjs.Tween.pauseAllTweens=function(){for(var b=0,f=createjs.Tween._tweens.slice().reverse(),a;a=f[b++];)pausedTweenObjs.push(a),!1===a.ignoreGlobalPause&&a.setPaused(!0)};createjs.Tween.resumeAllTweens=function(){for(var b=0,f;f=pausedTweenObjs[b++];)f.setPaused(!1);pausedTweenObjs.length=0};function setVolume(b,f){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)b.volume=f}function setMute(b,f){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||b.setMute(f)}
function createBitmap(b,f,a){var d=new createjs.Bitmap(b),c=new createjs.Shape;f&&a?c.graphics.beginFill("#fff").drawRect(0,0,f,a):c.graphics.beginFill("#ff0").drawRect(0,0,b.width,b.height);d.hitArea=c;return d}function createSprite(b,f,a,d,c,e){b=null!==f?new createjs.Sprite(b,f):new createjs.Sprite(b);f=new createjs.Shape;f.graphics.beginFill("#000000").drawRect(-a,-d,c,e);b.hitArea=f;return b}function pad(b,f,a){b+="";return b.length>=f?b:Array(f-b.length+1).join(a||"0")+b}
function randomSign(){return.5>=Math.random()?1:-1}function randomFloatBetween(b,f,a){"undefined"===typeof a&&(a=2);return parseFloat(Math.min(b+Math.random()*(f-b),f).toFixed(a))}function randomIntBetween(b,f,a){"undefined"===typeof a&&(a=2);return parseInt(Math.min(b+Math.random()*(f-b),f).toFixed(a))}function rotateVector2D(b,f){var a=f.getX()*Math.cos(b)+f.getY()*Math.sin(b),d=f.getX()*-Math.sin(b)+f.getY()*Math.cos(b);f.set(a,d)}function tweenVectorsOnX(b,f,a){return b+a*(f-b)}
function shuffle(b){for(var f=b.length,a,d;0!==f;)d=Math.floor(Math.random()*f),--f,a=b[f],b[f]=b[d],b[d]=a;return b}function centerBetweenPointsV2(b,f){var a=new CVector2;a.set(.5*(b.getX()+f.getX()),.5*(b.getY()+f.getY()));return a}function bubbleSort(b){do{var f=!1;for(var a=0;a<b.length-1;a++)b[a]>b[a+1]&&(f=b[a],b[a]=b[a+1],b[a+1]=f,f=!0)}while(f)}function compare(b,f){return b.index>f.index?-1:b.index<f.index?1:0}function easeLinear(b,f,a,d){return a*b/d+f}
function easeInQuad(b,f,a,d){return a*(b/=d)*b+f}function easeInSine(b,f,a,d){return-a*Math.cos(b/d*(Math.PI/2))+a+f}function easeInCubic(b,f,a,d){return a*(b/=d)*b*b+f}function getTrajectoryPoint(b,f){var a=new createjs.Point,d=(1-b)*(1-b),c=b*b;a.x=d*f.start.x+2*(1-b)*b*f.traj.x+c*f.end.x;a.y=d*f.start.y+2*(1-b)*b*f.traj.y+c*f.end.y;return a}function formatTime(b){b/=1E3;var f=Math.floor(b/60);b=parseFloat(b-60*f).toFixed(1);var a="";a=10>f?a+("0"+f+":"):a+(f+":");return 10>b?a+("0"+b):a+b}
function degreesToRadians(b){return b*Math.PI/180}function checkRectCollision(b,f){var a=getBounds(b,.9);var d=getBounds(f,.98);return calculateIntersection(a,d)}
function calculateIntersection(b,f){var a,d,c,e;var g=b.x+(a=b.width/2);var h=b.y+(d=b.height/2);var k=f.x+(c=f.width/2);var l=f.y+(e=f.height/2);g=Math.abs(g-k)-(a+c);h=Math.abs(h-l)-(d+e);return 0>g&&0>h?(g=Math.min(Math.min(b.width,f.width),-g),h=Math.min(Math.min(b.height,f.height),-h),{x:Math.max(b.x,f.x),y:Math.max(b.y,f.y),width:g,height:h,rect1:b,rect2:f}):null}
function getBounds(b,f){var a={x:Infinity,y:Infinity,width:0,height:0};if(b instanceof createjs.Container){a.x2=-Infinity;a.y2=-Infinity;var d=b.children,c=d.length,e;for(e=0;e<c;e++){var g=getBounds(d[e],1);g.x<a.x&&(a.x=g.x);g.y<a.y&&(a.y=g.y);g.x+g.width>a.x2&&(a.x2=g.x+g.width);g.y+g.height>a.y2&&(a.y2=g.y+g.height)}Infinity==a.x&&(a.x=0);Infinity==a.y&&(a.y=0);Infinity==a.x2&&(a.x2=0);Infinity==a.y2&&(a.y2=0);a.width=a.x2-a.x;a.height=a.y2-a.y;delete a.x2;delete a.y2}else{if(b instanceof createjs.Bitmap){c=
b.sourceRect||b.image;e=c.width*f;var h=c.height*f}else if(b instanceof createjs.Sprite)if(b.spriteSheet._frames&&b.spriteSheet._frames[b.currentFrame]&&b.spriteSheet._frames[b.currentFrame].image){c=b.spriteSheet.getFrame(b.currentFrame);e=c.rect.width;h=c.rect.height;d=c.regX;var k=c.regY}else a.x=b.x||0,a.y=b.y||0;else a.x=b.x||0,a.y=b.y||0;d=d||0;e=e||0;k=k||0;h=h||0;a.regX=d;a.regY=k;c=b.localToGlobal(0-d,0-k);g=b.localToGlobal(e-d,h-k);e=b.localToGlobal(e-d,0-k);d=b.localToGlobal(0-d,h-k);a.x=
Math.min(Math.min(Math.min(c.x,g.x),e.x),d.x);a.y=Math.min(Math.min(Math.min(c.y,g.y),e.y),d.y);a.width=Math.max(Math.max(Math.max(c.x,g.x),e.x),d.x)-a.x;a.height=Math.max(Math.max(Math.max(c.y,g.y),e.y),d.y)-a.y}return a}function NoClickDelay(b){this.element=b;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(b){for(var f=b.length,a,d;0<f;)d=Math.floor(Math.random()*f),f--,a=b[f],b[f]=b[d],b[d]=a;return b}
NoClickDelay.prototype={handleEvent:function(b){switch(b.type){case "touchstart":this.onTouchStart(b);break;case "touchmove":this.onTouchMove(b);break;case "touchend":this.onTouchEnd(b)}},onTouchStart:function(b){b.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(b){this.moved=!0},onTouchEnd:function(b){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){b=document.elementFromPoint(b.changedTouches[0].clientX,b.changedTouches[0].clientY);3==b.nodeType&&(b=b.parentNode);var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0);b.dispatchEvent(f)}}};
(function(){function b(a){var d={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in d?document.body.className=d[a.type]:(document.body.className=this[f]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var f="hidden";f in document?document.addEventListener("visibilitychange",b):(f="mozHidden")in document?document.addEventListener("mozvisibilitychange",b):(f="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",b):(f="msHidden")in document?document.addEventListener("msvisibilitychange",b):"onfocusin"in document?document.onfocusin=document.onfocusout=b:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=b})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(b){for(var f=window.location.search.substring(1).split("&"),a=0;a<f.length;a++){var d=f[a].split("=");if(d[0]==b)return d[1]}}String.prototype.format=function(){for(var b=this,f=arguments.length;f--;)b=b.replace(new RegExp("\\{"+f+"\\}","gm"),arguments[f]);return b};function radiansToDegree(b){return 180/Math.PI*b}function distance(b,f){var a=b.getX()-f.getX(),d=b.getY()-f.getY();return Math.sqrt(a*a+d*d)}
function fixEnemyTremble(b,f){var a=!1;distanceBetween2Points(f.m_pCenter().getX(),b.getY(),f.m_pCenter().getX(),f.m_pCenter().getY())<=f.getLength()&&(a=!0);return a}function distanceBetween2Points(b,f,a,d){return Math.sqrt(Math.pow(a-b,2)+Math.pow(d-f,2))}function collideEdgeWithCircle(b,f,a){b=closestPointOnLine(b.getPointA(),b.getPointB(),f);f=distanceV2(f,b);return a<f?null:{distance:f,closest_point:b}}
function closestPointOnLine(b,f,a){var d=new CVector2,c=new CVector2;d.setV(b);c.setV(f);var e=new CVector2;e.setV(a);e.subtract(b);a=new CVector2;a.setV(f);a.subtract(b);a.normalize();e=dotProductV2(a,e);if(0>=e)return d;if(e>=distanceV2(b,f))return c;a.scalarProduct(e);a.addV(b);return a}function dotProductV2(b,f){return b.getX()*f.getX()+b.getY()*f.getY()}function distanceV2(b,f){return Math.sqrt((f.getX()-b.getX())*(f.getX()-b.getX())+(f.getY()-b.getY())*(f.getY()-b.getY()))}
function reflectVectorV2(b,f){var a=dotProductV2(b,f);b.set(b.getX()-2*a*f.getX(),b.getY()-2*a*f.getY());return b}function angleBetweenVectors(b,f){var a=Math.acos(dotProductV2(b,f)/(b.length()*f.length()));return 1==isNaN(a)?0:a}function distanceV2WithoutSQRT(b,f){return(f.getX()-b.getX())*(f.getX()-b.getX())+(f.getY()-b.getY())*(f.getY()-b.getY())}
function classifySphere(b,f,a,d){b=f.getX()*b.getX()+f.getY()*b.getY()+planeDistance(f,a);return Math.abs(b)<d?0<=b?"INTERSECT FRONT":"INTERSECT BEHIND":b>=d?"FRONT":"BEHIND"}function planeDistance(b,f){return-(b.getX()*f.getX()+b.getY()*f.getY())}function saveItem(b,f){s_bStorageAvailable&&localStorage.setItem(b,f)}function getItem(b){return s_bStorageAvailable?localStorage.getItem(b):null}
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut())}
if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut()});var s_szGameID="d96dc07738f248c49ae51c61facd4286";window.GD_OPTIONS={gameId:s_szGameID,onEvent:function(b){switch(b.name){case "SDK_GAME_START":s_oMain&&s_oMain.startUpdate();break;case "SDK_GAME_PAUSE":s_oMain&&s_oMain.stopUpdate()}}};
(function(b,f,a){var d=b.getElementsByTagName(f)[0];b.getElementById(a)||(b=b.createElement(f),b.id=a,b.src="",d.parentNode.insertBefore(b,d))})(document,"script","gamedistribution-jssdk");
function CSpriteLibrary(){var b,f,a,d,c,e;this.init=function(g,h,k){a=f=0;d=g;c=h;e=k;b={}};this.addSprite=function(g,h){b.hasOwnProperty(g)||(b[g]={szPath:h,oSprite:new Image},f++)};this.getSprite=function(g){return b.hasOwnProperty(g)?b[g].oSprite:null};this._onSpritesLoaded=function(){c.call(e)};this._onSpriteLoaded=function(){d.call(e);++a==f&&this._onSpritesLoaded()};this.loadSprites=function(){for(var g in b)b[g].oSprite.oSpriteLibrary=this,b[g].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
b[g].oSprite.src=b[g].szPath};this.getNumSprites=function(){return f}}
var CCTLMultiplayerGui=function(){this._cssClassDomain="ctl-multiplayer-";this._idCurDialog;this._idLoadingDialog;var b=localStorage.getItem("nickname");this._szNickName=null===b||void 0===b?"":b;jQuery(document).on("click","."+this._cssClassDomain+"room-list li",function(){g_oCTLMultiplayer.closeCurrentDialog();var f=jQuery(this).text();"true"===jQuery(this).attr("data-private")?g_oCTLMultiplayer.showTypeRoomPassword(f):(g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING),on_ctl_multiplayer_join_room(f))})};
CCTLMultiplayerGui.prototype.refreshRoomList=function(b){for(var f="",a=0;a<b.length;a++)f+='<li data-private="'+b[a]["private"]+'">',f+="<span>",f+=b[a].name,f+="</span>",!0===b[a]["private"]&&(f+='<i class="'+this._cssClassDomain+'icons-lock"></i>'),f+="</li>";jQuery("."+this._cssClassDomain+"room-list").html(f)};
CCTLMultiplayerGui.prototype.showRoomList=function(b){var f='<ul class="'+this._cssClassDomain+'room-list">';f=f+'</ul><button onclick="on_ctl_multiplayer_refresh_room_list()" type="button" class="'+(this._cssClassDomain+"update "+this._cssClassDomain+'btn-gray">');f+='<i class="'+this._cssClassDomain+'icons-arrows-cw"></i>';f+="<span>"+TEXT_SYS_UPDATE+"</span>";this._idCurDialog=this.showDialog(TEXT_SYS_MATCH_LIST,f+"</button>",[{txt:TEXT_SYS_QUICKMATCH,cb:"on_ctl_multiplayer_join_quick_match",classes:""},
{txt:TEXT_SYS_CREATEMATCH,cb:"on_ctl_multiplayer_show_create_match",classes:""},{txt:TEXT_SYS_BACK,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}]);this.refreshRoomList(b)};
CCTLMultiplayerGui.prototype.showTypeRoomPassword=function(b){var f='<div class="'+this._cssClassDomain+'form-group">';f+="<label>"+TEXT_SYS_TYPEROOMPASS+"</label>";this._idCurDialog=this.showDialog(TEXT_SYS_TYPEROOMPASS,f+('<input type="password" name="password" data-room-name="'+b+'"></div>'),[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_password",classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_type_room_password",classes:""}])};
CCTLMultiplayerGui.prototype.showCreateRoom=function(){var b='<div class="'+this._cssClassDomain+'form-group">';b+="<label>"+TEXT_SYS_NAMEROOM+"</label>";b+='<input type="text" name="roomname" value="'+this._szNickName+"'s room\">";b=b+'</div><div class="'+(this._cssClassDomain+'form-group">');b+="<label>"+TEXT_SYS_PASSWORD+"</label>";b=b+'<input type="password" name="password"><p>'+(TEXT_SYS_INFOPASS+"</p>");this._idCurDialog=this.showDialog(TEXT_SYS_CREATEROOM,b+"</div>",[{txt:TEXT_SYS_CREATE,cb:"on_ctl_multiplayer_create_room",
classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_create_room",classes:""}])};CCTLMultiplayerGui.prototype.showChooseNickName=function(){this._idCurDialog=this.showDialog(TEXT_SYS_CHOOSENICK,'<input type="text" name="nickname" maxlength="20" value="'+this._szNickName+'">',[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_nickname",classes:""},{txt:TEXT_SYS_CLOSE,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}])};
CCTLMultiplayerGui.prototype.showGeneralDialog=function(b,f){this._idCurDialog=this.showDialog(b,"",[{txt:TEXT_SYS_BACK,cb:f,classes:""}])};CCTLMultiplayerGui.prototype.closeLoadingDialog=function(){this.closeDlg(this._idLoadingDialog)};CCTLMultiplayerGui.prototype.closeCurrentDialog=function(){this.closeDlg(this._idCurDialog)};
CCTLMultiplayerGui.prototype.makeCode=function(){for(var b="",f=0;32>f;f++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b};
CCTLMultiplayerGui.prototype.showDialog=function(b,f,a,d){var c="";d||(d=this.makeCode());c+="<div id='"+d+"' class='"+this._cssClassDomain+"dlg-wrapper'>";c+="<div class='"+this._cssClassDomain+"dlg-block'></div>";c+="<div class='"+this._cssClassDomain+"dlg-content'>";c+="<div class='"+this._cssClassDomain+"dlg-header'>";c=c+("<h1>"+b+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body'>");c+=f;c+="</div>";if(a&&0<a.length){c+="<div class='"+this._cssClassDomain+"dlg-footer'>";for(b=
0;b<a.length;b++)c+="<button type='button' onclick='"+a[b].cb+'("'+d+"\");' class='"+this._cssClassDomain+"-mini "+a[b].classes+"'>"+a[b].txt+"</button>";c+=this.buildExtraFooter();c+="</div>"}c+="</div>";c+="</div>";jQuery("body").append(c);return d};CCTLMultiplayerGui.prototype.buildExtraFooter=function(){return'<div class="'+this._cssClassDomain+'copyright"><a>www.codethislab.com</a></div>'};
CCTLMultiplayerGui.prototype.showLoading=function(b,f){var a="";this._idLoadingDialog=this.makeCode();b||(b=TEXT_SYS_LOADING);a+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";a+="<div class='"+this._cssClassDomain+"dlg-block'></div>";a+="<div class='"+this._cssClassDomain+"dlg-content'>";a+="<div class='"+this._cssClassDomain+"dlg-header'>";a=a+("<h1>"+b+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+
"align-center'>");a+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>';a+="</div>";f&&(a+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",a+="<button type='button' onclick='"+f+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"-mini '>"+TEXT_SYS_BACK+"</button>",a+=this.buildExtraFooter(),a+="</div>");a+="</div>";a+="</div>";jQuery("body").append(a)};CCTLMultiplayerGui.prototype.closeDlg=function(b){jQuery("#"+b).remove()};
CCTLMultiplayerGui.prototype.closeAllDialog=function(){g_oCTLMultiplayer.closeLoadingDialog();g_oCTLMultiplayer.closeCurrentDialog()};CCTLMultiplayerGui.prototype.setNickName=function(b){this._szNickName=null===b||void 0===b?"":b;localStorage.setItem("nickname",this._szNickName)};CCTLMultiplayerGui.prototype.getNickname=function(){return this._szNickName};var g_oCTLMultiplayer=new CCTLMultiplayerGui;
function CToggle(b,f,a,d,c){var e,g,h,k,l,m,n;this._init=function(p,q,r,v,y){l=[];m=[];var D=new createjs.SpriteSheet({images:[r],frames:{width:r.width/2,height:r.height,regX:r.width/2/2,regY:r.height/2},animations:{state_true:[0],state_false:[1]}});e=v;n=createSprite(D,"state_"+e,r.width/2/2,r.height/2,r.width/2,r.height);n.x=p;n.y=q;n.stop();y.addChild(n);this._initListener()};this.unload=function(){s_bMobile?n.off("mousedown",g):(n.off("mousedown",g),n.off("mouseover",k));n.off("pressup",h);c.removeChild(n)};
this._initListener=function(){s_bMobile?g=n.on("mousedown",this.buttonDown):(g=n.on("mousedown",this.buttonDown),k=n.on("mouseover",this.buttonOver));h=n.on("pressup",this.buttonRelease)};this.addEventListener=function(p,q,r){l[p]=q;m[p]=r};this.setActive=function(p){e=p;n.gotoAndStop("state_"+e)};this.buttonRelease=function(){n.scaleX=1;n.scaleY=1;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||playSound("press_button",1,!1);e=!e;n.gotoAndStop("state_"+e);l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(m[ON_MOUSE_UP],
e)};this.buttonDown=function(){n.scaleX=.9;n.scaleY=.9;l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN])};this.buttonOver=function(p){s_bMobile||(p.target.cursor="pointer")};this.setPosition=function(p,q){n.x=p;n.y=q};this._init(b,f,a,d,c)}
function CGfxButton(b,f,a,d){var c,e,g,h,k,l,m,n,p;this._init=function(r,v,y,D){p=c=!1;e=1;l=[];m=[];n=createBitmap(y);n.x=r;n.y=v;n.scaleX=n.scaleY=e;n.regX=y.width/2;n.regY=y.height/2;D.addChild(n);this._initListener()};this.unload=function(){s_bMobile?n.off("mousedown",g):(n.off("mousedown",g),n.off("mouseover",k));n.off("pressup",h);d.removeChild(n)};this.setVisible=function(r){n.visible=r};this.setClickable=function(r){c=!r};this._initListener=function(){s_bMobile?g=n.on("mousedown",this.buttonDown):
(g=n.on("mousedown",this.buttonDown),k=n.on("mouseover",this.buttonOver));h=n.on("pressup",this.buttonRelease)};this.addEventListener=function(r,v,y){l[r]=v;m[r]=y};this.buttonRelease=function(){c||(n.scaleX=e,n.scaleY=e,l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(m[ON_MOUSE_UP]))};this.buttonDown=function(){c||(n.scaleX=.9*e,n.scaleY=.9*e,p||playSound("press_button",1,!1),l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN]))};this.buttonOver=function(r){s_bMobile||c||(r.target.cursor="pointer")};this.pulseAnimation=
function(){createjs.Tween.get(n).to({scaleX:.9*e,scaleY:.9*e},850,createjs.Ease.quadOut).to({scaleX:e,scaleY:e},650,createjs.Ease.quadIn).call(function(){q.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(n).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){q.trebleAnimation()})};this.setPosition=function(r,v){n.x=r;n.y=v};this.setX=function(r){n.x=r};this.setY=function(r){n.y=
r};this.getButtonImage=function(){return n};this.getX=function(){return n.x};this.getY=function(){return n.y};this.setMuted=function(r){p=r};var q=this;this._init(b,f,a,d);return this}
function CTextButton(b,f,a,d,c,e,g,h){var k,l,m,n,p;this._init=function(q,r,v,y,D,u,B,z){k=[];l=[];var x=createBitmap(v),w=Math.ceil(B/20),F=new createjs.Text(y,"bold "+B+"px "+D,"#000000");F.textAlign="center";F.textBaseline="alphabetic";var A=F.getBounds();F.x=v.width/2+w;F.y=Math.floor(v.height/2)+A.height/3+w;y=new createjs.Text(y,"bold "+B+"px "+D,u);y.textAlign="center";y.textBaseline="alphabetic";A=y.getBounds();y.x=v.width/2;y.y=Math.floor(v.height/2)+A.height/3;m=new createjs.Container;m.x=
q;m.y=r;m.regX=v.width/2;m.regY=v.height/2;m.addChild(x,y);s_bMobile||(m.cursor="pointer");z.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",n);m.off("pressup",p);h.removeChild(m)};this.setVisible=function(q){m.visible=q};this._initListener=function(){n=m.on("mousedown",this.buttonDown);p=m.on("pressup",this.buttonRelease)};this.addEventListener=function(q,r,v){k[q]=r;l[q]=v};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;playSound("press_button",1,!1);k[ON_MOUSE_UP]&&
k[ON_MOUSE_UP].call(l[ON_MOUSE_UP])};this.buttonDown=function(){m.scaleX=.9;m.scaleY=.9;k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};this.setPosition=function(q,r){m.x=q;m.y=r};this.setX=function(q){m.x=q};this.setY=function(q){m.y=q};this.getButtonImage=function(){return m};this.getX=function(){return m.x};this.getY=function(){return m.y};this._init(b,f,a,d,c,e,g,h);return this}
var ON_CONNECTION_ERROR=0,ON_DISCONNECTION=1,ON_LOGIN_SUCCESS=2,ON_MATCHMAKING_CONNECTION_SUCCESS=3,ON_GAMEROOM_CONNECTION_SUCCESS=4,ON_USEROWNERROOM_CREATE_SUCCESS=5,ON_USEROWNERROOM_JOIN_SUCCESS=6,ON_ROOM_INFO_RETURNED=7,ON_BACK_FROM_A_ROOM=8,ERROR_CODE_UNKNOWNROOM="UnknownRoom",ROOM_TYPE_MATCHMAKING="MatchmakingRoom",ROOM_TYPE_USEROWNER="UserOwnerRoom",ROOM_TYPE_GAME="GameRoom";
function CNetworkManager(){var b,f,a,d,c,e,g,h,k,l,m,n;this._init=function(){b=[];f=[];c=new CNetworkMessageForwarder};this.unload=function(){s_oNetworkManager=null};this.connectToSystem=function(){s_oNetworkManager.addEventListener(ON_LOGIN_SUCCESS,s_oNetworkManager.gotoLobby);g_oCTLMultiplayer.showChooseNickName()};this.login=function(p){h=p;p=this._setValidNick(p);PlayerIO.useSecureApiRequests=!MULTIPLAYER_TEST_LOCAL;PlayerIO.authenticate(GAME_PLAYERIO_ID,"public",{userId:p},{},function(q){d=q;
d.multiplayer.useSecureConnections=!MULTIPLAYER_TEST_LOCAL;MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184",d.multiplayer.createJoinRoom("fakeroom"+Math.random(),"fakeroom",!1,null,null,function(r){r.addMessageCallback("*",c.messageHandler);r.addDisconnectCallback(s_oNetworkManager.callbackDisconnect)},s_oNetworkManager.callbackError));b[ON_LOGIN_SUCCESS]&&b[ON_LOGIN_SUCCESS].call(f[ON_LOGIN_SUCCESS])},s_oNetworkManager.callbackError)};this._setValidNick=function(p){var q=
s_oNetworkManager._getRandomCodeNumber();""===p||null===p||void 0===p?h=p="guest-"+q:p=p+"-"+q;return p};this._getRandomCodeNumber=function(){return Math.floor(1E3*Math.random())};this.generateRandomName=function(){var p="xmariox alex max mahuro biajus rob idah fabrix seth ikillyou commander admiral general seasalt emperorofthesea Aspect Kraken Dragon Shiver Dracula Doom Scar Roadkill Cobra Psycho Ranger Ripley Clink Bruise Bowser Creep Cannon Daemon Steel Tempest Hurricane Titanium Tito Lightning IronHeart Sabotage Rex Hydra Terminator Agrippa Gash Blade Katana Gladius Angon Claymore Pike Hammer Club Heart Gauntlet Montante Longbow bow Dagger".split(" "),
q=Math.floor(Math.random()*p.length);p=p[q];if(.5<Math.random()){var r=Math.floor(100*Math.random());if(.5<Math.random()){var v=["-","_"];q=Math.floor(Math.random()*v.length);p+=v[q]}p+=r}return n=p};this.getBotName=function(){return n};this.addEventListener=function(p,q,r){b[p]=q;f[p]=r};this.callbackError=function(p){b[ON_CONNECTION_ERROR]&&b[ON_CONNECTION_ERROR].call(f[ON_CONNECTION_ERROR],p)};this.callbackDisconnect=function(p){b[ON_DISCONNECTION]&&b[ON_DISCONNECTION].call(f[ON_DISCONNECTION],
p)};this.sendMsg=function(p,q){a&&a.send(p,q)};this.disconnect=function(){a&&(a.disconnect(),a=null)};this.isUserA=function(){return 0===parseInt(e)?!0:!1};this.getPlayerOrderID=function(){return e};this.getPlayerNickname=function(){return h};this.getEnemyNickname=function(){return k};this.createRoom=function(p,q){s_oNetworkManager.addEventListener(ON_USEROWNERROOM_CREATE_SUCCESS,this._onRoomCreated);MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.createJoinRoom(p,
ROOM_TYPE_USEROWNER,!0,{id:p,pass:q},{nickname:h},function(r){a=r;r.addMessageCallback("*",c.messageHandler);r.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);b[ON_USEROWNERROOM_CREATE_SUCCESS]&&b[ON_USEROWNERROOM_CREATE_SUCCESS].call(f[ON_USEROWNERROOM_CREATE_SUCCESS])},s_oNetworkManager.callbackError)};this.joinRoom=function(p){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,this._onRoomJoinedFailed);MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.joinRoom(p,
{nickname:h},function(q){a=q;q.addMessageCallback("*",c.messageHandler);q.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);b[ON_USEROWNERROOM_JOIN_SUCCESS]&&b[ON_USEROWNERROOM_JOIN_SUCCESS].call(f[ON_USEROWNERROOM_JOIN_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoGameRoom=function(p){MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");var q=p.getString(0);e=p.getInt(1);k=p.getString(2);d.multiplayer.createJoinRoom(q,ROOM_TYPE_GAME,!1,null,null,function(r){a=
r;r.addMessageCallback("*",c.messageHandler);r.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);g_oCTLMultiplayer.closeAllDialog();b[ON_GAMEROOM_CONNECTION_SUCCESS]&&b[ON_GAMEROOM_CONNECTION_SUCCESS].call(f[ON_GAMEROOM_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoMatchMakingRoom=function(){MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.createJoinRoom("matchmakingroom1",ROOM_TYPE_MATCHMAKING,!0,null,{nickname:h},function(p){a=
p;p.addMessageCallback("*",c.messageHandler);p.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);b[ON_MATCHMAKING_CONNECTION_SUCCESS]&&b[ON_MATCHMAKING_CONNECTION_SUCCESS].call(f[ON_MATCHMAKING_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.tryCreateUniqueRoom=function(p,q){l=p;m=q;d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:p},0,0,s_oNetworkManager._onUniqueListRoomSearch,s_oNetworkManager.callbackError)};this._onUniqueListRoomSearch=function(p){0<p.length&&(l+="-"+s_oNetworkManager._getRandomCodeNumber());
s_oNetworkManager.createRoom(l,m)};this._onRoomCreated=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_WAITING_FOR_OPPONENT_IN_ROOM+l,"s_oNetworkManager._onDisconnectFromARoom")};this._onDisconnectFromARoom=function(){b[ON_BACK_FROM_A_ROOM]&&b[ON_BACK_FROM_A_ROOM].call(f[ON_BACK_FROM_A_ROOM]);s_oNetworkManager.disconnect();setTimeout(function(){s_oNetworkManager.gotoLobby()},250)};this._onRoomJoined=function(){};this._onRoomJoinedFailed=function(p){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,
function(){});switch(p.code){case ERROR_CODE_UNKNOWNROOM:g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby")}};this.gotoLobby=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY);d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,s_oNetworkManager._onListRoom,s_oNetworkManager.callbackError)};this._onListRoom=function(p){p=s_oNetworkManager._extractRoomInfo(p);g_oCTLMultiplayer.closeAllDialog();
g_oCTLMultiplayer.showRoomList(p);clearTimeout(g);g=setInterval(function(){0<jQuery(".ctl-multiplayer-room-list").length?d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,s_oNetworkManager._onAutoRefreshRoom,s_oNetworkManager.callbackError):clearTimeout(g)},2E3)};this._onAutoRefreshRoom=function(p){p=s_oNetworkManager._extractRoomInfo(p);g_oCTLMultiplayer.refreshRoomList(p)};this._extractRoomInfo=function(p){for(var q=[],r=0;r<p.length;r++)q[r]={name:p[r].id,"private":0===p[r].roomData.pass.length?
!1:!0};return q};this.joinQuickMatch=function(){g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING);s_oNetworkManager.gotoMatchMakingRoom()};this.tryJoinRoomWithPass=function(p,q){l=p;m=q;s_oNetworkManager.addEventListener(ON_ROOM_INFO_RETURNED,s_oNetworkManager._checkUserPermissionToJoin);s_oNetworkManager.getRoomInfo(p,q)};this._checkUserPermissionToJoin=function(p){0<p.length?s_oNetworkManager.joinRoom(p[0].roomData.id,p[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_WRONG_PASSWORD,
"s_oNetworkManager._onPasswordFailed"))};this._onPasswordFailed=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showTypeRoomPassword(l)};this.getRoomInfo=function(p,q){d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:p,pass:q},0,0,s_oNetworkManager._onRoomInfoReturned,s_oNetworkManager.callbackError)};this._onRoomInfoReturned=function(p){b[ON_ROOM_INFO_RETURNED]&&b[ON_ROOM_INFO_RETURNED].call(f[ON_ROOM_INFO_RETURNED],p)};this._init()}
var MSG_ROOM_IS_FULL="room_is_full",MSG_GAME_FOUND="game_found",MSG_SET_WINNER="set_winner",MSG_REMATCH_PANEL="rematch_panel",MSG_REMATCH_ANSWER_RESULTS="rematch_answer_results",MSG_ENEMY_MOVES="enemy_moves",MSG_OPPONENT_DICE_RESULTS="opponent_dice_results",MSG_END_MATCH="end_match",MSG_ACCEPT_REMATCH="accept_rematch",MSG_DISCONNECTION="disconnection",MSG_MOVE="move",MSG_ROLL_DICE="roll_dice";
function CNetworkMessageForwarder(){this._init=function(){};this.messageHandler=function(f){switch(f.type){case MSG_ROOM_IS_FULL:b._onFullRoom(f);break;case MSG_GAME_FOUND:b._onGameFound(f);break;case MSG_SET_WINNER:b._onSetWinner(f);break;case MSG_REMATCH_PANEL:b._onRematchPanel(f);break;case MSG_REMATCH_ANSWER_RESULTS:b._onRematchResults(f);break;case MSG_ENEMY_MOVES:b._onEnemyMoves(f);break;case MSG_OPPONENT_DICE_RESULTS:b._onOpponentDiceRolled(f)}};this._onFullRoom=function(){g_oCTLMultiplayer.closeAllDialog();
g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_FULL,"s_oNetworkManager.gotoLobby")};this._onGameFound=function(f){s_oNetworkManager.gotoGameRoom(f)};this._onSetWinner=function(f){s_oGame.opponentLeftTheGame()};this._onRematchPanel=function(){s_oGame.showRematchQuestion()};this._onRematchResults=function(f){if(f.getBoolean(0))s_oGame.onOpponentAcceptRematch();else s_oGame.onOpponentRefuseRematch()};this._onEnemyMoves=function(f){f=f.getString(0);f=JSON.parse(f);s_oGame.remoteMovePiece(f[MSG_MOVE])};
this._onOpponentDiceRolled=function(f){f=f.getString(0);f=JSON.parse(f);s_oGame.remoteDiceRoll(f[MSG_ROLL_DICE])};var b=this;this._init()}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var b=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(b--,this._oText.font=b+"px "+this._szFont,this._oText.lineHeight=Math.round(b*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>b););this._iFontSize=b}},__verticalAlign:function(){if(this._bVerticalAlign){var b=this._oText.getBounds().height;this._oText.y-=
(b-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(b){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(b,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(b)},setVerticalAlign:function(b){this._bVerticalAlign=b},setOutline:function(b){null!==this._oText&&(this._oText.outline=b)},setShadow:function(b,f,a,d){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(b,f,a,d))},setColor:function(b){this._oText.color=b},setAlpha:function(b){this._oText.alpha=b},setY:function(b){this._y=this._oText.y=b},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getY:function(){return this._y},
getFontSize:function(){return this._iFontSize},refreshText:function(b){""===b&&(b=" ");null===this._oText&&this.__createText(b);this._oText.text=b;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(b,f,a,d,c,e,g,h,k,l,m,n,p,q,r,v,y){this._oContainer=b;this._x=f;this._y=a;this._iWidth=d;this._iHeight=c;this._bMultiline=v;this._iFontSize=e;this._szAlign=g;this._szColor=h;this._szFont=k;this._iPaddingH=m;this._iPaddingV=n;this._bVerticalAlign=r;this._bFitText=q;this._bDebug=y;this._oDebugShape=null;this._fLineHeightFactor=l;this._oText=null;p&&this.__createText(p)}
var CANVAS_WIDTH=1360,CANVAS_HEIGHT=840,EDGEBOARD_X=120,EDGEBOARD_Y=122,PRIMARY_FONT="flashrogersstraight",FPS=30,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,GAME_ORIENTATION="landscape",GAME_PLAYERIO_ID="backgammon-edrzmezujusfgjtbnpqwyw",GAME_NAME="backgammon_multiplayer",MULTIPLAYER_TEST_LOCAL=!1,s_b2Players,NUM_PIECES=15,BLACK_PIECE=0,WHITE_PIECE=1,TRIANGLE_UP=1,TRIANGLE_DOWN=-1,BAR_UP=0,BAR_DOWN=1,NUM_TRIANGLES=24,FINAL_CELL_WHITE=24,FINAL_CELL_BLACK=-1,WHITE_DICES=0,RED_DICES=1,X_TRIANGLE_LEFT=
290,X_TRIANGLE_RIGHT=759,Y_TRIANGLE_UP=128,Y_TRIANGLE_DOWN=712,X_OFFBOARD=1155,Y_OFFBOARD_DOWN=458,Y_OFFBOARD_UP=143,X_INTERFACE_PLAYER=180,Y_INTERFACE_PLAYER_1=133,Y_INTERFACE_PLAYER_2=449,X_INTERFACE_PLAYER_END=CANVAS_WIDTH-230,TIME_LOOP_WAIT=1E3,MIN_TIME_THINK=700,MAX_TIME_THINK=2300,MS_DISTRIBUTION,CELL_0=0,CELL_1=1,CELL_2=2,CELL_3=3,CELL_4=4,CELL_5=5,CELL_6=6,CELL_7=7,CELL_8=8,CELL_9=9,CELL_10=10,CELL_11=11,CELL_12=12,CELL_13=13,CELL_14=14,CELL_15=15,CELL_16=16,CELL_17=17,CELL_18=18,CELL_19=
19,CELL_20=20,CELL_21=21,CELL_22=22,CELL_23=23,MULTIPLIER_SCORE,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,STATE_LEVEL_SELECTION=4,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_BACK_MENU=6,ON_RESTART=7,MOVES_TYPE_FILL="fill",MOVES_TYPE_ADD="add",MOVES_TYPE_HIT="hit",MOVES_TYPE_BEAR="bear",MOVES_TYPE_EXTRABEAR="extrabear",MOVES_TYPE_COLLISION="collision",RULE_BROKEN_NONE="none",RULE_BROKEN_HIGHER_DICE="higher",RULE_BROKEN_BOTH_DICE="bothdice",
RULE_BROKEN_MOST_DICE="most",NUM_TURNS_PER_ADS=20,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION;
function CPreloader(){var b,f,a,d,c,e,g,h,k,l;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();l=new createjs.Container;s_oStage.addChild(l)};this.unload=function(){l.removeAllChildren();k.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(m);m=s_oSpriteLibrary.getSprite("200x200");g=createBitmap(m);g.regX=.5*m.width;g.regY=.5*m.height;g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2-180;l.addChild(g);h=new createjs.Shape;h.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(g.x-100,g.y-100,200,200,10);l.addChild(h);g.mask=h;
m=s_oSpriteLibrary.getSprite("progress_bar");d=createBitmap(m);d.x=CANVAS_WIDTH/2-m.width/2;d.y=CANVAS_HEIGHT/2+50;l.addChild(d);b=m.width;f=m.height;c=new createjs.Shape;c.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(d.x,d.y,1,f);l.addChild(c);d.mask=c;a=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2+100;a.textBaseline="alphabetic";a.textAlign="center";l.addChild(a);m=s_oSpriteLibrary.getSprite("but_start");k=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,m,TEXT_PRELOADER_CONTINUE,"Arial","#000",50,l);k.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);k.setVisible(!1);e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(e);createjs.Tween.get(e).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(e);l.removeChild(e)})};this._onButStartRelease=function(){$(s_oMain).trigger("show_preroll_ad");s_oMain._onRemovePreloader()};this.refreshLoader=function(m){a.text=m+"%";100===m&&(k.setVisible(!0),
a.visible=!1,d.visible=!1);c.graphics.clear();m=Math.floor(m*b/100);c.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(d.x,d.y,m,f)};this._init()}
function CMain(b){var f,a=0,d=0,c=STATE_LOADING,e;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!0;createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(FPS),$("body").on("contextmenu","#canvas",function(h){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;s_oNetworkManager=new CNetworkManager;e=new CPreloader};this.preloaderReady=function(){f=!0;s_oMain._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_oMain._initSounds()};this.soundLoaded=function(){a++;e.refreshLoader(Math.floor(a/d*100))};this._initSounds=function(){var h=[];h.push({path:"./sounds/",filename:"press_button",loop:!1,volume:1,ingamename:"press_button"});h.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,
ingamename:"game_over"});h.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});h.push({path:"./sounds/",filename:"click_cell",loop:!1,volume:1,ingamename:"click_cell"});h.push({path:"./sounds/",filename:"dices",loop:!1,volume:1,ingamename:"dices"});h.push({path:"./sounds/",filename:"positive_beep",loop:!1,volume:1,ingamename:"positive_beep"});h.push({path:"./sounds/",filename:"negative_beep",loop:!1,volume:1,ingamename:"negative_beep"});d+=h.length;s_aSounds=[];for(var k=0;k<
h.length;k++)s_aSounds[h[k].ingamename]=new Howl({src:[h[k].path+h[k].filename+".mp3"],autoplay:!1,preload:!0,loop:h[k].loop,volume:h[k].volume,onload:s_oMain.soundLoaded})};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("local_but","./sprites/local_but.png");s_oSpriteLibrary.addSprite("multiplayer_but","./sprites/multiplayer_but.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("alert_box",
"./sprites/alert_box.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("but_yes_big","./sprites/but_yes_big.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_fullscreen",
"./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("but_p1","./sprites/but_p1.png");s_oSpriteLibrary.addSprite("but_p2","./sprites/but_p2.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_speed","./sprites/but_speed.png");s_oSpriteLibrary.addSprite("white_piece","./sprites/white_piece.png");s_oSpriteLibrary.addSprite("red_piece","./sprites/red_piece.png");s_oSpriteLibrary.addSprite("highlight",
"./sprites/highlight.png");s_oSpriteLibrary.addSprite("triangle_white","./sprites/triangle_white.png");s_oSpriteLibrary.addSprite("triangle_red","./sprites/triangle_red.png");s_oSpriteLibrary.addSprite("but_dice","./sprites/but_dice.png");s_oSpriteLibrary.addSprite("launch_dices_white","./sprites/launch_dices_white.png");s_oSpriteLibrary.addSprite("launch_dices_red","./sprites/launch_dices_red.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("turn_p1","./sprites/turn_p1.png");
s_oSpriteLibrary.addSprite("turn_p2","./sprites/turn_p2.png");s_oSpriteLibrary.addSprite("turn_cpu","./sprites/turn_cpu.png");s_oSpriteLibrary.addSprite("light_turn","./sprites/turn_selection.png");s_oSpriteLibrary.addSprite("bg_select_mode","./sprites/bg_select_mode.jpg");s_oSpriteLibrary.addSprite("dice_white_a_1","./sprites/dice_white_a_1.png");s_oSpriteLibrary.addSprite("dice_white_a_2","./sprites/dice_white_a_2.png");s_oSpriteLibrary.addSprite("dice_white_a_3","./sprites/dice_white_a_3.png");
s_oSpriteLibrary.addSprite("dice_white_a_4","./sprites/dice_white_a_4.png");s_oSpriteLibrary.addSprite("dice_white_a_5","./sprites/dice_white_a_5.png");s_oSpriteLibrary.addSprite("dice_white_a_6","./sprites/dice_white_a_6.png");s_oSpriteLibrary.addSprite("dice_white_b_1","./sprites/dice_white_b_1.png");s_oSpriteLibrary.addSprite("dice_white_b_2","./sprites/dice_white_b_2.png");s_oSpriteLibrary.addSprite("dice_white_b_3","./sprites/dice_white_b_3.png");s_oSpriteLibrary.addSprite("dice_white_b_4","./sprites/dice_white_b_4.png");
s_oSpriteLibrary.addSprite("dice_white_b_5","./sprites/dice_white_b_5.png");s_oSpriteLibrary.addSprite("dice_white_b_6","./sprites/dice_white_b_6.png");s_oSpriteLibrary.addSprite("dice_red_a_1","./sprites/dice_red_a_1.png");s_oSpriteLibrary.addSprite("dice_red_a_2","./sprites/dice_red_a_2.png");s_oSpriteLibrary.addSprite("dice_red_a_3","./sprites/dice_red_a_3.png");s_oSpriteLibrary.addSprite("dice_red_a_4","./sprites/dice_red_a_4.png");s_oSpriteLibrary.addSprite("dice_red_a_5","./sprites/dice_red_a_5.png");
s_oSpriteLibrary.addSprite("dice_red_a_6","./sprites/dice_red_a_6.png");s_oSpriteLibrary.addSprite("dice_red_b_1","./sprites/dice_red_b_1.png");s_oSpriteLibrary.addSprite("dice_red_b_2","./sprites/dice_red_b_2.png");s_oSpriteLibrary.addSprite("dice_red_b_3","./sprites/dice_red_b_3.png");s_oSpriteLibrary.addSprite("dice_red_b_4","./sprites/dice_red_b_4.png");s_oSpriteLibrary.addSprite("dice_red_b_5","./sprites/dice_red_b_5.png");s_oSpriteLibrary.addSprite("dice_red_b_6","./sprites/dice_red_b_6.png");
d+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){a++;e.refreshLoader(Math.floor(a/d*100))};this._onAllImagesLoaded=function(){};this._onRemovePreloader=function(){try{checkMoreGames(s_szGameID,"bottom-left",["board","casual","multiplayer"],[],-1,"light_brown")}catch(h){}e.unload();this.gotoMenu()};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.gotoMenu=function(){try{showMoreGames()}catch(h){}new CMenu;c=STATE_MENU};this.gotoGame=
function(){s_oGame=new CGameSingle(g);c=STATE_GAME};this.gotoGameMulti=function(){s_b2Players=!0;s_oGame=new CGameMulti(g);c=STATE_GAME};this.gotoGameWithBot=function(){s_b2Players=!1;s_oGame=new CGameSingleWithBot(g);c=STATE_GAME};this.gotoSelectPlayers=function(){new CSelectPlayers};this.gotoSelectMode=function(){new CSelectMode};this.gotoHelp=function(){new CHelp;c=STATE_HELP};this.stopUpdate=function(){f=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();f=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(h){if(!1!==f){var k=(new Date).getTime();s_iTimeElaps=k-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=k;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);c===STATE_GAME&&s_oGame.update();s_oStage.update(h)}};
s_oMain=this;ENABLE_CHECK_ORIENTATION=b.check_orientation;ENABLE_FULLSCREEN=b.fullscreen;MULTIPLIER_SCORE=100;var g=b;this.initContainer()}var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_iLastLevel=1,s_bFullscreen=!1,s_bStorageAvailable=!0,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_aSounds,s_oNetworkManager;
function CMenu(){var b,f,a,d,c,e,g,h,k,l,m,n,p,q,r,v,y,D,u=null,B=null;this._init=function(){s_b2Players=!1;n=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(n);a=CANVAS_WIDTH/2-200;d=CANVAS_HEIGHT-100;var z=s_oSpriteLibrary.getSprite("local_but");p=new CGfxButton(a,d,z,s_oStage);p.addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this);b=CANVAS_WIDTH/2+200;f=CANVAS_HEIGHT-100;z=s_oSpriteLibrary.getSprite("multiplayer_but");q=new CGfxButton(b,f,z,s_oStage);q.addEventListener(ON_MOUSE_UP,
this._onButMultiplayerRelease,this);z=s_oSpriteLibrary.getSprite("but_info");k=z.width/2+10;l=z.height/2+10;y=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,z,s_oStage);y.addEventListener(ON_MOUSE_UP,this._onCreditsBut,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)z=s_oSpriteLibrary.getSprite("audio_icon"),g=CANVAS_WIDTH-z.width/4-10,h=z.height/2+10,v=new CToggle(g,h,z,s_bAudioActive,s_oStage),v.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);z=window.document;var x=z.documentElement;
u=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;B=z.exitFullscreen||z.mozCancelFullScreen||z.webkitExitFullscreen||z.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(u=!1);u&&screenfull.enabled&&(z=s_oSpriteLibrary.getSprite("but_fullscreen"),c=k+z.width/2+5,e=z.height/2+10,D=new CToggle(c,e,z,s_bFullscreen,s_oStage),D.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));r=new createjs.Shape;r.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);
s_oStage.addChild(r);createjs.Tween.get(r).to({alpha:0},1E3).call(function(){r.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.pulseTitle=function(){var z=this;(new createjs.Tween.get(void 0)).to({scaleX:.9,scaleY:.9},850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn).call(function(){z.pulseTitle()})};this.unload=function(){s_oStage.removeChild(void 0);p.unload();p=null;q.unload();q=null;r.visible=!1;y.unload();
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)v.unload(),v=null;u&&screenfull.enabled&&D.unload();s_oStage.removeChild(n);s_oMenu=n=null};this.refreshButtonPos=function(z,x){p.setPosition(a,d-x);q.setPosition(b,f-x);y.setPosition(k+z,x+l);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||v.setPosition(g-z,x+h);u&&screenfull.enabled&&D.setPosition(c+z,e+x)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onCreditsBut=function(){new CCreditsPanel};this.resetFullscreenBut=
function(){D.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?B.call(window.document):u.call(window.document.documentElement);sizeHandler()};this._onButLocalRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(z){}this.unload();s_bPlayWithBot=s_bMultiplayer=!1;$(s_oMain).trigger("start_session");s_oMain.gotoSelectPlayers()};this._onButMultiplayerRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&
gdsdk.showAd();try{hideMoreGames()}catch(z){}$(s_oMain).trigger("start_session");s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this._onGameStart);s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._checkMatchWithBot);s_oNetworkManager.addEventListener(ON_BACK_FROM_A_ROOM,this.clearBotCheck);s_oNetworkManager.connectToSystem()};this._onGameStart=function(){s_oMenu.clearBotCheck();s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oMenu.unload();
s_oMain.gotoGameMulti()};this._checkMatchWithBot=function(){var z=randomFloatBetween(18E3,26E3);m=setTimeout(function(){s_bPlayWithBot=s_bMultiplayer=!0;g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.disconnect();s_oNetworkManager.generateRandomName();s_oMenu.unload();s_oMain.gotoGameWithBot()},z)};this.clearBotCheck=function(){clearTimeout(m)};s_oMenu=this;this._init()}
var s_oMenu=null,CGameBase=function(b){this._bStartGame;this._bPieceMoving;this._iNumTurns;this._iScore;this._oInterface;this._oEndPanel;this._bPieceClicked;this._oTriangleContainer;this._aTriangle;this._oPieceContainer;this._iCounterDistribution;this._aPosDistribution;this._bTurnPlayer1;this._iDice1;this._iDice2;this._bDice1;this._bDice2;this._bDoubleDice;this._iPlayerDice;this._aTmpPieces;this._oCurrentPiece;this._oContainerBar;this._aBar;this._oEndRectWhite;this._oEndRectBlack;this._oWhiteDices;
this._oRedDices;this._bCpuTurned;this._iBearOffWhite;this._iBearOffBlack;this._oAlertBox;this._oThinking;this._bFastDistribution;this._oFastDistributionBut;this._oRuleFilter;this._aRuleToCheck};
CGameBase.prototype._init=function(){MS_DISTRIBUTION=300;this._aTmpPieces=[];this.reset();var b=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(b);this._oTriangleContainer=new createjs.Container;s_oStage.addChild(this._oTriangleContainer);this._aBar=[];this._oContainerBar=new createjs.Container;s_oStage.addChild(this._oContainerBar);this._aBar.push(new CBar(CANVAS_WIDTH/2,CANVAS_HEIGHT/2-265,BAR_UP,this._oContainerBar));this._aBar.push(new CBar(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+
265,BAR_DOWN,this._oContainerBar));this._aTriangle=[];this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+310,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_0));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+248,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_1));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+186,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_2));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+124,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_3));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+
62,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_4));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_5));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+310,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_6));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+248,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_7));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+186,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_8));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+
124,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_9));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+62,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_10));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT,Y_TRIANGLE_UP,this._oTriangleContainer,CELL_11));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_12));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+62,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_13));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+
124,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_14));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+186,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_15));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+248,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_16));this._aTriangle.push(new CTriangle(X_TRIANGLE_LEFT+310,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_17));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_18));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+
62,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_19));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+124,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_20));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+186,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_21));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+248,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_22));this._aTriangle.push(new CTriangle(X_TRIANGLE_RIGHT+310,Y_TRIANGLE_DOWN,this._oTriangleContainer,CELL_23));this._oPieceContainer=
new createjs.Container;s_oStage.addChild(this._oPieceContainer);this._aPosDistribution=[0,0,11,11,11,11,11,16,16,16,18,18,18,18,18,23,23,12,12,12,12,12,7,7,7,5,5,5,5,5];for(b=0;b<NUM_PIECES;b++)this._aTmpPieces.push(new CPiece(X_OFFBOARD,Y_OFFBOARD_DOWN+17*b,WHITE_PIECE,this._oPieceContainer,b));for(b=0;b<NUM_PIECES;b++)this._aTmpPieces.push(new CPiece(X_OFFBOARD,Y_OFFBOARD_UP+17*b,BLACK_PIECE,this._oPieceContainer,b+NUM_PIECES));this._oWhiteDices=new CDices(0);this._oRedDices=new CDices(1);this._oAlertBox=
new CAlertBox(s_oStage);b=s_oSpriteLibrary.getSprite("but_speed");this._oFastDistributionBut=new CGfxButton(CANVAS_WIDTH-200,CANVAS_HEIGHT/2,b,s_oStage);this._oFastDistributionBut.addEventListener(ON_MOUSE_DOWN,function(){s_oGame.onFastDistribution()});this._oInterface=new CInterface;this._oRuleFilter=new CRuleFilter;console.clear()};
CGameBase.prototype.reset=function(){this._bPieceMoving=this._bFastDistribution=!1;this._iBearOffBlack=this._iBearOffWhite=0;this._bPieceClicked=!1;this._bStartGame=!0;this._iPlayerDice=this._iCounterDistribution=this._iScore=0;this._bCpuTurned=!1;this._iDice2=this._iDice1=0;this._bDoubleDice=this._bDice2=this._bDice1=!1;this._iNumTurns=0};
CGameBase.prototype.initDistribution=function(){this._bFastDistribution&&(MS_DISTRIBUTION=0);if(this._iCounterDistribution<2*NUM_PIECES){var b=this._aTmpPieces[this._iCounterDistribution];var f=this._aPosDistribution[this._iCounterDistribution];this._oPieceContainer.addChildAt(b.getPiece(),this._oPieceContainer.numChildren);b.movePieceDistribution(this._aTriangle[f].getX(),this._aTriangle[f].getY());b.setTriangle(f);this._aTriangle[f].addPiece(b);this._iCounterDistribution++}else s_oGame._onAfterDistribution()};
CGameBase.prototype.onFastDistribution=function(){this._bFastDistribution=!0;(new createjs.Tween.get(s_oGame._oFastDistributionBut.getButtonImage())).to({x:CANVAS_WIDTH+200},300).call(function(){s_oGame._oFastDistributionBut.unload()})};
CGameBase.prototype.onClickedPiece=function(b){if(!this._bPieceMoving){playSound("click_cell",1,!1);-1!==b.getTriangle()&&24!==b.getTriangle()?this._oCurrentPiece=this._aTriangle[b.getTriangle()].getLastPiece():b.getColor()===WHITE_PIECE?this._oCurrentPiece=this._aBar[BAR_UP].getLastPiece():this._oCurrentPiece=this._aBar[BAR_DOWN].getLastPiece();var f=this._oCurrentPiece.getColor()===WHITE_PIECE?BAR_UP:BAR_DOWN;if(0<this._iPlayerDice)if(this._oCurrentPiece.setOnTop(),!1===this._bPieceClicked){if(this.isPossibleMove(this._oCurrentPiece)){this._oCurrentPiece.setClicked(!0);
this._bPieceClicked=!0;var a=this.isPossibleMove(this._oCurrentPiece);if(this._bDoubleDice){if(0<a[0].length)this._aTriangle[a[0][0].iFocusTriangle].onFocus(a[0][0]);if(1<a[0].length&&2>this._aBar[f].getNumPieces())this._aTriangle[a[0][1].iFocusTriangle].onFocus(a[0][1]);if(2<a[0].length&&2>this._aBar[f].getNumPieces())this._aTriangle[a[0][2].iFocusTriangle].onFocus(a[0][2]);if(3<a[0].length&&2>this._aBar[f].getNumPieces())this._aTriangle[a[0][3].iFocusTriangle].onFocus(a[0][3])}else{if(0<a[0].length)this._aTriangle[a[0][0].iFocusTriangle].onFocus(a[0][0]);
if(0<a[1].length)this._aTriangle[a[1][0].iFocusTriangle].onFocus(a[1][0]);if(0<a[2].length&&2>this._aBar[f].getNumPieces())this._aTriangle[a[2][0].iFocusTriangle].onFocus(a[2][0])}0<a[3].length&&(a[3][0].iFocusTriangle===FINAL_CELL_WHITE?(b=s_oSpriteLibrary.getSprite("light_turn"),this._oEndRectWhite=createBitmap(b,b.width,b.height),this._oEndRectWhite.regX=11,this._oEndRectWhite.regY=12,this._oEndRectWhite.x=X_INTERFACE_PLAYER_END,this._oEndRectWhite.y=Y_INTERFACE_PLAYER_2,this._oEndRectWhite.on("mousedown",
function(){s_oGame.onClickedTriangle(a[3][0])}),this._oEndRectWhite.on("rollover",function(e){s_bMobile||(e.target.cursor="pointer")}),this._oEndRectWhite.on("rollout",function(e){s_bMobile||(e.target.cursor="default")}),s_oStage.addChild(this._oEndRectWhite)):(b=s_oSpriteLibrary.getSprite("light_turn"),this._oEndRectBlack=createBitmap(b,b.width,b.height),this._oEndRectBlack.regX=11,this._oEndRectBlack.regY=12,this._oEndRectBlack.x=X_INTERFACE_PLAYER_END,this._oEndRectBlack.y=Y_INTERFACE_PLAYER_1,
this._oEndRectBlack.on("mousedown",function(){s_oGame.onClickedTriangle(a[3][0])}),this._oEndRectBlack.on("rollover",function(e){s_bMobile||(e.target.cursor="pointer")}),this._oEndRectBlack.on("rollout",function(e){s_bMobile||(e.target.cursor="default")}),s_oStage.addChild(this._oEndRectBlack)))}}else if(!0===this._oCurrentPiece.getStateClick()){this._oCurrentPiece.setClicked(!1);this._bPieceClicked=!1;s_oStage.removeChild(this._oEndRectWhite);s_oStage.removeChild(this._oEndRectBlack);for(var d=0;d<
this._aTriangle.length;d++)this._aTriangle[d].onIdle()}else{s_oStage.removeChild(this._oEndRectWhite);s_oStage.removeChild(this._oEndRectBlack);for(d=0;d<this._aTriangle.length;d++)if(this._aTriangle[d].onIdle(),0<this._aTriangle[d].getNumPieces()){f=this._aTriangle[d].getArrayPieces();for(var c=0;c<f.length;c++)f[c].setClicked(!1)}this._bPieceClicked=!1;this.onClickedPiece(b)}}};
CGameBase.prototype.isPossibleMove=function(b){var f=b.getColor();b=b.getTriangle();if(f===WHITE_PIECE){var a=1;var d=FINAL_CELL_WHITE}else a=-1,d=FINAL_CELL_BLACK;var c=[[],[],[],[]],e;if(this._bDoubleDice)(e=this._aTriangle[b+this._iDice1*a])?(1>=e.getNumPieces()||e.getColor()===f)&&c[0].push({iFocusTriangle:b+this._iDice1*a,cost:1,aMoveTriangle:[b+this._iDice1*a]}):this.checkBearOff()&&(b+this._iDice1*a===d||this.checkPieceBefore(f,b))&&c[3].push({iFocusTriangle:d,cost:1,aMoveTriangle:[d]}),0<
c[0].length&&1<this._iPlayerDice&&((e=this._aTriangle[b+2*this._iDice1*a])?(1>=e.getNumPieces()||e.getColor()===f)&&c[0].push({iFocusTriangle:b+2*this._iDice1*a,cost:2,aMoveTriangle:[b+this._iDice1*a,b+2*this._iDice1*a]}):this.checkBearOff()&&(b+2*this._iDice1*a===d||this.checkPieceBefore(f,b+this._iDice1*a))&&c[3].push({iFocusTriangle:d,cost:2,aMoveTriangle:[b+this._iDice1*a,d]})),1<c[0].length&&2<this._iPlayerDice&&((e=this._aTriangle[b+3*this._iDice1*a])?(1>=e.getNumPieces()||e.getColor()===f)&&
c[0].push({iFocusTriangle:b+3*this._iDice1*a,cost:3,aMoveTriangle:[b+this._iDice1*a,b+2*this._iDice1*a,b+3*this._iDice1*a]}):this.checkBearOff()&&(b+3*this._iDice1*a===d||this.checkPieceBefore(f,b+2*this._iDice1*a))&&c[3].push({iFocusTriangle:d,cost:3,aMoveTriangle:[b+this._iDice1*a,b+2*this._iDice1*a,d]})),2<c[0].length&&3<this._iPlayerDice&&((e=this._aTriangle[b+4*this._iDice1*a])?(1>=e.getNumPieces()||e.getColor()===f)&&c[0].push({iFocusTriangle:b+4*this._iDice1*a,cost:4,aMoveTriangle:[b+this._iDice1*
a,b+2*this._iDice1*a,b+3*this._iDice1*a,b+4*this._iDice1*a]}):this.checkBearOff()&&(b+4*this._iDice1*a===d||this.checkPieceBefore(f,b+3*this._iDice1*a))&&c[3].push({iFocusTriangle:d,cost:4,aMoveTriangle:[b+this._iDice1*a,b+2*this._iDice1*a,b+2*this._iDice1*a,d]}));else if((e=this._aTriangle[b+this._iDice1*a])?this._bDice1&&(1>=e.getNumPieces()||e.getColor()===f)&&c[0].push({iFocusTriangle:b+this._iDice1*a,cost:1,aMoveTriangle:[b+this._iDice1*a],iDiceDisable:0}):this._bDice1&&this.checkBearOff()&&
(b+this._iDice1*a===d||this.checkPieceBefore(f,b))&&c[3].push({iFocusTriangle:d,cost:1,iDiceDisable:0,aMoveTriangle:[d]}),(e=this._aTriangle[b+this._iDice2*a])?this._bDice2&&(1>=e.getNumPieces()||e.getColor()===f)&&c[1].push({iFocusTriangle:b+this._iDice2*a,cost:1,aMoveTriangle:[b+this._iDice2*a],iDiceDisable:1}):this._bDice2&&this.checkBearOff()&&(b+this._iDice2*a===d||this.checkPieceBefore(f,b))&&c[3].push({iFocusTriangle:d,cost:1,iDiceDisable:1,aMoveTriangle:[d]}),0<c[0].length||0<c[1].length){var g=
0<c[0].length?c[0][0].iFocusTriangle:c[1][0].iFocusTriangle;0<c[0].length&&1===this._aTriangle[c[0][0].iFocusTriangle].getNumPieces()&&(g=c[0][0].iFocusTriangle);0<c[1].length&&1===this._aTriangle[c[1][0].iFocusTriangle].getNumPieces()&&(g=c[1][0].iFocusTriangle);(e=this._aTriangle[b+(this._iDice1+this._iDice2)*a])?this._bDice1&&this._bDice2&&(1>=e.getNumPieces()||e.getColor()===f)&&c[2].push({iFocusTriangle:b+(this._iDice1+this._iDice2)*a,cost:2,aMoveTriangle:[g,b+(this._iDice1+this._iDice2)*a],
iDiceDisable:2}):this._bDice1&&this._bDice2&&this.checkBearOff()&&(b+(this._iDice1+this._iDice2)*a===d||this.checkPieceBefore(f,g))&&c[3].push({iFocusTriangle:d,cost:2,iDiceDisable:2,aMoveTriangle:[g,d]})}return 0<c[0].length||0<c[1].length||0<c[3].length?c:null};
CGameBase.prototype.checkPieceBefore=function(b,f){var a=!0;if(b===WHITE_PIECE)for(var d=0;d<f;d++)for(var c=0;c<this._aTriangle[d].getArrayPieces().length;c++){var e=this._aTriangle[d].getArrayPieces();if(e[c].getColor()===WHITE_PIECE){a=!1;break}}else for(d=23;d>f;d--)for(c=0;c<this._aTriangle[d].getArrayPieces().length;c++)if(e=this._aTriangle[d].getArrayPieces(),e[c].getColor()===BLACK_PIECE){a=!1;break}return a};
CGameBase.prototype.checkBearOff=function(){var b=!0;if(this._bTurnPlayer1)for(var f=0;f<this._aTriangle.length;f++){var a=this._aTriangle[f].getArrayPieces();for(var d=0;d<a.length;d++)if(a[d].getColor()===WHITE_PIECE&&(!0===a[d].isOnBar()||18>a[d].getTriangle())){b=!1;break}}else for(f=0;f<this._aTriangle.length;f++)for(a=this._aTriangle[f].getArrayPieces(),d=0;d<a.length;d++)if(a[d].getColor()===BLACK_PIECE&&(!0===a[d].isOnBar()||5<a[d].getTriangle())){b=!1;break}return b};
CGameBase.prototype.checkAvaiableMove=function(){var b=!1;if(this._bTurnPlayer1){var f=WHITE_PIECE;var a=BAR_UP}else f=BLACK_PIECE,a=BAR_DOWN;for(var d=0;d<this._aTriangle.length;d++){var c=this._aTriangle[d].getArrayPieces();for(var e=0;e<c.length;e++)if(c[e].getColor()===f&&!0===c[e].getStateListener()&&this.isPossibleMove(c[e])){b=!0;break}}c=this._aBar[a].getArrayPieces();for(d=0;d<this._aBar[a].getNumPieces();d++)if(this.isPossibleMove(c[d])){b=!0;break}return b};
CGameBase.prototype.updateInput=function(){for(var b,f=0;f<this._aTriangle.length;f++)if(0<this._aTriangle[f].getNumPieces()){b=this._aTriangle[f].getArrayPieces();for(var a=0;a<b.length;a++)b[a].unloadListeners()}for(f=0;f<this._aBar.length;f++)if(0<this._aBar[f].getNumPieces())for(b=this._aBar[f].getArrayPieces(),a=0;a<b.length;a++)b[a].unloadListeners();if(s_b2Players)if(this._bTurnPlayer1)if(0===this._aBar[BAR_UP].getNumPieces())for(f=0;f<this._aTriangle.length;f++){if(0<this._aTriangle[f].getNumPieces()&&
(b=this._aTriangle[f].getArrayPieces(),this._aTriangle[f].getColor()===WHITE_PIECE))for(a=0;a<b.length;a++)b[a].initListeners()}else for(f=0;f<this._aBar[0].getArrayPieces().length;f++)this._aBar[BAR_UP].getArrayPieces()[f].initListeners();else if(0===this._aBar[BAR_DOWN].getNumPieces())for(f=0;f<this._aTriangle.length;f++){if(0<this._aTriangle[f].getNumPieces()&&(b=this._aTriangle[f].getArrayPieces(),this._aTriangle[f].getColor()===BLACK_PIECE))for(a=0;a<b.length;a++)b[a].initListeners()}else for(f=
0;f<this._aBar[1].getArrayPieces().length;f++)this._aBar[BAR_DOWN].getArrayPieces()[f].initListeners();else if(this._bTurnPlayer1)if(0===this._aBar[BAR_UP].getNumPieces())for(f=0;f<this._aTriangle.length;f++){if(0<this._aTriangle[f].getNumPieces()&&(b=this._aTriangle[f].getArrayPieces(),this._aTriangle[f].getColor()===WHITE_PIECE))for(a=0;a<b.length;a++)b[a].initListeners()}else for(f=0;f<this._aBar[0].getArrayPieces().length;f++)this._aBar[BAR_UP].getArrayPieces()[f].initListeners();else{if(0===
this._aBar[BAR_DOWN].getNumPieces())for(f=0;f<this._aTriangle.length;f++){if(0<this._aTriangle[f].getNumPieces()&&(b=this._aTriangle[f].getArrayPieces(),this._aTriangle[f].getColor()===BLACK_PIECE))for(a=0;a<b.length;a++)b[a].cpuInit()}else for(f=0;f<this._aBar[1].getArrayPieces().length;f++)this._aBar[BAR_DOWN].getArrayPieces()[f].cpuInit();!1===this._bCpuTurned&&(this._bCpuTurned=!0,this.rollDice())}};
CGameBase.prototype.afterMove=function(){this._bPieceMoving=!1;s_oGame.checkGameOver();0<this._iPlayerDice?!0===s_oGame.checkAvaiableMove()?(s_oGame.updateInput(),s_b2Players||this._bTurnPlayer1||s_oGame.cpuThinkBeforeChoice()):(this._oAlertBox.show(TEXT_NO_MOVES_AVAILABLE),playSound("negative_beep",1,!1),this._oWhiteDices.fadeOutTween(),this._oRedDices.fadeOutTween(),this._iPlayerDice=0,this._bDice2=this._bDice1=this._bDoubleDice=!1,s_oGame.changeTurn(),s_oGame.updateInput()):(this._bDoubleDice=
!1,this._oWhiteDices.fadeOutTween(),s_oGame.checkGameOver(),s_oGame.changeTurn(),s_oGame.updateInput())};
CGameBase.prototype.afterRollDice=function(){this._bTurnPlayer1?(this._iDice1=this._oWhiteDices.returnDiceResult1(),this._iDice2=this._oWhiteDices.returnDiceResult2()):(this._iDice1=this._oRedDices.returnDiceResult1(),this._iDice2=this._oRedDices.returnDiceResult2());this._bDice2=this._bDice1=!0;this._iDice1!==this._iDice2?this._iPlayerDice=2:(this._iPlayerDice=4,this._oAlertBox.show(TEXT_DOUBLE_DICES),playSound("positive_beep",1,!1),this._bDoubleDice=!0);this._aRuleToCheck=this._oRuleFilter.checkMovesAvailable(this._bTurnPlayer1);
!1===s_oGame.checkAvaiableMove()?(this._bDoubleDice=this._bDice2=this._bDice1=!1,this._iPlayerDice=0,s_oGame.changeTurn(),s_oGame.updateInput(),!s_b2Players&&this._bTurnPlayer1&&this._oInterface.setVisibleButDice(!0),s_b2Players||this._bTurnPlayer1||this._oInterface.setVisibleButDice(!1),s_b2Players&&this._oInterface.setVisibleButDice(!0),this._oAlertBox.show(TEXT_NO_MOVES_AVAILABLE),playSound("negative_beep",1,!1)):(this._oInterface.setVisibleButDice(!1),s_b2Players||!1!==this._bTurnPlayer1||(new createjs.Tween.get(s_oGame)).to({},
1500).call(s_oGame.cpuThinkBeforeChoice))};CGameBase.prototype.debug=function(){for(var b=0;b<this._aTriangle.length;b++)0<this._aTriangle[b].getNumPieces()&&this._aTriangle[b].getLastPiece().unloadListeners()};CGameBase.prototype.unload=function(){this._bStartGame=!1;s_oGame._oInterface.unload();s_oGame._oEndPanel&&s_oGame._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};
CGameBase.prototype.onRestart=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("share_event",this._iScore);$(s_oMain).trigger("show_interlevel_ad");this._oEndPanel.hide();s_oGame.reset();for(var b=0;b<this._aTriangle.length;b++)this._aTriangle[b].reset();s_oGame.initDistribution()};CGameBase.prototype.onConfirmExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("share_event",this._iScore);$(s_oMain).trigger("show_interlevel_ad");s_oGame.unload();s_oMain.gotoMenu()};
CGameBase.prototype.checkGameOver=function(){for(var b,f=0,a=0,d=0;d<this._aTriangle.length;d++){b=this._aTriangle[d].getArrayPieces();for(var c=0;c<b.length;c++)b[c].getColor()===WHITE_PIECE?f++:a++;f+=this._aBar[BAR_UP].getNumPieces();a+=this._aBar[BAR_DOWN].getNumPieces()}0===f?(this._bStartGame=!1,this.gameOver(0)):0===a&&(this._bStartGame=!1,this.gameOver(1))};
CGameBase.prototype.cpuThinkBeforeChoice=function(){this._oThinking.show();var b=randomIntBetween(MIN_TIME_THINK,MAX_TIME_THINK);setTimeout(function(){s_oGame.cpuChoicePiece()},b)};
CGameBase.prototype.cpuChoicePiece=function(){var b,f=[],a=0;if(0<this._aBar[BAR_DOWN].getNumPieces()){var d=this._aBar[BAR_DOWN].getLastPiece();if(b=s_oGame.isPossibleMove(d))for(var c=0;c<b.length-1;c++)for(var e=0;e<b[c].length;e++)a=0,1===this._aTriangle[b[c][e].iFocusTriangle].getNumPieces()&&this._aTriangle[b[c][e].iFocusTriangle].getColor()===BLACK_PIECE&&a++,13>b[c][e].iFocusTriangle&&a++,13<b[c][e].iFocusTriangle&&1===this._aTriangle[b[c][e].iFocusTriangle].getNumPieces()&&a++,13>b[c][e].iFocusTriangle&&
1===this._aTriangle[b[c][e].iFocusTriangle].getNumPieces()&&a--,1===this._aTriangle[b[c][e].iFocusTriangle].getNumPieces()&&13>b[c][e].iFocusTriangle&&a++,f.push({oMove:b[c][e],iPoints:a,oCurrentPiece:d})}else for(c=0;c<this._aTriangle.length;c++)if(0<this._aTriangle[c].getNumPieces()&&(d=this._aTriangle[c].getLastPiece(),d.getColor()===BLACK_PIECE&&d.getStateListener()&&(b=s_oGame.isPossibleMove(d)))){for(var g=0;g<b.length-1;g++)for(e=0;e<b[g].length;e++)a=0,3>this._aTriangle[d.getTriangle()].getNumPieces()&&
(a-=3),1===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&this._aTriangle[b[g][e].iFocusTriangle].getColor()===BLACK_PIECE&&(a+=3),1===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&this._aTriangle[b[g][e].iFocusTriangle].getColor()===WHITE_PIECE&&(a+=5),13>b[g][e].iFocusTriangle&&a++,13<b[g][e].iFocusTriangle&&a--,11<b[g][e].iFocusTriangle&&1===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&this._aTriangle[b[g][e].iFocusTriangle].getColor()===WHITE_PIECE&&(a+=4),11>b[g][e].iFocusTriangle&&
1===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&this._aTriangle[b[g][e].iFocusTriangle].getColor()===WHITE_PIECE&&a--,1===this._aTriangle[d.getTriangle()].getNumPieces()&&a++,1===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&13>b[g][e].iFocusTriangle&&a++,5<d.getTriangle()&&5>=b[g][e].iFocusTriangle&&(a+=5),5>=d.getTriangle()&&3>this._aTriangle[d.getTriangle()].getNumPieces()&&(a-=10),6>b[g][e].iFocusTriangle&&0===this._aTriangle[b[g][e].iFocusTriangle].getNumPieces()&&(a-=5),
5>=d.getTriangle()&&(a-=4),f.push({oMove:b[g][e],iPoints:a,oCurrentPiece:d});for(e=0;e<b[3].length;e++)f.push({oMove:b[3][e],iPoints:50,oCurrentPiece:d})}f.sort(function(h,k){return parseFloat(k.iPoints)-parseFloat(h.iPoints)});f=this.cpuRemoveNotAllowedMoves(f);this._oCurrentPiece=f[0].oCurrentPiece;this._oCurrentPiece.setOnTop();s_oGame.onClickedTriangle(f[0].oMove)};
CGameBase.prototype.cpuRemoveNotAllowedMoves=function(b){for(var f=[],a=0;a<b.length;a++){var d=b[a].oCurrentPiece.getTriangle();this._oRuleFilter.checkForbiddenMoveInList(b[a].oMove,d,this._aRuleToCheck)===RULE_BROKEN_NONE&&f.push(b[a])}return f};CGameBase.prototype.update=function(){s_oGame._oThinking&&s_oGame._oThinking.update()};CGameBase.prototype.getPieceByIndex=function(b){for(var f=0;f<this._aTmpPieces.length;f++)if(this._aTmpPieces[f].getIndex()===b)return this._aTmpPieces[f]};
CGameBase.prototype.getTriangles=function(){return this._aTriangle};CGameBase.prototype.getBars=function(){return this._aBar};CGameBase.prototype.getDiceResult=function(){return{dice1:this._iDice1,dice2:this._iDice2}};var CGameSingle=function(b){CGameBase.call(this,b);this._init()};CGameSingle.prototype=Object.create(CGameBase.prototype);CGameSingle.prototype._init=function(){CGameBase.prototype._init();this._startGame()};
CGameSingle.prototype._startGame=function(){50<randomFloatBetween(1,100)?this._bTurnPlayer1=!0:this._bTurnPlayer1=!1;this.initDistribution();this._oThinking=new CThinking;this._oThinking.hide();this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.addEventListener(ON_BACK_MENU,this.onConfirmExit,this);this._oEndPanel.addEventListener(ON_RESTART,this.onRestart,this)};
CGameSingle.prototype._onAfterDistribution=function(){if(!this._bFastDistribution)s_oGame.onFastDistribution();(s_b2Players||this._bTurnPlayer1)&&s_oInterface.setVisibleButDice(!0);s_oInterface.onFocusTurn(this._bTurnPlayer1);s_oGame.updateInput()};
CGameSingle.prototype.changeTurn=function(){this._iNumTurns++;this._bTurnPlayer1=!this._bTurnPlayer1;this._oInterface.onFocusTurn(this._bTurnPlayer1);s_b2Players||this._bTurnPlayer1?(this._oInterface.setVisibleButDice(!0),this._oThinking.hide()):this._bCpuTurned=!1;s_b2Players||this._bTurnPlayer1||this._oThinking.show()};
CGameSingle.prototype.rollDice=function(){s_oGame._oWhiteDices.fadeOutTween();s_oGame._oRedDices.fadeOutTween();s_oGame._bTurnPlayer1?s_oGame._oWhiteDices.show():s_oGame._bStartGame&&s_oGame._oRedDices.show();s_oGame._oInterface.setVisibleButDice(!1)};
CGameSingle.prototype.onClickedTriangle=function(b){playSound("click_cell",1,!1);var f=this._oCurrentPiece.getTriangle();switch(this._oRuleFilter.checkForbiddenMoveInList(b,f,this._aRuleToCheck)){case RULE_BROKEN_BOTH_DICE:this._oAlertBox.show(TEXT_RULEBROKEN_BOTH);return;case RULE_BROKEN_HIGHER_DICE:this._oAlertBox.show(TEXT_RULEBROKEN_HIGHER);return}var a;f=!1;var d=this._oCurrentPiece.getColor()===WHITE_PIECE?this._iBearOffWhite:this._iBearOffBlack;for(var c=0;c<this._aTriangle.length;c++)this._aTriangle[c].onIdle();
s_oStage.removeChild(this._oEndRectWhite);s_oStage.removeChild(this._oEndRectBlack);if(s_b2Players||this._bTurnPlayer1)this._oCurrentPiece.setClicked(!1),this._bPieceClicked=!1;-1===b.iFocusTriangle||24===b.iFocusTriangle?(f=!0,1<b.aMoveTriangle.length&&(a=b.aMoveTriangle[0])):a=b.aMoveTriangle[0];if(this._aTriangle[a])this._bPieceMoving=!0,this._aTriangle[a].getColor()!==this._oCurrentPiece.getColor()&&1===this._aTriangle[a].getNumPieces()&&(this._aTriangle[a].getLastPiece().getColor()===WHITE_PIECE?
(this._aTriangle[a].getLastPiece().movePiece(this._aBar[BAR_UP].getX(),this._aBar[BAR_UP].getY()),this._aTriangle[a].getLastPiece().setTriangle(-1),this._aTriangle[a].getLastPiece().setBar(!0),this._aBar[BAR_UP].addPiece(this._aTriangle[a].removePiece())):(this._aTriangle[a].getLastPiece().movePiece(this._aBar[BAR_DOWN].getX(),this._aBar[BAR_DOWN].getY()),this._aTriangle[a].getLastPiece().setTriangle(24),this._aTriangle[a].getLastPiece().setBar(!0),this._aBar[BAR_DOWN].addPiece(this._aTriangle[a].removePiece())));
else if(-1===b.iFocusTriangle||24===b.iFocusTriangle)this._oCurrentPiece.takeOutAnimation(),(new createjs.Tween.get(this._oCurrentPiece.getPiece())).to({x:this._oCurrentPiece.getXOut(),y:this._oCurrentPiece.getYOut(d)},300,createjs.Ease.cubicOut),this._oCurrentPiece.getColor()===WHITE_PIECE?this._iBearOffWhite++:this._iBearOffBlack++,this._aTriangle[this._oCurrentPiece.getTriangle()].removePiece(),this._oCurrentPiece.setTriangle(null),this._oCurrentPiece.unloadListeners();b.aMoveTriangle.shift();
0<b.aMoveTriangle.length?(new createjs.Tween.get(this._oCurrentPiece.getPiece())).to({x:this._aTriangle[a].getX(),y:this._aTriangle[a].getY()},700,createjs.Ease.cubicOut).call(function(){s_oGame.onClickedTriangle(b)}):(this._bTurnPlayer1||s_b2Players||(this._bCpuTurned=!0),this._iPlayerDice-=b.cost,this._bDoubleDice||(0===b.iDiceDisable?this._bDice1=!1:(1!==b.iDiceDisable&&(this._bDice1=!1),this._bDice2=!1)),f?this.afterMove():this._oCurrentPiece.movePieceOnBoard(this._aTriangle[a].getX(),this._aTriangle[a].getY()));
this._oCurrentPiece.isOnBar()?this._oCurrentPiece.getColor()===WHITE_PIECE?(this._aBar[BAR_UP].getLastPiece().setBar(!1),this._aTriangle[a].addPiece(this._aBar[BAR_UP].removePiece())):(this._aBar[BAR_DOWN].getLastPiece().setBar(!1),this._aTriangle[a].addPiece(this._aBar[BAR_DOWN].removePiece())):f||this._aTriangle[a].addPiece(this._aTriangle[this._oCurrentPiece.getTriangle()].removePiece());f||this._oCurrentPiece.setTriangle(a)};
CGameSingle.prototype.gameOver=function(b){for(var f=0,a=0;a<this._aTriangle.length;a++)f+=this._aTriangle[a].getNumPieces();for(a=0;a<this._aBar.length;a++)f+=this._aBar[a].getNumPieces();this._iScore=f*MULTIPLIER_SCORE;this._oEndPanel.show(this._iScore,b);this._oEndPanel.showButtons()};var CGameMulti=function(b){CGameBase.call(this,b);this._init()};CGameMulti.prototype=Object.create(CGameBase.prototype);CGameMulti.prototype._init=function(){CGameBase.prototype._init();this._startGame()};
CGameMulti.prototype._startGame=function(){this._bTurnPlayer1=!0;this._oFastDistributionBut.setVisible(!1);this._bFastDistribution=!0;this.initDistribution();this._oThinking=new CThinking;this._oThinking.hide();this._oThinking.setMessage(TEXT_WAITING_MOVES);s_oNetworkManager.isUserA()?(this._oThinking.hide(),s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getEnemyNickname())):(this._oThinking.show(),s_oInterface.setPlayersInfo(s_oNetworkManager.getEnemyNickname(),
s_oNetworkManager.getPlayerNickname()));this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.addEventListener(ON_BACK_MENU,this.onConfirmExit,this);this._oEndPanel.addEventListener(ON_RESTART,this._onConfirmRematch,this);s_oNetworkManager.addEventListener(ON_DISCONNECTION,this.playerDisconnectedFromGame)};
CGameMulti.prototype._onAfterDistribution=function(){if(!this._bFastDistribution)s_oGame.onFastDistribution();s_oNetworkManager.isUserA()&&s_oInterface.setVisibleButDice(!0);s_oInterface.onFocusTurn(this._bTurnPlayer1);s_oGame.updateInput()};
CGameMulti.prototype.changeTurn=function(){this._iNumTurns++;this._bTurnPlayer1=!this._bTurnPlayer1;this._oWhiteDices.fadeOutTween();this._oRedDices.fadeOutTween();s_oNetworkManager.isUserA()?this._bTurnPlayer1?(this._oThinking.hide(),s_oInterface.setVisibleButDice(!0)):(this._oThinking.show(),s_oInterface.setVisibleButDice(!1)):this._bTurnPlayer1?(this._oThinking.show(),s_oInterface.setVisibleButDice(!1)):(this._oThinking.hide(),s_oInterface.setVisibleButDice(!0));this._oInterface.onFocusTurn(this._bTurnPlayer1)};
CGameMulti.prototype.rollDice=function(){s_oGame._oWhiteDices.fadeOutTween();s_oGame._oRedDices.fadeOutTween();if(s_oGame._bTurnPlayer1){s_oGame._oWhiteDices.show();var b=this._oWhiteDices.returnDiceResult1();var f=this._oWhiteDices.returnDiceResult2()}else s_oGame._bStartGame&&(s_oGame._oRedDices.show(),b=this._oRedDices.returnDiceResult1(),f=this._oRedDices.returnDiceResult2());s_oGame._oInterface.setVisibleButDice(!1);var a={};a[MSG_ROLL_DICE]={first:b,second:f};s_oNetworkManager.sendMsg(MSG_ROLL_DICE,
JSON.stringify(a))};CGameMulti.prototype.remoteDiceRoll=function(b){s_oGame._bTurnPlayer1?s_oGame._oWhiteDices.showAResult(b.first,b.second):s_oGame._bStartGame&&s_oGame._oRedDices.showAResult(b.first,b.second)};
CGameMulti.prototype.onClickedTriangle=function(b,f){playSound("click_cell",1,!1);var a=this._oCurrentPiece.getTriangle();switch(this._oRuleFilter.checkForbiddenMoveInList(b,a,this._aRuleToCheck)){case RULE_BROKEN_BOTH_DICE:this._oAlertBox.show(TEXT_RULEBROKEN_BOTH);return;case RULE_BROKEN_HIGHER_DICE:this._oAlertBox.show(TEXT_RULEBROKEN_HIGHER);return}if(!f){a={aPossibleMove:b,iCurrentPieceIndex:this._oCurrentPiece.getIndex()};var d={};d[MSG_MOVE]=a;s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify(d))}var c;
a=!1;d=this._oCurrentPiece.getColor()===WHITE_PIECE?this._iBearOffWhite:this._iBearOffBlack;for(var e=0;e<this._aTriangle.length;e++)this._aTriangle[e].onIdle();s_oStage.removeChild(this._oEndRectWhite);s_oStage.removeChild(this._oEndRectBlack);if(s_b2Players||this._bTurnPlayer1)this._oCurrentPiece.setClicked(!1),this._bPieceClicked=!1;-1===b.iFocusTriangle||24===b.iFocusTriangle?(a=!0,1<b.aMoveTriangle.length&&(c=b.aMoveTriangle[0])):c=b.aMoveTriangle[0];if(this._aTriangle[c])this._aTriangle[c].getColor()!==
this._oCurrentPiece.getColor()&&1===this._aTriangle[c].getNumPieces()&&(this._aTriangle[c].getLastPiece().getColor()===WHITE_PIECE?(this._aTriangle[c].getLastPiece().movePiece(this._aBar[BAR_UP].getX(),this._aBar[BAR_UP].getY()),this._aTriangle[c].getLastPiece().setTriangle(-1),this._aTriangle[c].getLastPiece().setBar(!0),this._aBar[BAR_UP].addPiece(this._aTriangle[c].removePiece())):(this._aTriangle[c].getLastPiece().movePiece(this._aBar[BAR_DOWN].getX(),this._aBar[BAR_DOWN].getY()),this._aTriangle[c].getLastPiece().setTriangle(24),
this._aTriangle[c].getLastPiece().setBar(!0),this._aBar[BAR_DOWN].addPiece(this._aTriangle[c].removePiece())));else if(-1===b.iFocusTriangle||24===b.iFocusTriangle)this._oCurrentPiece.takeOutAnimation(),(new createjs.Tween.get(this._oCurrentPiece.getPiece())).to({x:this._oCurrentPiece.getXOut(),y:this._oCurrentPiece.getYOut(d)},300,createjs.Ease.cubicOut),this._oCurrentPiece.getColor()===WHITE_PIECE?this._iBearOffWhite++:this._iBearOffBlack++,this._aTriangle[this._oCurrentPiece.getTriangle()].removePiece(),
this._oCurrentPiece.setTriangle(null),this._oCurrentPiece.unloadListeners();b.aMoveTriangle.shift();0<b.aMoveTriangle.length?(new createjs.Tween.get(this._oCurrentPiece.getPiece())).to({x:this._aTriangle[c].getX(),y:this._aTriangle[c].getY()},700,createjs.Ease.cubicOut).call(function(){s_oGame.onClickedTriangle(b,!0)}):(this._bTurnPlayer1||s_b2Players||(this._bCpuTurned=!0),this._iPlayerDice-=b.cost,this._bDoubleDice||(0===b.iDiceDisable?this._bDice1=!1:(1!==b.iDiceDisable&&(this._bDice1=!1),this._bDice2=
!1)),a?this.afterMove():this._oCurrentPiece.movePieceOnBoard(this._aTriangle[c].getX(),this._aTriangle[c].getY()));this._oCurrentPiece.isOnBar()?this._oCurrentPiece.getColor()===WHITE_PIECE?(this._aBar[BAR_UP].getLastPiece().setBar(!1),this._aTriangle[c].addPiece(this._aBar[BAR_UP].removePiece())):(this._aBar[BAR_DOWN].getLastPiece().setBar(!1),this._aTriangle[c].addPiece(this._aBar[BAR_DOWN].removePiece())):a||this._aTriangle[c].addPiece(this._aTriangle[this._oCurrentPiece.getTriangle()].removePiece());
a||this._oCurrentPiece.setTriangle(c)};CGameMulti.prototype.remoteMovePiece=function(b){var f=this.getPieceByIndex(b.iCurrentPieceIndex);this.onClickedPiece(f);this.onClickedTriangle(b.aPossibleMove,!0)};CGameMulti.prototype.gameOver=function(b){this._oThinking.hide();this._oEndPanel.show(this._iScore,b);this._oEndPanel.showButtons();var f=!1;0===b?s_oNetworkManager.isUserA()&&(f=!0):s_oNetworkManager.isUserA()||(f=!0);s_oNetworkManager.sendMsg(MSG_END_MATCH,f)};
CGameMulti.prototype.showRematchQuestion=function(){};CGameMulti.prototype.unload=function(){this._bStartGame=!1;s_oGame._oInterface.unload();s_oGame._oEndPanel&&s_oGame._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren();s_oNetworkManager.addEventListener(ON_DISCONNECTION,function(){})};CGameMulti.prototype.onConfirmExit=function(){s_oGame.unload();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");s_oMain.gotoMenu();s_oNetworkManager.disconnect()};
CGameMulti.prototype._onConfirmRematch=function(){this._oEndPanel.changeMessage(TEXT_WAIT_OPPONENT);this._oEndPanel.hideButtons();s_oNetworkManager.sendMsg(MSG_ACCEPT_REMATCH,"")};CGameMulti.prototype.onOpponentRefuseRematch=function(){this._oEndPanel.changeMessage(TEXT_OPPONENT_LEFT);this._oEndPanel.hideRestartButton();this._oEndPanel.centerHomeButton()};
CGameMulti.prototype.onOpponentAcceptRematch=function(){this._oEndPanel.hide();s_oNetworkManager.isUserA()||this._oThinking.show();s_oGame.onRestart();this._bTurnPlayer1=!0};
CGameMulti.prototype.playerDisconnectedFromGame=function(){if(this._oEndPanel){var b=s_oNetworkManager.isUserA()?0:1;this._oThinking.hide();this._oEndPanel.show(this._iScore,b);this._oEndPanel.showButtons();this._oEndPanel.changeMessage(TEXT_OPPONENT_LEFT);this._oEndPanel.hideRestartButton();this._oEndPanel.centerHomeButton()}s_oNetworkManager.sendMsg(MSG_DISCONNECTION,"")};
CGameMulti.prototype.opponentLeftTheGame=function(){if(this._oEndPanel){var b=s_oNetworkManager.isUserA()?0:1;this._oThinking.hide();this._oEndPanel.show(this._iScore,b);this._oEndPanel.showButtons();this._oEndPanel.changeMessage(TEXT_OPPONENT_LEFT);this._oEndPanel.hideRestartButton();this._oEndPanel.centerHomeButton()}s_oNetworkManager.isUserA()};var CGameSingleWithBot=function(b){CGameSingle.call(this,b)};CGameSingleWithBot.prototype=Object.create(CGameSingle.prototype);
CGameSingleWithBot.prototype._startGame=function(){this._oFastDistributionBut.setVisible(!1);this._bFastDistribution=!0;this.initDistribution();this._oThinking=new CThinking;this._oThinking.setMessage(TEXT_WAITING_MOVES);this._oThinking.hide();this._bTurnPlayer1=!0;this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.addEventListener(ON_BACK_MENU,this.onConfirmExit,this);this._oEndPanel.addEventListener(ON_RESTART,this._onConfirmRematch,this);s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),
s_oNetworkManager.getBotName());s_oInterface.setP2ImageHuman()};CGameSingleWithBot.prototype.gameOver=function(b){for(var f=0,a=0;a<this._aTriangle.length;a++)f+=this._aTriangle[a].getNumPieces();for(a=0;a<this._aBar.length;a++)f+=this._aBar[a].getNumPieces();this._iScore=f*MULTIPLIER_SCORE;this._oEndPanel.show(this._iScore,b);this._oEndPanel.showButtons()};
CGameSingleWithBot.prototype._onConfirmRematch=function(){this._oEndPanel.changeMessage(TEXT_WAIT_OPPONENT);this._oEndPanel.hideButtons();var b=randomFloatBetween(200,2E3);if(.33<Math.random()).4<Math.random()?setTimeout(function(){s_oGame._rematch()},b):s_oGame._rematch();else if(.4<Math.random())setTimeout(function(){s_oGame.onBotRefuseRematch()},b);else s_oGame.onBotRefuseRematch()};
CGameSingleWithBot.prototype.onBotRefuseRematch=function(){this._oEndPanel.changeMessage(TEXT_OPPONENT_LEFT);this._oEndPanel.hideRestartButton();this._oEndPanel.centerHomeButton()};CGameSingleWithBot.prototype._rematch=function(){this._oEndPanel.hide();this._oThinking.hide();s_oGame.onRestart();this._bTurnPlayer1=!0};
function CInterface(){var b,f,a,d,c,e,g,h,k,l,m,n,p=null,q,r=null,v=null,y,D,u,B,z,x=this;this._init=function(){z=!0;m=new createjs.Container;q=!1;s_oStage.addChild(m);var w=s_oSpriteLibrary.getSprite("but_exit");g=CANVAS_WIDTH-w.width/2-10;h=w.height/2+10;l=new CGfxButton(g,h,w,m);l.addEventListener(ON_MOUSE_UP,this._onExit,this);c=g-w.width-5;e=w.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)w=s_oSpriteLibrary.getSprite("audio_icon"),k=new CToggle(c,e,w,s_bAudioActive,m),k.addEventListener(ON_MOUSE_UP,
this._onAudioToggle,this);w=window.document;var F=w.documentElement;r=F.requestFullscreen||F.mozRequestFullScreen||F.webkitRequestFullScreen||F.msRequestFullscreen;v=w.exitFullscreen||w.mozCancelFullScreen||w.webkitExitFullscreen||w.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(r=!1);r&&screenfull.enabled&&(w=s_oSpriteLibrary.getSprite("but_fullscreen"),a=w.width/4+10,d=w.height/2+10,n=new CToggle(a,d,w,s_bFullscreen,m),n.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));w=s_oSpriteLibrary.getSprite("light_turn");
B=createBitmap(w,w.width,w.height);B.regX=11;B.regY=12;B.x=X_INTERFACE_PLAYER+3;B.y=Y_INTERFACE_PLAYER_1;B.alpha=0;m.addChild(B);w=s_oSpriteLibrary.getSprite("turn_p1");D=createBitmap(w,w.width,w.height);D.x=X_INTERFACE_PLAYER;D.y=Y_INTERFACE_PLAYER_1;m.addChild(D);w=s_b2Players?s_oSpriteLibrary.getSprite("turn_p2"):s_oSpriteLibrary.getSprite("turn_cpu");u=createBitmap(w,w.width,w.height);u.x=X_INTERFACE_PLAYER;u.y=Y_INTERFACE_PLAYER_2;m.addChild(u);b=CANVAS_WIDTH-200;f=CANVAS_HEIGHT/2;w=s_oSpriteLibrary.getSprite("but_dice");
y=new CGfxButton(CANVAS_WIDTH+200,f,w,m);y.addEventListener(ON_MOUSE_UP,this._onRollDice,this);y.pulseAnimation();this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k.unload(),k=null;l.unload();s_oStage.removeChild(m);r&&screenfull.enabled&&n.unload();s_oInterface=null};this.refreshPlayersScore=function(w,F){};this.setP2ImageHuman=function(){var w=s_oSpriteLibrary.getSprite("turn_p2");u.image=w};this.refreshButtonPos=function(w,F){l.setPosition(g-
w,F+h);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.setPosition(c-w,F+e);r&&screenfull.enabled&&n.setPosition(a+w,d+F);s_bMobile&&q&&(s_b2Players?((void 0).setPosition((void 0).x+w,(void 0).y-F),(void 0).setPosition((void 0).x+w,(void 0).y-F),(void 0).setPosition((void 0).x-w,(void 0).y-F),(void 0).setPosition((void 0).x-w,(void 0).y-F)):((void 0).setPosition((void 0).x+w,(void 0).y-F),(void 0).setPosition((void 0).x+w,(void 0).y-F)))};this.onFocusTurn=function(w){z&&(z=!1,x.tweenFocusTurn());B.y=
w?Y_INTERFACE_PLAYER_1:Y_INTERFACE_PLAYER_2};this.setPlayersInfo=function(w,F){var A=s_oSpriteLibrary.getSprite("turn_p1");new CVerticalText(D.x+A.width/2,D.y+A.height,w,m);new CVerticalText(u.x+A.width/2,u.y+A.height,F,m)};this.tweenFocusTurn=function(){(new createjs.Tween.get(B)).to({alpha:1},700).to({alpha:0},700).call(x.tweenFocusTurn)};this.setOnTop=function(){s_oStage.addChildAt(m,s_oStage.numChildren)};this.setVisibleButDice=function(w){!1===w?(y.setClickable(!1),(new createjs.Tween.get(y.getButtonImage())).to({x:CANVAS_WIDTH+
200},300,createjs.Ease.cubicIn)):!0===w&&(y.setClickable(!0),(new createjs.Tween.get(y.getButtonImage())).to({x:b},300,createjs.Ease.cubicOut))};this.refreshScore=function(w){};this._onRollDice=function(){s_oGame.rollDice()};this._onButHelpRelease=function(){p=new CHelpPanel};this.onExitFromHelp=function(){p.unload()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){new CAreYouSurePanel(s_oGame.onConfirmExit)};this.resetFullscreenBut=
function(){n.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?v.call(window.document):r.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CCreditsPanel(){var b,f,a,d,c,e,g;this._init=function(){f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=0;s_oStage.addChild(f);(new createjs.Tween.get(f)).to({alpha:.7},500);e=new createjs.Shape;e.graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.01;g=e.on("click",this._onLogoButRelease);s_oStage.addChild(e);a=new createjs.Container;s_oStage.addChild(a);var h=s_oSpriteLibrary.getSprite("msg_box"),k=createBitmap(h);
k.regX=h.width/2;k.regY=h.height/2;a.addChild(k);a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT+h.height/2;b=a.y;(new createjs.Tween.get(a)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn);k=new createjs.Text("DEVELOPED BY"," 40px "+PRIMARY_FONT,"#3c2200");k.y=-h.height/2+90;k.textAlign="center";k.textBaseline="middle";k.lineWidth=300;a.addChild(k);h=new createjs.Text("www.codethislab.com"," 40px "+PRIMARY_FONT,"#3c2200");h.y=100;h.textAlign="center";h.textBaseline="middle";h.lineWidth=300;a.addChild(h);
h=new createjs.Text("v.2"," 20px "+PRIMARY_FONT,"#3c2200");h.x=-240;h.y=170;h.textAlign="center";h.textBaseline="middle";h.lineWidth=300;a.addChild(h);h=s_oSpriteLibrary.getSprite("ctl_logo");c=createBitmap(h);c.regX=h.width/2;c.regY=h.height/2;a.addChild(c);h=s_oSpriteLibrary.getSprite("but_exit");d=new CGfxButton(217,-145,h,a);d.addEventListener(ON_MOUSE_UP,this.unload,this)};this.changePointer=function(h){!1===s_bMobile&&(h.target.cursor="pointer")};this.unload=function(){d.setClickable(!1);(new createjs.Tween.get(f)).to({alpha:0},
500);(new createjs.Tween.get(a)).to({y:b},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(f);s_oStage.removeChild(a);d.unload()});e.off("click",g);s_oStage.removeChild(e)};this._onLogoButRelease=function(){};this._onMoreGamesReleased=function(){};this._init()}
function CAreYouSurePanel(b){var f,a,d,c,e,g;this._init=function(k){createjs.Tween.pauseAllTweens();c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;g=c.on("mousedown",function(){});s_oStage.addChild(c);(new createjs.Tween.get(c)).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);k=s_oSpriteLibrary.getSprite("msg_box");var l=createBitmap(k);l.regX=k.width/2;l.regY=k.height/2;e.addChild(l);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT+k.height/
2;f=e.y;(new createjs.Tween.get(e)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn);l=new createjs.Text(TEXT_ARE_SURE," 54px "+PRIMARY_FONT,"#000000");l.y=-k.height/2+120;l.textAlign="center";l.textBaseline="middle";l.lineWidth=400;l.outline=5;e.addChild(l);k=new createjs.Text(TEXT_ARE_SURE," 54px "+PRIMARY_FONT,"#FFFFFF");k.y=l.y;k.textAlign="center";k.textBaseline="middle";k.lineWidth=400;e.addChild(k);a=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes_big"),e);a.addEventListener(ON_MOUSE_UP,
this._onButYes,this);d=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_no"),e);d.addEventListener(ON_MOUSE_UP,this._onButNo,this);d.pulseAnimation()};this._onButYes=function(){d.setClickable(!1);a.setClickable(!1);(new createjs.Tween.get(c)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:f},400,createjs.Ease.backIn).call(function(){h.unload();b()})};this._onButNo=function(){d.setClickable(!1);a.setClickable(!1);(new createjs.Tween.get(c)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:f},
400,createjs.Ease.backIn).call(function(){h.unload()})};this.unload=function(){d.unload();a.unload();s_oStage.removeChild(c);s_oStage.removeChild(e);c.off("mousedown",g);createjs.Tween.resumeAllTweens()};var h=this;this._init(b)}
function CEndPanel(b){var f,a,d,c,e,g,h,k,l,m,n;this._init=function(p){m=[];n=[];var q=new createjs.Shape;q.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);q.alpha=.5;q.on("mousedown",this.onMouseDown,this);f=createBitmap(p);p=f.getBounds();f.regX=p.width/2;f.regY=p.height/2;f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2;d=new createjs.Text(""," 48px "+PRIMARY_FONT,"#3c2200");d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-108;d.lineHeight=50;d.textAlign="center";d.textBaseline="alphabetic";d.lineWidth=
530;c=new createjs.Text(""," 37px "+PRIMARY_FONT,"#3c2200");c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2+15;c.textAlign="center";c.textBaseline="alphabetic";c.lineWidth=530;c.lineHeight=50;a=new createjs.Container;a.alpha=0;a.visible=!1;a.addChild(q,f,c,d);s_oStage.addChild(a);q=s_oSpriteLibrary.getSprite("but_restart");h=new CGfxButton(CANVAS_WIDTH/2+100,CANVAS_HEIGHT/2+110,q,a);q=s_oSpriteLibrary.getSprite("but_home");k=new CGfxButton(CANVAS_WIDTH/2-100,CANVAS_HEIGHT/2+110,q,a);this.hide()};this.unload=
function(){s_oStage.removeChild(a);h.unload();k.unload()};this.addEventListener=function(p,q,r){m[p]=q;n[p]=r};this.onMouseDown=function(){};this._initListener=function(){k.addEventListener(ON_MOUSE_DOWN,this._onExit,this);h.addEventListener(ON_MOUSE_DOWN,this._onRestart,this)};this.show=function(p,q){l=0===q||s_b2Players?playSound("win",1,!1):playSound("game_over",1,!1);g=p;var r=q+1;0===q?d.text=TEXT_GAMEOVER:(g=0,d.text=TEXT_LOSE+r+TEXT_LOSE2);!0===s_b2Players?d.text=TEXT_WIN_2PLAYERS+r+TEXT_WIN_2PLAYERS_2:
c.text=TEXT_SCORE+": "+p;a.visible=!0;var v=this;createjs.Tween.get(a).to({alpha:1},500).call(function(){v._initListener()});$(s_oMain).trigger("save_score",g);$(s_oMain).trigger("end_session")};this.hide=function(){a.visible=!1};this.hideRestartButton=function(){h.setVisible(!1)};this.hideButtons=function(){k.setVisible(!1);h.setVisible(!1)};this.showButtons=function(){k.setVisible(!0);h.setVisible(!0)};this.changeMessage=function(p){d.text=p};this.centerHomeButton=function(){s_oSpriteLibrary.getSprite("msg_box");
k.setX(CANVAS_WIDTH/2);k.setVisible(!0)};this._onExit=function(){l.stop();e=ON_BACK_MENU;m[e]&&m[e].call(n[e])};this._onRestart=function(){l.stop();e=ON_RESTART;m[e]&&m[e].call(n[e])};this._init(b);return this}
function CSelectPlayers(){var b,f,a,d,c,e,g,h,k,l,m,n,p,q=null,r=null;this.init=function(){s_oSelectPlayers=this;g=new createjs.Container;s_oStage.addChild(g);var v=s_oSpriteLibrary.getSprite("bg_select_mode");v=new createBitmap(v,v.width,v.height);g.addChild(v);v=s_oSpriteLibrary.getSprite("but_p1");h=new CGfxButton(CANVAS_WIDTH/2-225,CANVAS_HEIGHT/2+50,v,g);h.addEventListener(ON_MOUSE_DOWN,function(){this.onSelectPlayer(!1)},this);v=s_oSpriteLibrary.getSprite("but_p2");k=new CGfxButton(CANVAS_WIDTH/
2+225,CANVAS_HEIGHT/2+50,v,g);k.addEventListener(ON_MOUSE_DOWN,function(){this.onSelectPlayer(!0)},this);l=new createjs.Text(TEXT_SELECT_PLAYERS_MENU,"72px "+PRIMARY_FONT,"#FFFFFF");l.y=CANVAS_HEIGHT/2-300;l.x=CANVAS_WIDTH/2;l.textAlign="center";g.addChild(l);v=s_oSpriteLibrary.getSprite("but_exit");c=CANVAS_WIDTH-v.width/2-10;e=v.height/2+10;m=new CGfxButton(c,e,v,g);m.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a=m.getX()-v.width-10,d=v.height/2+
10,n=new CToggle(a,d,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive,g),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);v=window.document;var y=v.documentElement;q=y.requestFullscreen||y.mozRequestFullScreen||y.webkitRequestFullScreen||y.msRequestFullscreen;r=v.exitFullscreen||v.mozCancelFullScreen||v.webkitExitFullscreen||v.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(q=!1);q&&screenfull.enabled&&(v=s_oSpriteLibrary.getSprite("but_fullscreen"),b=v.width/4+10,f=v.height/2+10,p=new CToggle(b,
f,v,s_bFullscreen,g),p.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(v,y){m.setPosition(c-v,e+y);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(a-v,y+d);q&&screenfull.enabled&&p.setPosition(b+v,f+y)};this.onSelectPlayer=function(v){s_b2Players=v;this.unload();s_oMain.gotoGame()};this.unload=function(){s_oStage.removeChild(g);s_oSelectPlayers};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);
s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){p.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?r.call(window.document):q.call(window.document.documentElement);sizeHandler()};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this.init()}var s_oSelectPlayers=null;
function CAlertBox(b){var f,a,d,c,e,g=this,h;this.init=function(k){h=!0;a=k;f=new createjs.Container;f.x=CANVAS_WIDTH/2;f.on("mousedown",this.onMouseDown);a.addChild(f);k=s_oSpriteLibrary.getSprite("alert_box");d=createBitmap(k,k.width,k.height);d.regX=k.width/2-3;d.regY=k.height/2-8;f.addChild(d);var l=k.width-50,m=k.height-20;c=new CTLText(f,-(l/2),6-m/2,l,m,38,"center","#3c2200",PRIMARY_FONT,1.1,2,2," ",!0,!0,!0,!1);e=-k.height/2-10;f.y=e};this.show=function(k){h=!1;c.refreshText(k);(new createjs.Tween.get(f)).to({y:CANVAS_HEIGHT/
2},500,createjs.Ease.cubicOut).wait(1600).call(function(){h||g.hide()})};this.hide=function(){h=!0;createjs.Tween.removeTweens(f);(new createjs.Tween.get(f)).to({y:e},500,createjs.Ease.cubicIn)};this.onMouseDown=function(){h||g.hide()};this.init(b)}
function CThinking(){var b,f,a,d,c,e,g;this._init=function(){b=!0;f=0;a=new createjs.Container;var h=(new createjs.Graphics).beginFill("rgba(0,0,0,0.5)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e=new createjs.Shape(h);g=e.on("click",function(){});d=new createjs.Text(TEXT_THINKING,"60px "+PRIMARY_FONT,"#ffffff");d.x=.5*CANVAS_WIDTH;d.y=.5*CANVAS_HEIGHT-100;d.textAlign="center";d.textBaseline="alphabetic";d.lineWidth=800;c=new createjs.Text("","180px "+PRIMARY_FONT,"#ffffff");c.x=.5*CANVAS_WIDTH-76;
c.y=.5*CANVAS_HEIGHT-50;c.textAlign="left";c.textBaseline="alphabetic";c.lineWidth=800;a.addChild(e,d,c);s_oStage.addChild(a)};this.unload=function(){b=!1;e.off("click",g);s_oStage.removeChild(a)};this.isShown=function(){return a.visible};this.show=function(){a.visible=!0};this.hide=function(){a.visible=!1};this.setMessage=function(h){d.text=h};this.update=function(){b&&(f+=s_iTimeElaps,0<=f&&f<TIME_LOOP_WAIT/4?c.text="":f>=TIME_LOOP_WAIT/4&&f<2*TIME_LOOP_WAIT/4?c.text=".":f>=2*TIME_LOOP_WAIT/4&&
f<3*TIME_LOOP_WAIT/4?c.text="..":f>=3*TIME_LOOP_WAIT/4&&f<TIME_LOOP_WAIT?c.text="...":f=0)};this._init()}
function CPiece(b,f,a,d,c){var e,g,h,k,l,m,n,p,q,r,v,y,D,u,B,z;this.init=function(x,w,F,A,P){k=new createjs.Container;e=x;g=w;h=F;q=A;q.addChild(k);k.x=e;k.y=g;n=this;r=P;u=null;z=B=!1;x=h===BLACK_PIECE?s_oSpriteLibrary.getSprite("red_piece"):s_oSpriteLibrary.getSprite("white_piece");x=new createjs.SpriteSheet({images:[x],framerate:30,frames:{width:66,height:58,regX:31,regY:29},animations:{out:{frames:[4],next:"out"},idle:{frames:[0],next:"idle"},takeIn:{frames:[4,3,2,1],next:"idle"},takeOut:{frames:[1,
2,3,4],next:"out"}}});l=createSprite(x,"out",31,29,66,58);x=s_oSpriteLibrary.getSprite("highlight");m=createBitmap(x,x.width,x.height);m.regX=x.width/2;m.regY=x.height/2;m.alpha=0;p=!1;k.addChild(l,m)};this.onOver=function(x){s_bMobile||(x.target.cursor="pointer")};this.setClicked=function(x){!0===x?(m.alpha=1,p=!0):(m.alpha=0,p=!1)};this.getStateClick=function(){return p};this.getColor=function(){return h};this.getInstance=function(){return n};this.getPiece=function(){return k};this.getIndex=function(){return r};
this.getXOut=function(){return e-2};this.getYOut=function(x){return h===WHITE_PIECE?Y_OFFBOARD_DOWN+238-17*x:Y_OFFBOARD_UP+17*x};this.takeInAnimation=function(){l.gotoAndPlay("takeIn")};this.takeOutAnimation=function(){l.gotoAndPlay("takeOut")};this.setTriangle=function(x){u=x};this.getTriangle=function(){return u};this.setOnTop=function(){q.addChild(k)};this.setBar=function(x){B=x};this.isOnBar=function(){return B};this.movePieceDistribution=function(x,w){this.takeInAnimation();playSound("click_cell",
1,!1);(new createjs.Tween.get(k)).to({x:x,y:w},MS_DISTRIBUTION,createjs.Ease.cubicOut).call(function(){s_oGame.initDistribution()})};this.movePieceOnBoard=function(x,w){(new createjs.Tween.get(k)).to({x:x,y:w},700,createjs.Ease.cubicOut).call(function(){s_oGame.updateInput();s_oGame.afterMove()})};this.movePiece=function(x,w){(new createjs.Tween.get(k)).to({x:x,y:w},700,createjs.Ease.cubicOut)};this.initListeners=function(){v=k.on("mousedown",function(){s_oGame.onClickedPiece(n)});y=k.on("rollover",
this.onOver);D=k.on("rollout",this.onMouseOut);z=!0};this.unloadListeners=function(){k.off("mousedown",v);k.off("rollover",y);k.off("rollout",D);z=!1};this.cpuInit=function(){z=!0};this.cpuUnload=function(){z=!1};this.getStateListener=function(){return z};this.onMouseOut=function(x){s_bMobile||(x.target.cursor="default")};this.init(b,f,a,d,c)}
function CTriangle(b,f,a,d){var c,e,g,h,k,l,m,n,p,q;this.init=function(r,v,y,D){h=new createjs.Container;g=y;g.addChild(h);c=r;e=v;m=D;p=null;k=e===Y_TRIANGLE_UP?TRIANGLE_UP:TRIANGLE_DOWN;n=[];r=0===m%2?s_oSpriteLibrary.getSprite("triangle_red"):s_oSpriteLibrary.getSprite("triangle_white");r=new createjs.SpriteSheet({images:[r],frames:{width:69,height:256,regX:34.5,regY:0},animations:{idle:[0,0,"idle"],focus:[1,1,"focus"]}});l=new createSprite(r,"idle",34.5,0,69,256);k===TRIANGLE_DOWN&&(l.scaleY*=
-1);l.x=c;l.y=e;h.addChild(l)};this.reset=function(){n=[]};this.getX=function(){return c};this.getY=function(){if(k===TRIANGLE_UP){if(5>n.length)return e+28+53*n.length;if(9>n.length)return e+28+30+54*(n.length-5);if(12>n.length)return e+28+60+53*(n.length-9);if(14>n.length)return e+28+90+53*(n.length-12);if(14===n.length)return e+28+60+53}else{if(5>n.length)return e-35-53*n.length;if(9>n.length)return e-35-30-53*(n.length-5);if(12>n.length)return e-28-60-53*(n.length-9);if(14>n.length)return e-28-
90-53*(n.length-12);if(14===n.length)return e-28-60-53}};this.getNumPieces=function(){return n.length};this.addPiece=function(r){n.push(r);p=r.getColor()};this.isHerePiece=function(r){for(var v=!1,y=0;y<n.length;y++)r===n[y]&&(v=!0);return v};this.getColor=function(){return p};this.getPieceByIndex=function(r){return n[r]};this.onFocus=function(r){l.gotoAndStop("focus");this.initShape(r)};this.onOver=function(r){s_bMobile||(r.target.cursor="pointer")};this.onIdle=function(){l.gotoAndStop("idle");s_oStage.removeChild(q)};
this.getLastPiece=function(){return n[n.length-1]};this.getArrayPieces=function(){return n};this.removePiece=function(){var r=n.pop();0===n.length&&(p=null);return r};this.initShape=function(r){q=new createjs.Shape;k===TRIANGLE_UP?q.graphics.beginFill("#000000").drawRect(b-31,f,62,283):q.graphics.beginFill("#000000").drawRect(b-31,f,62,-283);q.alpha=.01;q.on("mousedown",function(){s_oGame.onClickedTriangle(r)});q.on("mouseover",this.onOver);s_oStage.addChild(q)};this.init(b,f,a,d)}
function CBar(b,f,a,d){var c,e,g,h,k,l,m,n;this.init=function(p,q,r,v){h=new createjs.Container;g=v;g.addChild(h);c=p;e=q;m=null;l=[];k=r;n=new createjs.Shape;n.graphics.beginFill("#000000").drawRect(p,q,62,253);n.regX=31;k===BAR_DOWN&&(n.regY=253);n.alpha=.01;h.addChild(n)};this.getX=function(){return c};this.getY=function(){if(k===BAR_UP){if(5>l.length)return e+28+56*l.length;if(9>l.length)return e+28+30+56*(l.length-5);if(12>l.length)return e+28+60+56*(l.length-9);if(14>l.length)return e+28+90+
56*(l.length-12);if(14===l.length)return e+28+60+56}else{if(5>l.length)return e-35-56*l.length;if(9>l.length)return e-35-30-56*(l.length-5);if(12>l.length)return e-28-60-56*(l.length-9);if(14>l.length)return e-28-90-56*(l.length-12);if(14===l.length)return e-28-60-56}};this.getNumPieces=function(){return l.length};this.addPiece=function(p){l.push(p);m=p.getColor()};this.isHerePiece=function(p){for(var q=!1,r=0;r<l.length;r++)p===l[r]&&(q=!0);return q};this.getColor=function(){return m};this.getPieceByIndex=
function(p){return l[p]};this.onOver=function(p){s_bMobile||(p.target.cursor="pointer")};this.getLastPiece=function(){return l[l.length-1]};this.getArrayPieces=function(){return l};this.removePiece=function(){return l.pop()};this.init(b,f,a,d)}
function CDices(b){var f,a,d,c,e,g,h=!1,k,l,m=this;this._init=function(n){k=!0;f=new createjs.Container;f.x=0;f.y=0;l=n;s_oStage.addChild(f);l===WHITE_DICES?(n={images:[s_oSpriteLibrary.getSprite("launch_dices_white")],framerate:30,frames:{width:398,height:230,regX:0,regY:0},animations:{stop:[12,12],idle:[0,12,"stop"]}},n=new createjs.SpriteSheet(n),g=createSprite(n,0,0,0,398,230),g.x=CANVAS_WIDTH-398,g.y=CANVAS_HEIGHT-230,g.visible=!1,f.addChild(g),n={images:[s_oSpriteLibrary.getSprite("dice_white_a_1"),
s_oSpriteLibrary.getSprite("dice_white_a_2"),s_oSpriteLibrary.getSprite("dice_white_a_3"),s_oSpriteLibrary.getSprite("dice_white_a_4"),s_oSpriteLibrary.getSprite("dice_white_a_5"),s_oSpriteLibrary.getSprite("dice_white_a_6")],framerate:30,frames:{width:240,height:302,regX:0,regY:0},animations:{stop1:[10,10],idle1:[0,10,"stop1"],stop2:[22,22],idle2:[12,22,"stop2"],stop3:[34,34],idle3:[24,34,"stop3"],stop4:[46,46],idle4:[36,46,"stop4"],stop5:[58,58],idle5:[48,58,"stop5"],stop6:[70,70],idle6:[60,70,
"stop6"]}},n=new createjs.SpriteSheet(n),c=createSprite(n,0,0,0,240,302),c.x=798,c.y=383,c.visible=!1,f.addChild(c),n={images:[s_oSpriteLibrary.getSprite("dice_white_b_1"),s_oSpriteLibrary.getSprite("dice_white_b_2"),s_oSpriteLibrary.getSprite("dice_white_b_3"),s_oSpriteLibrary.getSprite("dice_white_b_4"),s_oSpriteLibrary.getSprite("dice_white_b_5"),s_oSpriteLibrary.getSprite("dice_white_b_6")],framerate:30,frames:{width:246,height:394,regX:0,regY:0},animations:{stop1:[15,15],idle1:[0,15,"stop1"],
stop2:[31,31],idle2:[16,31,"stop2"],stop3:[47,47],idle3:[32,47,"stop3"],stop4:[63,63],idle4:[48,63,"stop4"],stop5:[79,79],idle5:[64,79,"stop5"],stop6:[95,95],idle6:[80,95,"stop6"]}},n=new createjs.SpriteSheet(n),e=createSprite(n,0,0,0,246,394),e.x=975,e.y=369):(n={images:[s_oSpriteLibrary.getSprite("launch_dices_red")],framerate:24,frames:{width:332,height:370},animations:{stop:[10,10],idle:[0,10,"stop"]}},n=new createjs.SpriteSheet(n),g=createSprite(n,0,0,0,332,370),g.x=0,g.y=0,g.visible=!1,f.addChild(g),
n={images:[s_oSpriteLibrary.getSprite("dice_red_a_1"),s_oSpriteLibrary.getSprite("dice_red_a_2"),s_oSpriteLibrary.getSprite("dice_red_a_3"),s_oSpriteLibrary.getSprite("dice_red_a_4"),s_oSpriteLibrary.getSprite("dice_red_a_5"),s_oSpriteLibrary.getSprite("dice_red_a_6")],framerate:24,frames:{width:242,height:208},animations:{stop1:[8,8],idle1:[0,8,"stop1"],stop2:[17,17],idle2:[9,17,"stop2"],stop3:[26,26],idle3:[18,26,"stop3"],stop4:[35,35],idle4:[27,35,"stop4"],stop5:[44,44],idle5:[36,44,"stop5"],stop6:[53,
53],idle6:[45,53,"stop6"]}},n=new createjs.SpriteSheet(n),c=createSprite(n,0,0,0,242,208),c.x=187,c.y=274,c.visible=!1,f.addChild(c),n={images:[s_oSpriteLibrary.getSprite("dice_red_b_1"),s_oSpriteLibrary.getSprite("dice_red_b_2"),s_oSpriteLibrary.getSprite("dice_red_b_3"),s_oSpriteLibrary.getSprite("dice_red_b_4"),s_oSpriteLibrary.getSprite("dice_red_b_5"),s_oSpriteLibrary.getSprite("dice_red_b_6")],framerate:30,frames:{width:324,height:228,regX:0,regY:0},animations:{stop1:[13,13],idle1:[0,13,"stop1"],
stop2:[27,27],idle2:[14,27,"stop2"],stop3:[41,41],idle3:[28,41,"stop3"],stop4:[55,55],idle4:[42,55,"stop4"],stop5:[69,69],idle5:[56,69,"stop5"],stop6:[83,83],idle6:[70,83,"stop6"]}},n=new createjs.SpriteSheet(n),e=createSprite(n,0,0,0,324,228),e.x=258,e.y=242);e.visible=!1;f.addChild(e)};this.isAnimationOn=function(){return h};this.show=function(){c.visible=e.visible=!1;a=Math.floor(6*Math.random()+1);d=Math.floor(6*Math.random()+1);h=!0;playSound("dices",1,!1);g.visible=!0;g.gotoAndPlay("idle");
g.on("animationend",function(){g.visible&&m.secondAnimation()})};this.showAResult=function(n,p){a=n;d=p;h=!0;playSound("dices",1,!1);g.visible=!0;g.gotoAndPlay("idle");g.on("animationend",function(){g.visible&&m.secondAnimation()})};this.secondAnimation=function(){g.visible=!1;c.alpha=e.alpha=1;c.visible=e.visible=!0;c.gotoAndPlay("idle"+a);e.gotoAndPlay("idle"+d);h=!1;s_oGame.afterRollDice(a,d)};this.fadeOutTween=function(){createjs.Tween.get(c,{loop:!1}).to({alpha:0},200);createjs.Tween.get(e,{loop:!1}).to({alpha:0},
200).call(this.hide)};this.returnDiceResult1=function(){return a};this.returnDiceResult2=function(){return d};this.hide=function(){c.visible=e.visible=!1};this.unload=function(){s_oDices=null};this.isFirstLaunch=function(){return k};this.setFirstLaunch=function(n){k=n};s_oDices=this;this._init(b)}
function CVerticalText(b,f,a,d){var c,e;this._init=function(g,h,k,l){c=new createjs.Container;c.x=g;c.y=h;l.addChild(c);this._buildText()};this.unload=function(){};this._buildText=function(){for(var g=0;g<a.length;g++)e=new createjs.Text(a[g],"60px "+PRIMARY_FONT,"#3d1f00"),e.y+=50*g,e.textBaseline="top",e.textAlign="center",e.lineWidth=100,c.addChild(e);g=c.getBounds().height;146<g&&(c.scaleX=c.scaleY=146/g)};this._init(b,f,a,d)}
function CRuleFilter(){var b,f,a;this._init=function(){b=24;f=25};this.checkMovesAvailable=function(d){var c=d?WHITE_PIECE:BLACK_PIECE;d=this.getCurBoardStatus();a=[];var e=this.getDiceState();a[0]=e.dice1;a[1]=e.dice2;var g=[];if(a[0]===a[1])return g;g=[];for(e=0;e<a.length;e++)g[e]=this._getMovesList(c,d,a[e]),g[e]=this._removeAllMovesByType(MOVES_TYPE_COLLISION,g[e]);g=this._checkRulePlayBothDice(g,d);c=this._countAllowedMoves(g[0]);c+=this._countAllowedMoves(g[1]);0===c&&(this._resetAllRule(g[0]),
this._resetAllRule(g[1]),g=this._checkRuleHigherDiceValue(g,d));g=g[0].concat(g[1]);g.sort(function(h,k){return h.src>k.src?1:k.src>h.src?-1:0});for(e=d=0;e<g.length;e++)g[e].brokenrule!==RULE_BROKEN_NONE&&d++;d===g.length&&(g=[]);return g};this.reset=function(){};this._checkRulePlayBothDice=function(d,c){for(var e=0;e<d.length;e++)for(var g=d[e],h=a[+!e],k=0;k<g.length;k++)this._checkTheMoveAndMark(g[k],c,h,RULE_BROKEN_BOTH_DICE);return d};this._checkRuleHigherDiceValue=function(d,c){for(var e=a[a[0]>
a[1]?0:1],g=d[a[0]<a[1]?0:1],h=0;h<g.length;h++)this._checkTheMoveAndMark(g[h],c,e,RULE_BROKEN_HIGHER_DICE);return d};this._checkRuleDoubleDicePlayMost=function(){};this._checkTheMoveAndMark=function(d,c,e,g){var h=c[d.src].color;c=this.getABoardCopy(c);this._doMove(d,c);e=this._getMovesList(h,c,e);e=this._removeAllMovesByType(MOVES_TYPE_COLLISION,e);d.brokenrule=0<e.length?RULE_BROKEN_NONE:g};this._doMove=function(d,c){var e=d.src,g=d.dst,h=c[e].color;c[e].numpieces--;0===c[e].numpieces&&(c[e].color=
null);switch(d.type){case MOVES_TYPE_HIT:c[g].color=h;c[g].numpieces=1;break;case MOVES_TYPE_BEAR:break;case MOVES_TYPE_EXTRABEAR:break;default:c[g].color=h,c[g].numpieces++}};this.getCurBoardStatus=function(){for(var d=s_oGame.getTriangles(),c=[],e=0;e<d.length;e++){var g=d[e].getColor(),h=d[e].getNumPieces();c[e]={color:g,numpieces:h}}c[b]=this.getPlayersPieceListOnBar(WHITE_PIECE);c[f]=this.getPlayersPieceListOnBar(BLACK_PIECE);return c};this.getABoardCopy=function(d){return JSON.parse(JSON.stringify(d))};
this.getPlayersPieceListPos=function(d,c){for(var e=[],g=0;g<c.length;g++)c[g].color===d&&e.push(g);return e};this.getPlayersPieceListOnBar=function(d){var c=s_oGame.getBars(),e=null;d===WHITE_PIECE?(d=c[BAR_UP].getNumPieces(),0<d&&(e=WHITE_PIECE)):(d=c[BAR_DOWN].getNumPieces(),0<d&&(e=BLACK_PIECE));return{color:e,numpieces:d}};this.checkAndSetOnlyPieceFromBar=function(d){var c=d,e=d.indexOf(b);-1!==e&&(c=[],c.push(d[e]));e=d.indexOf(f);-1!==e&&(c=[],c.push(d[e]));return c};this._getMovesList=function(d,
c,e){var g=this.getPlayersPieceListPos(d,c);g=this.checkAndSetOnlyPieceFromBar(g);for(var h=this.playerCanBear(d,g),k=d===WHITE_PIECE?1:-1,l=[],m=0;m<g.length;m++){var n=g[m],p=(g[m]<b?n:d===WHITE_PIECE?-1:24)+k*e,q=this.getMovesType(c,p,n,h);l.push({src:n,dst:p,type:q,brokenrule:RULE_BROKEN_NONE})}c=this._checkExtraBearMoves(d,g,e,h);d=d===WHITE_PIECE?24:-1;null!==c&&l.push({src:c,dst:d,type:MOVES_TYPE_EXTRABEAR,brokenrule:RULE_BROKEN_NONE});return l};this.getMovesType=function(d,c,e,g){e=d[e].color;
var h=e===WHITE_PIECE?24:-1;24<=c||0>c?d=c===h&&g?MOVES_TYPE_BEAR:MOVES_TYPE_COLLISION:(d=d[c],d=d.color===e?MOVES_TYPE_ADD:null===d.color?MOVES_TYPE_FILL:1===d.numpieces?MOVES_TYPE_HIT:MOVES_TYPE_COLLISION);return d};this._checkExtraBearMoves=function(d,c,e,g){var h=d===WHITE_PIECE?24:-1,k=null;g&&(d===WHITE_PIECE?(d=Math.min.apply(Math,$jscomp.arrayFromIterable(c)),h-=d):(d=Math.max.apply(Math,$jscomp.arrayFromIterable(c)),h=-(h-d)),e>h&&(k=d));return k};this.playerCanBear=function(d,c){if(d===
WHITE_PIECE)for(var e=0;e<c.length;e++){if(18>c[e]||c[e]===b)return!1}else for(e=0;e<c.length;e++)if(5<c[e]||c[e]===f)return!1;return!0};this._removeAllMovesByType=function(d,c){return c=c.filter(function(e){return e.type!==d})};this.checkForbiddenMoveInList=function(d,c,e){d=this._findMoveBySource(e,c,d.iFocusTriangle);return null===d||d.brokenrule===RULE_BROKEN_NONE?RULE_BROKEN_NONE:d.brokenrule};this._findMoveBySource=function(d,c,e){-1===c?c=b:24===c&&(c=f);for(var g=null,h=0;h<d.length;h++){var k=
d[h];k.src===c&&k.dst===e&&(g=k)}return g};this._resetAllRule=function(d){for(var c=0;c<d.length;c++)d[c].brokenrule=RULE_BROKEN_NONE};this._countAllowedMoves=function(d){for(var c=0,e=0;e<d.length;e++)d[e].brokenrule===RULE_BROKEN_NONE&&c++;return c};this.getDiceState=function(){return s_oGame.getDiceResult()};this.getOtherColor=function(d){return d=d===BLACK_PIECE?WHITE_PIECE:BLACK_PIECE};this._init()};